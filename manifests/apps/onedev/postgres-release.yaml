apiVersion: helm.toolkit.fluxcd.io/v2beta1
kind: HelmRelease
metadata:
    name: postgres
    namespace: onedev
spec:
    interval: 10m0s
    chart:
        spec:
            chart: postgresql-ha
            version: '>=14.0.2 <14.1.0'
            sourceRef:
                kind: HelmRepository
                name: bitnami
                namespace: onedev
            interval: 1m
    values:
        global:
            postgresql:
                username: onedev
                password: ENC[AES256_GCM,data:tWGxHerUt5kLW18cxlBGab1It5SiwW04RZbVk1T0Z10=,iv:+Xzs0/wFxvWQKvQbsx29Az7YQaOL6H/ZQOrXTXrNgIo=,tag:JI2vN4JJk+IXVs99va+d+g==,type:str]
                database: onedev
                repmgrUsername: repmgr
                repmgrPassword: ENC[AES256_GCM,data:VymL5jmBddq/KSIc9X6H/iom/yf+RJ04YtBztVQKkz0=,iv:KwE4xIUenv8wexCq1/1K3EiT6gdHO+53V7MXy0SPAFo=,tag:yzbwembPBit2Jvkc8cllHw==,type:str]
            pgpool:
                adminUsername: pgpool
                adminPassword: ENC[AES256_GCM,data:FS01ToEu1rIHiPSAEjoQLg7TRMPOO/crM6eMtSEC2+I=,iv:vqjxcyX4sYTsXVBDVx+6t6Rez01mMdkbXVoRQKLwabw=,tag:jpU54cnisI8WC3calOmVDA==,type:str]
        postgresql:
            podLabels:
                app.omnilium.local/identifier: postgres-onedev
            affinity:
                podAntiAffinity:
                    preferredDuringSchedulingIgnoredDuringExecution:
                        - weight: 100
                          podAffinityTerm:
                            labelSelector:
                                matchLabels:
                                    app.omnilium.local/identifier: postgres-onedev
                            topologyKey: topology.omnilium.local/host
            topologySpreadConstraints:
                - labelSelector: null
                  matchLabels:
                    app.omnilium.local/identifier: postgres-onedev
                  topologyKey: topology.kubernetes.io/zone
                  maxSkew: 1
                  whenUnsatisfiable: ScheduleAnyway
            extraVolumes:
                - name: dshm
                  emptyDir:
                    medium: Memory
                    sizeLimit: 256Mi
            extraVolumeMounts:
                - name: dshm
                  mountPath: /dev/shm
            resourcesPreset: medium
            password: ENC[AES256_GCM,data:M/9CD9C/zcRePlMX8g0/1Mg197Z7x+EdOfJIPzFx2PE=,iv:PGNT2RMgCEf/GZVbIJaBm3v4neCtkaV0j/FFa3j+i90=,tag:WD9Tes5hH2mQTgT1+skI6Q==,type:str]
            postgresPassword: ENC[AES256_GCM,data:VYPu6aka6tCvK3t41hpde+M/+oV+ZAgGFg7URYfPyRk=,iv:zCMt8CzcXRUM7CBbZLNqMINZre6NvIqWKXfzwApM77c=,tag:djtvj38wHCeLHlmdvNQZkA==,type:str]
            repmgrPassword: ENC[AES256_GCM,data:D3fNPtMAzGvr7RmNzX8L3e7oezrH0QmUA5flp1XyFvs=,iv:AfgdEReZxUEPbBZFZ559UEMupcGLiutNdcxTyy7RJb8=,tag:LN3sDbj2aMTzSJDH1fleKQ==,type:str]
            maxConnections: 200
            postgresConnectionLimit: 20
            dbUserConnectionLimit: 180
        pgpool:
            resourcesPreset: small
            adminPassword: ENC[AES256_GCM,data:7Fgg5mpYKw9Ndm1rUdAd5FOVqkj3+NUyI88GwCZLboc=,iv:5WZVvps9IDtl+5m04hcBbLv3Zp/3ad/I8DhjhSlSpF4=,tag:T3wj5pPUD3xqrFo5oTGgGA==,type:str]
            numInitChildren: "30"
            maxPool: "6"
            connectionLifeTime: "10"
        persistence:
            size: 10Gi
        persistentVolumeClaimRetentionPolicy:
            enabled: true
        backup:
            enabled: true
            cronjob:
                storage:
                    storageClass: replicated
                    size: 10Gi
sops:
    kms: []
    gcp_kms: []
    azure_kv: []
    hc_vault: []
    age: []
    lastmodified: "2024-04-07T20:49:41Z"
    mac: ENC[AES256_GCM,data:FpxyZOxAI1J43iozS2np5OYnB/okBYdhn3CGVH87NYKWtci+3Rn9aDE/jpTi+f8gKgKijXt9iqC5h1vaC/j+aKFzkzc1KIDhrT2Ui8CB43hRoCyvxJHRMw8U320cZGztmqx4vajd88pxg50oarvj68Tfv7HE0Xt4hZqUP97gHBo=,iv:4/hZbCa9uyQihqh3Ms5kszLReypJkZL2lemz8FbBSGk=,tag:BtVs2Y4V/err/odHdkb3aw==,type:str]
    pgp:
        - created_at: "2024-04-07T20:49:41Z"
          enc: |-
            -----BEGIN PGP MESSAGE-----

            hJ4D0dRkdsWQFPUSAwMEzoVEkwsLjZuB922A15zDJpI5oYPr9W+XejPqOob53kae
            OVdj9Ew3Y6B2y/QT6y+fpOSingJu97iLWIVH05F3sJvGEZEIwJfa50L87vIOQqiw
            YO5093RJtdM0yTKEhJXVMAiw0/jgjsFX1QrmUYiu/p4nB05fnOkpOd5ZY4rAZScU
            9qUF1Xb2i++cBDzoEGM2+dRmAQkCEM+dc+yS1JhY2HfF+xKbJtIgGG7CowLBgLRz
            rL96AixYHtza+Loff+gQ+guhqOT+faNJXzOpCNeFIKBjATCdtfE/2LOvE64h4KS8
            YkKG+UUdkX864ZXbQHL1S+GOCKxSifze
            =JY2D
            -----END PGP MESSAGE-----
          fp: 0F003E832B1DA1A11CA9F206712F90FA248BBBC2
        - created_at: "2024-04-07T20:49:41Z"
          enc: |-
            -----BEGIN PGP MESSAGE-----

            hJ4DLG005yzvDc8SAwMEAb4cYwAt11NKQLkASoKSY7g4MeI/P7nGrqPnlOMfLIf8
            BL2MY4e48qepaqj0AMbcfgPbsPW2gWVAPJNeanBAzgwTlq1DP0I9AlAYuUdIi5V/
            7p8HWQVndm20rwXEM8HkMP2Ai7jcocHBjWIbkKP5T/lew78ThGlrKiBk3iAnuV5d
            gfJnfvUtYKbzlTjA+/0UG9RmAQkCEDL2KZ4sE+ttS7TF2dJYc0nDZ3AdjTVYGKVg
            DbYXGYg/EJXbKf/EnvWqrla+4PcyopRJMUxJ+FavtVGFF7+xHJ2jBgOHFsDNiwjc
            0kd7/BH8tBgfSSn0p9yD17EVt4QwlHwV
            =ejrt
            -----END PGP MESSAGE-----
          fp: 1918B94484C52CDE42CA1B87E7812096B8DA4A52
    encrypted_regex: ^(password|repmgrPassword|adminPassword|postgresPassword)$
    version: 3.8.1
