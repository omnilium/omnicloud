apiVersion: helm.toolkit.fluxcd.io/v2beta1
kind: HelmRelease
metadata:
    name: postgres
    namespace: onedev
spec:
    interval: 10m0s
    chart:
        spec:
            chart: postgresql-ha
            version: '>=14.0.2 <14.1.0'
            sourceRef:
                kind: HelmRepository
                name: bitnami
                namespace: onedev
            interval: 1m
    values:
        global:
            postgresql:
                username: onedev
                password: ENC[AES256_GCM,data:PAgWPTCNrpj/sIPxBT8fAf+Y1W3vw+UV3k5aDI7bE7w=,iv:ZKuePLQB9XUavJhwEHM6tmmd2lE4G+E9nl6CgD5MJG8=,tag:5ka/v+YdPQBgz0By0hZeJA==,type:str]
                database: onedev
                repmgrUsername: repmgr
                repmgrPassword: ENC[AES256_GCM,data:fNEaphDEsz66j9hgh922TakCbznuVGB9YYAuw7MqlQA=,iv:Uuw2/kKsJou6qdIv+gqSDdTSRd/qF+th80vqjvBCX2Q=,tag:VEUREwHoEpAFXfXvRcbKzw==,type:str]
            pgpool:
                adminUsername: pgpool
                adminPassword: ENC[AES256_GCM,data:iik7QAtPXSKwuHfwR4eNLVTIItAl7Xy7H5Vd+hnfi8Q=,iv:e/kYh27tuNQEAxIoetkoLZQkiip8MwkrYyeLHwybnVc=,tag:K1UTacedxUmks67A1uIL8Q==,type:str]
        postgresql:
            podLabels:
                app.omnilium.local/identifier: postgres-onedev
            affinity:
                podAntiAffinity:
                    preferredDuringSchedulingIgnoredDuringExecution:
                        - weight: 100
                          podAffinityTerm:
                            labelSelector:
                                matchLabels:
                                    app.omnilium.local/identifier: postgres-onedev
                            topologyKey: topology.omnilium.local/host
            topologySpreadConstraints:
                - labelSelector: null
                  matchLabels:
                    app.omnilium.local/identifier: postgres-onedev
                  topologyKey: topology.kubernetes.io/zone
                  maxSkew: 1
                  whenUnsatisfiable: ScheduleAnyway
            extraVolumes:
                - name: dshm
                  emptyDir:
                    medium: Memory
                    sizeLimit: 256Mi
            extraVolumeMounts:
                - name: dshm
                  mountPath: /dev/shm
            resourcesPreset: medium
            password: ENC[AES256_GCM,data:41npI+WUfU98R4wD/8jgFPSFiVNnZHHiFt235Nofrsg=,iv:pJesuoJb6RlJGtvxHs4Tqf6lO4YmJJ6Qx1pPU2FcKII=,tag:p6s9bridvp6mbBKAsRX4mQ==,type:str]
            postgresPassword: ENC[AES256_GCM,data:YG0Uhs0z7WqiFI1AVNoC4McImu2z/AKtrL+u3atg1MU=,iv:UgmvxJ9kKLlqHH28rFMybf2PX9ohVzBaCde4026ksMw=,tag:OJ1DC4acvr8RgDkSBW5a1g==,type:str]
            repmgrPassword: ENC[AES256_GCM,data:0neTOOaZuQAKTZXjDXj3qPB1JcDnXYT4GqMVkSqTun8=,iv:o321zarvLBWeWNeUZTTKlv9J42rWH/mioZOEpVpbTXQ=,tag:Q6K7Dj+Zf7vyPWsgONu+3Q==,type:str]
            maxConnections: 300
            postgresConnectionLimit: 20
            dbUserConnectionLimit: 280
        pgpool:
            resourcesPreset: small
            adminPassword: ENC[AES256_GCM,data:s7Jrd+woyAhZ0CDC4pgzxvvI8aelo/skmdopne6Y8yc=,iv:1KddSFj/hLMQBuWQ2RcYkQg1EZ1dQ3tVfRaGb2Her5I=,tag:v8xvg04P6B3hdtFRrMSctw==,type:str]
            numInitChildren: "35"
            maxPool: "8"
            clientIdleLimit: "0"
            connectionLifeTime: "0"
        persistence:
            size: 10Gi
        persistentVolumeClaimRetentionPolicy:
            enabled: true
        backup:
            enabled: true
            cronjob:
                storage:
                    storageClass: replicated
                    size: 10Gi
sops:
    kms: []
    gcp_kms: []
    azure_kv: []
    hc_vault: []
    age: []
    lastmodified: "2024-04-07T20:44:26Z"
    mac: ENC[AES256_GCM,data:iblXopvnMEBnl7/tcNu3OTzRdzjE8mpa6mgPGCzaXOmYwgf36UsAvLWLfykTKH8DRzUz9cl11gpw3AZ/HZK0qausTGU9EDHSQeiJO2xt5Qu7BBtk0+RaJ6nAhZSgp0vmES9M6z/4lLfQOdufjW1ybnPa9lYNtOrYU33Ny+tDLho=,iv:+U/QiUYGkE/pYhCJBy35vBtQoHgj+tZE/r6VOR50iQQ=,tag:2P5Zi47cGhVsvS1+4uHlPw==,type:str]
    pgp:
        - created_at: "2024-04-07T20:44:26Z"
          enc: |-
            -----BEGIN PGP MESSAGE-----

            hJ4D0dRkdsWQFPUSAwMEuBQYPfCawznUr8gN6dI0x71fWxzdjDnzyt6QOW9Vqhur
            O10hXqXyo8Sg4lH9fewkldIDnkOsE2VgalCIX+fytBVzcXuBp4jAgvjArI0RiNfW
            OZGk9KeBUHs5ktBzWsfvMCAIFa08NjaKnWW8881mBMNW6TREJU90E9F+T/gPkZnG
            U8w22y3QCa7AlWt2UM+tsNRoAQkCEHjvSw7f7nTcq5cEGiTueSBU9s4UF+wGjZ+L
            a6Vfx1+/0dfrNUR1AijzV2vKCKpBlucHJc1851Sf2Zz/zv4iUE824aRr2rl7zJHV
            zBI0Br1Xjx/sPmHy+D2wwUQgC1daV+8L2mQ=
            =+ocW
            -----END PGP MESSAGE-----
          fp: 0F003E832B1DA1A11CA9F206712F90FA248BBBC2
        - created_at: "2024-04-07T20:44:26Z"
          enc: |-
            -----BEGIN PGP MESSAGE-----

            hJ4DLG005yzvDc8SAwMEoj4e5e1y80udlrV7M5pj6wH1IDj1R4RqsfFrEzywW05a
            JKTgHZnmG3BTQnq6k9hPwrKkhu1UIMmzYXt6nTDve9F86OqUfOwevudpylRcYMYR
            BMBxD6nPuhUQQINnmCtjML6vI4OtR7YiHf7dv3nbdY9+OMZez2SmHSwUWjAQ2bXM
            mn5PNkXGgbGPFAl+OgUkFdRoAQkCEFsq6c+VIahk4FojuUEqNiIQtCRSCpvvNXug
            NB0H6rUll+j0K++rv0TIacq6qxjkP84iJ5OeJGqsM2KspwFsvc7Ajt3mfKTgEqWL
            N6AgSUYU2aIU989fGt5KV3nTcDreL6li/5M=
            =BwYu
            -----END PGP MESSAGE-----
          fp: 1918B94484C52CDE42CA1B87E7812096B8DA4A52
    encrypted_regex: ^(password|repmgrPassword|adminPassword|postgresPassword)$
    version: 3.8.1
