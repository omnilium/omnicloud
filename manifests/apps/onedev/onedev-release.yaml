apiVersion: helm.toolkit.fluxcd.io/v2beta1
kind: HelmRelease
metadata:
    name: onedev
    namespace: onedev
spec:
    interval: 10m0s
    chart:
        spec:
            chart: onedev
            version: '>=10.4.0 <10.5.0'
            sourceRef:
                kind: HelmRepository
                name: onedev
                namespace: onedev
            interval: 1m
    values:
        onedev:
            replicas: 3
            initSettings:
                user: admin
                password: ENC[AES256_GCM,data:1LMJtadTVSrRIq1esCRw/V1SB7ronJj/YzsKobd4r6k=,iv:2udbdJTgHZu0hENDOgXXxrVvNWgtvC486E36Pf3qivA=,tag:xEBW0eB3W4om379aU6bHpw==,type:str]
                email: webmaster@omnilium.com
        database:
            external: true
            type: postgresql
            host: postgres-postgresql.onedev.svc.cluster.local
            port: "5432"
            name: onedev
            user: onedev
            password: ENC[AES256_GCM,data:FLtU4zeQEBiGlUPPufgPm4scw6Az0YeuGGeGwvKrAzs=,iv:rpDLY5BrDNBskKnLW5gxK5vhBLXO3FLBnD6+WpvAKz0=,tag:ze5mcCqiqdTK9nRrmGzy5w==,type:str]
            maximumPoolSize: "30"
        podLabels:
            app.omnilium.local/identifier: onedev
        resources: {}
        affinity:
            podAntiAffinity:
                preferredDuringSchedulingIgnoredDuringExecution:
                    - weight: 100
                      podAffinityTerm:
                        labelSelector:
                            matchLabels:
                                app.omnilium.local/identifier: onedev
                        topologyKey: topology.omnilium.local/host
        topologySpreadConstraints:
            - labelSelector:
                matchLabels:
                    app.omnilium.local/identifier: onedev
              topologyKey: topology.kubernetes.io/zone
              maxSkew: 1
              whenUnsatisfiable: ScheduleAnyway
        service:
            annotations:
                traefik.ingress.kubernetes.io/service.sticky.cookie: "true"
                traefik.ingress.kubernetes.io/service.sticky.cookie.name: glue
                traefik.ingress.kubernetes.io/service.sticky.cookie.secure: "true"
                traefik.ingress.kubernetes.io/service.sticky.cookie.samesite: strict
            separateSSH:
                enabled: true
        ingress:
            enabled: true
            annotations:
                cert-manager.io/cluster-issuer: acme
                traefik.ingress.kubernetes.io/router.middlewares: onedev-circuitbreaker@kubernetescrd,onedev-ratelimit@kubernetescrd,onedev-retry@kubernetescrd
            host: git.omni.ms
            tls:
                enabled: true
                secretName: onedev-tls
        persistence:
            storageClassName: replicated
            size: 20Gi
sops:
    kms: []
    gcp_kms: []
    azure_kv: []
    hc_vault: []
    age: []
    lastmodified: "2024-04-07T21:51:31Z"
    mac: ENC[AES256_GCM,data:SovUPmYE6k6/monkqUVM+MFkl4DWwgO2ldZycbwe8JV4FLjuZ111PMHrYgaHCmTdHectfIE4WutZizfOXJ8qObgLnMypg7gHMTJIL6vzF1j92mlYvOp2a/AScr38NX8d60GNku3tKFOY7VK1KIL46prKW+Zv4Mp62yTcgsT8pyo=,iv:Bw926diH0Qcez9Hk+FfI9Wjiyy4TXd0XIhkunV4iUZU=,tag:FGuNa4EMA4Mnv3KAL3gnZg==,type:str]
    pgp:
        - created_at: "2024-04-07T21:51:31Z"
          enc: |-
            -----BEGIN PGP MESSAGE-----

            hJ4D0dRkdsWQFPUSAwME/SdnSPO/LyaiisDhxMjh5BpgivpjwgpFD7R/Jr4aBSKa
            FFKZiR47HgGgmiQ9vZlvZdTeJG0WI7+2RbUZsESQspquRMacehdeb8Hm/+QM/tjI
            T2wvM8kybQUVuE0sjNrqMF4vO78iv9lvgaD1pALR87fNcUcY3A0N/W52B5sjuNjM
            uLpcg3stCn2RCURl5GSfltRoAQkCEI89Mvcy8Lp93M1J8adZjN0DNfZdkU1aIxxw
            EUilYHgVdkBzvDqNiyPJzSOnumB8RSuf7YiCmlMFcw+34F0GomMCzPj3IQrxu/e2
            vbeMMTbYC+jioLlocrrb9cIS4W2+F5p3b8E=
            =vQgp
            -----END PGP MESSAGE-----
          fp: 0F003E832B1DA1A11CA9F206712F90FA248BBBC2
        - created_at: "2024-04-07T21:51:31Z"
          enc: |-
            -----BEGIN PGP MESSAGE-----

            hJ4DLG005yzvDc8SAwMERvEt8DQxhzLH6sSkzqdtYbssnTpHq+D9uxn7r4O9iQrt
            nhV6x+DnU4nIEyVecCgNuEYdYGEcSRRToWz/i+cY+3Iah7LgL+Se15W5EfZCsIgu
            dgxpb2T1h1agySsdRO+bMMcqPbbgGKbG8H4IusAppacnVOS+TYm8cicAOI0kv/ts
            CdgnA+tr96SKgO0B6WuoStRoAQkCEClfr1AXFxwRfg0678wdDE6X4vQsY8dVJOPh
            7rH8rH4HvT/UHDS72jxBWpCfzVykg1dWBJbVy3wSfuU1Pf8KuNWGcINC+MMHPGuK
            fJDK3fX5hN3qogbhk1IFVXsUDZzS884BaEY=
            =FbEU
            -----END PGP MESSAGE-----
          fp: 1918B94484C52CDE42CA1B87E7812096B8DA4A52
    encrypted_regex: ^(data|stringData|password)$
    version: 3.8.1
