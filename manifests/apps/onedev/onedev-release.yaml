apiVersion: helm.toolkit.fluxcd.io/v2beta1
kind: HelmRelease
metadata:
    name: onedev
    namespace: onedev
spec:
    interval: 10m0s
    chart:
        spec:
            chart: onedev
            version: '>=10.4.0 <10.5.0'
            sourceRef:
                kind: HelmRepository
                name: onedev
                namespace: onedev
            interval: 1m
    values:
        onedev:
            replicas: 1
            initSettings:
                user: admin
                password: ENC[AES256_GCM,data:ito9Zi1aA6wTeeT3hz1zRvrE5a/XzaibUaPIZkReM4w=,iv:+KuILer8JksQcEapczR6hbdqzODUa2dNS0XCwMpzMzU=,tag:15nswi20w3DZ8+vjOlDdEA==,type:str]
                email: webmaster@omnilium.com
        database:
            external: true
            type: postgresql
            host: postgres-postgresql-ha-pgpool.onedev.svc.cluster.local
            post: "5432"
            name: onedev
            user: onedev
            password: ENC[AES256_GCM,data:UDve+kKytjQ3+mCaN/Z/vd+/KmRM4E9goaHEoLXgRps=,iv:d4H1qZVIKsxRU8qEsrxHT5M3/VWo4w1cjX53vHLWA+E=,tag:lXnETRxujo/P8jPoit7ycw==,type:str]
            maximumPoolSize: "200"
        podLabels:
            app.omnilium.local/identifier: onedev
        resources: {}
        affinity:
            podAntiAffinity:
                preferredDuringSchedulingIgnoredDuringExecution:
                    - weight: 100
                      podAffinityTerm:
                        labelSelector:
                            matchLabels:
                                app.omnilium.local/identifier: onedev
                        topologyKey: topology.omnilium.local/host
        topologySpreadConstraints:
            - labelSelector:
                matchLabels:
                    app.omnilium.local/identifier: onedev
              topologyKey: topology.kubernetes.io/zone
              maxSkew: 1
              whenUnsatisfiable: ScheduleAnyway
        service:
            # Max age not supported yet. Wait for Traefik 3.0
            # annotations:
            #     traefik.ingress.kubernetes.io/service.sticky.cookie: "true"
            #     traefik.ingress.kubernetes.io/service.sticky.cookie.name: glue
            #     traefik.ingress.kubernetes.io/service.sticky.cookie.secure: "true"
            #     traefik.ingress.kubernetes.io/service.sticky.cookie.maxAge: "3600"
            separateSSH:
                enabled: true
        ingress:
            enabled: true
            annotations:
                cert-manager.io/cluster-issuer: acme
            host: git.omni.ms
            tls:
                enabled: true
                secretName: onedev-tls
        persistence:
            storageClassName: replicated
            size: 20Gi
sops:
    kms: []
    gcp_kms: []
    azure_kv: []
    hc_vault: []
    age: []
    lastmodified: "2024-04-07T20:36:42Z"
    mac: ENC[AES256_GCM,data:eQMxycpm0LrJauF69UF96AACNYXLkYzZRJtuIRI20sRx3sRuD1fvgEBscoJryQLWaZDN5jtH3Qgq75qdrQY6yTE5FIRJewmVWohx9bB8tfd/ZIhc0TeBbRJo4Mo0iwfI5bw+QPxxJm0xojYzNTtq/A2ccOIxiq+EYgELHmLKY/U=,iv:1RF/AEixG4KsXVvTLZuvzqy6XKQ1dPh7ewqxbqD/Wkk=,tag:YUe8oJReZhOuq48CQyCm9A==,type:str]
    pgp:
        - created_at: "2024-04-07T20:36:42Z"
          enc: |-
            -----BEGIN PGP MESSAGE-----

            hJ4D0dRkdsWQFPUSAwMErz9oF3SBYqhl0UDP64gRm5Ugdqmj5TkbwWc4RpRFrNPk
            24QwAS1kZceDToCf/caXFLgRFFNarYFDZKPAM/mwFx5vShOy1AJMlHlxT5T3g/eE
            3T41BfMRrp8PTzju4ybUMAGbwuU5deRX/ieyRmw/x6oSbIKCV2/t9h+JFxuoypHo
            y2D1wE8bxxLmCn1w4jysINRmAQkCELUHS2vQYLyqv9+jSVIat0G7o5QQYMcPD5B5
            D+cFaAjcHCcs/218W5vmcjIC44fWBv+knbsJtOFbLhHgdYzHmVJWbrOAHU4iK3Fs
            5H013sTNcWRBH5a2Qu6ln11Pr+r76sR2
            =OmeV
            -----END PGP MESSAGE-----
          fp: 0F003E832B1DA1A11CA9F206712F90FA248BBBC2
        - created_at: "2024-04-07T20:36:42Z"
          enc: |-
            -----BEGIN PGP MESSAGE-----

            hJ4DLG005yzvDc8SAwMEaBx48jZNGPc9L4i12JIbuN3V/H/AdRjYceByB4/GMEec
            /9QF42+JpiWsZ/MUbLRw6orlDFrObe1sADGKlYEG/zMyIOvs6rtyCnrPp2hcK3wk
            lhyXBQBR5KHY6GRlR/H9MHxXJGKFVJWZzxt3b8j2akLHTNgSI9c+spTmGDf/gC/R
            7LU0i2YBcJzet/Nlj3fI6NRmAQkCEHHUeV1ZXqGw+f+cHVafUEbrKSlRf6t0CzRk
            B9Fnmq2MbBXWiPt+RG26ByJT26h1I4RgCO2hk32FiUVqLDiNKIHUBm72jXbMcO+0
            x57DuO0rQFsw+ZOmjkFe8OkrjCjUk4pg
            =x+T9
            -----END PGP MESSAGE-----
          fp: 1918B94484C52CDE42CA1B87E7812096B8DA4A52
    encrypted_regex: ^(data|stringData|password)$
    version: 3.8.1
