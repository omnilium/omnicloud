apiVersion: helm.toolkit.fluxcd.io/v2beta1
kind: HelmRelease
metadata:
    name: onedev
    namespace: onedev
spec:
    interval: 10m0s
    chart:
        spec:
            chart: onedev
            version: '>=10.4.0 <10.5.0'
            sourceRef:
                kind: HelmRepository
                name: onedev
                namespace: onedev
            interval: 1m
    values:
        onedev:
            replicas: 1
            initSettings:
                user: admin
                password: ENC[AES256_GCM,data:ztMnQGz1dUuklakKC9pyp9CGvEXvs/sE83NkomWxjQ0=,iv:OEgnt4BZK1FDWfnD5E8cZJS8jEvSntgKA1UNkPmZfX8=,tag:1yVt/P+b0OykSzyioZtVxg==,type:str]
                email: webmaster@omnilium.com
        database:
            external: true
            type: postgresql
            host: postgres-postgresql-ha-pgpool.onedev.svc.cluster.local
            post: "5432"
            name: onedev
            user: onedev
            password: ENC[AES256_GCM,data:VAhwLIa3EBBLlPnl1ay3DtIhsMOLoomQqgqNnxWrWPc=,iv:UaTVVsmdPEtCfWl3Xh71qVZhZ/D9o0Ve21Gw3PmNEeM=,tag:oWaJ+DTX8ytgWkSXG872vw==,type:str]
            maximumPoolSize: "200"
        podLabels:
            app.omnilium.local/identifier: onedev
        resources: {}
        affinity:
            podAntiAffinity:
                preferredDuringSchedulingIgnoredDuringExecution:
                    - weight: 100
                      podAffinityTerm:
                        labelSelector:
                            matchLabels:
                                app.omnilium.local/identifier: onedev
                        topologyKey: topology.omnilium.local/host
        topologySpreadConstraints:
            - labelSelector:
                matchLabels:
                    app.omnilium.local/identifier: onedev
              topologyKey: topology.kubernetes.io/zone
              maxSkew: 1
              whenUnsatisfiable: ScheduleAnyway
        service:
            annotations:
                traefik.ingress.kubernetes.io/service.sticky.cookie: "true"
                traefik.ingress.kubernetes.io/service.sticky.cookie.name: glue
                traefik.ingress.kubernetes.io/service.sticky.cookie.secure: "true"
                traefik.ingress.kubernetes.io/service.sticky.cookie.maxAge: "3600"
            separateSSH:
                enabled: true
        ingress:
            enabled: true
            annotations:
                cert-manager.io/cluster-issuer: acme
            host: git.omni.ms
            tls:
                enabled: true
                secretName: onedev-tls
        persistence:
            storageClassName: replicated
            size: 20Gi
sops:
    kms: []
    gcp_kms: []
    azure_kv: []
    hc_vault: []
    age: []
    lastmodified: "2024-04-07T20:32:27Z"
    mac: ENC[AES256_GCM,data:zqnJxmSsRaXwppfF05z0dhah7NH2ZSImvL0cCvm815NyTB0XJvApEJAmuTVgbOqA8xU40OLtre0wfulc5mvjkzGKutJaKz6sPpzxHnUe16CA4nO0J0anG6uztktLwu+WfnY7Fwhq5VKMe6NEI21nwhmw7z74keSFk62AcXJvUUw=,iv:AM9tyDji7JUzXGTUrEC94PIJe/j2epaOUWegVcMdtM4=,tag:YGb+okc/oJ+wJwQbHdScWw==,type:str]
    pgp:
        - created_at: "2024-04-07T20:32:27Z"
          enc: |-
            -----BEGIN PGP MESSAGE-----

            hJ4D0dRkdsWQFPUSAwMEX8M6botvdeCKwcFR4lpBMQAPrAdr5WOvUvyYsT9gZ+dP
            YgQ8qAw5Vpqmf3MGBrUUYVON1QRwtKNHteRwiMD8vCdWxC667n0q/lJGi+0vnfs8
            suSyvt8HAHR38eCVC+LkMOWOPKWA0o4TdJoKw/2MUabVMyEp2Ydu4XXYMx6GAEAs
            l8+kmEsyv3uwV/PcWKU3etRmAQkCEAWlNJ6UhT2HXi4fEhUszksEhsuyd1itn0H8
            wFdDr4Jf2dTp/xS/u9lmW7Dffy58PD7IO7zZmQWIu04rqC1dXwoGqUQtBgbOQmw6
            sDyoa0z3uWPkdoCd1gMRxIb0Sj6lVcl2
            =Jw7O
            -----END PGP MESSAGE-----
          fp: 0F003E832B1DA1A11CA9F206712F90FA248BBBC2
        - created_at: "2024-04-07T20:32:27Z"
          enc: |-
            -----BEGIN PGP MESSAGE-----

            hJ4DLG005yzvDc8SAwMETlZkW41UKLY5lZoDs79U3eKGY4ACVudEFCgasTVPmuZw
            XxhKqRMSPPr20yU5MRXsX/u2dmCPZej0KeJgPt0XhfINc5eXT+dGWWIgw9o92fa/
            0IzjyTnw/UCZvXMq3ukLMIfN8uWiGbDhAzTMvfqfI9kx4ZViyJpEmPLeCJcxRJiC
            N/bh2NQfC4XxIFGO90eTPdRmAQkCEHdspmIWmtBqBnpWdIperSOJe9GlZzw3mKyD
            mkedgEq5drD9Q+KOIyDvskqwwTMqUsb7TzlEMcwPfpgo/1QE1KNysCKRBcSue8Q2
            Cmi/ihC3J3uhf/X+QVuQG2ntKqqEOL7m
            =N+lN
            -----END PGP MESSAGE-----
          fp: 1918B94484C52CDE42CA1B87E7812096B8DA4A52
    encrypted_regex: ^(data|stringData|password)$
    version: 3.8.1
