apiVersion: helm.toolkit.fluxcd.io/v2beta1
kind: HelmRelease
metadata:
    name: onedev
    namespace: onedev
spec:
    interval: 10m0s
    chart:
        spec:
            chart: onedev
            version: '>=10.4.0 <10.5.0'
            sourceRef:
                kind: HelmRepository
                name: onedev
                namespace: onedev
            interval: 1m
    values:
        onedev:
            replicas: 1
            initSettings:
                user: admin
                password: ENC[AES256_GCM,data:CbpxqqIIxP94Uk2AWfSRzMzppxWVgrLptAa0/NLq2Ps=,iv:fSDPw3RvMBuDerMxjhBa39Eqjm8fvtgoL7VQoi3a9as=,tag:b+xdbTF/Ns9H5tQa8jLeww==,type:str]
                email: webmaster@omnilium.com
        database:
            external: true
            type: postgresql
            host: postgres-postgresql-ha-pgpool.onedev.svc.cluster.local
            port: "5432"
            name: onedev
            user: onedev
            password: ENC[AES256_GCM,data:URV7m5mBi8QY6fNd9G18TkgKIYT4Y49u/8Tp4LGET4U=,iv:yKndpGfKnVeEhPGEjc6vCUscK8f6sIJ8A3DN1AKdzjs=,tag:oic9FK2gs10mg6ypzvvtig==,type:str]
            maximumPoolSize: "200"
        podLabels:
            app.omnilium.local/identifier: onedev
        resources: {}
        affinity:
            podAntiAffinity:
                preferredDuringSchedulingIgnoredDuringExecution:
                    - weight: 100
                      podAffinityTerm:
                        labelSelector:
                            matchLabels:
                                app.omnilium.local/identifier: onedev
                        topologyKey: topology.omnilium.local/host
        topologySpreadConstraints:
            - labelSelector:
                matchLabels:
                    app.omnilium.local/identifier: onedev
              topologyKey: topology.kubernetes.io/zone
              maxSkew: 1
              whenUnsatisfiable: ScheduleAnyway
        service:
            separateSSH:
                enabled: true
        ingress:
            enabled: true
            annotations:
                cert-manager.io/cluster-issuer: acme
            host: git.omni.ms
            tls:
                enabled: true
                secretName: onedev-tls
        persistence:
            storageClassName: replicated
            size: 20Gi
sops:
    kms: []
    gcp_kms: []
    azure_kv: []
    hc_vault: []
    age: []
    lastmodified: "2024-04-07T20:44:38Z"
    mac: ENC[AES256_GCM,data:9NJ3IkIuAcISGDDA8UA7Etbd0c5skBx8J0QikBy7xxrssCznC/xMwH8I93rSQXkfO9sHIMBzMF9aJXIeHNLkZEKxkkykdtovCuzI1rt2WW8u+Q/TZYVG6BRgWPvpukKuDY2AodwMVo4J3msOQOnZd7IHOxTFbjM6v9CmLT08MNY=,iv:szQvIJeR8T3p9zBU6680SovdaFx4Kj8BiXWCXXVOLKM=,tag:IbLXG4VE8VhLwBcQsVtLKw==,type:str]
    pgp:
        - created_at: "2024-04-07T20:44:38Z"
          enc: |-
            -----BEGIN PGP MESSAGE-----

            hJ4D0dRkdsWQFPUSAwMEDNBa1iUfUL1uKhvfQaKCVMj/tn8SwazrlDRZz5/hwVN4
            a9EEzmXzi2yvpcp3eMo2L7LLBo5wKuNCGkyLYwrBRxuq5Qm7bTyo8SoSNe0x/htl
            93H1gD7V1ml8GD5aWNO9MNvl99/2f+9Svi+zKXb/satpQPW06dfFaeYNNP8F7Zh+
            x8wrbgLeu22Vd4l4yNtuq9RoAQkCEPmxbke2CWbl3iKXgD01gybYb16slZkhfiAp
            dalao9Rj7QJzDyZbVX1RGWrydwMwcAHx3O989yr7hwi68tgd2FKyHzPHJzjnAsfQ
            Prh7Yae1jNwyJH5pEs38nKpJ45zKxue12XI=
            =efX4
            -----END PGP MESSAGE-----
          fp: 0F003E832B1DA1A11CA9F206712F90FA248BBBC2
        - created_at: "2024-04-07T20:44:38Z"
          enc: |-
            -----BEGIN PGP MESSAGE-----

            hJ4DLG005yzvDc8SAwMEri2BH99SMbzLh3d9x5p5pHbvzUN0ZQBgzWkafPvaggMc
            SLyHzkfScU48NVt8UCHy18vpFbJXZJ4xgSmKZ4yzxnzEkdXPErjK1V+YpM2TvNvN
            4nj+5+JGqwNr0Vi9CcTcMINff64KDAPGkL0Ot1YQL/EJHFXDDcUw+1K8Mvils9B3
            6jXmwCzRCxipmNdACuI8AtRoAQkCEM9GP1LWzcxBKcaLikPDjOk7bIuWdRgBE2+R
            UbKPYyn4Ub3ZjMSCr76wHQUp44AnZFng1tBn/4J3tZSi9MiNunpdAR+CHYDJcfvI
            VZPpwVLJUcx3SpMcKs7vOYqWGRwt/1VAqT0=
            =4Wb9
            -----END PGP MESSAGE-----
          fp: 1918B94484C52CDE42CA1B87E7812096B8DA4A52
    encrypted_regex: ^(data|stringData|password)$
    version: 3.8.1
