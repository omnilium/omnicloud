apiVersion: helm.toolkit.fluxcd.io/v2beta1
kind: HelmRelease
metadata:
    name: onedev
    namespace: onedev
spec:
    interval: 10m0s
    chart:
        spec:
            chart: onedev
            version: '>=10.4.0 <10.5.0'
            sourceRef:
                kind: HelmRepository
                name: onedev
                namespace: onedev
            interval: 1m
    values:
        onedev:
            replicas: 1
            initSettings:
                user: admin
                password: ENC[AES256_GCM,data:ZMoPZrYyzhtTYs8zqO0Yq4JPT8c6rJvjxXdebbLUFXU=,iv:BCuuj7cEKni1Rn42VJBjX1CYbWnutFlcI72nRwLkrr8=,tag:mpGc6+ohXodGQx/Z9bTfxw==,type:str]
                email: webmaster@omnilium.com
        database:
            external: true
            type: postgresql
            host: postgres-postgresql-ha-pgpool.onedev.svc.cluster.local
            post: "5432"
            name: onedev
            user: onedev
            password: ENC[AES256_GCM,data:xDUJoQwf6RcXxKZWVQhZgoH/eImiX9rAWBdOt7Wbi/o=,iv:8uK5jNhJd6yIHdhlYltbIbLSvd4QeNsJ1b0/PCqTaz4=,tag:u+EkWdBeU/bsR/WAfBplmw==,type:str]
            maximumPoolSize: "200"
        podLabels:
            app.omnilium.local/identifier: onedev
        resources: {}
        affinity:
            podAntiAffinity:
                preferredDuringSchedulingIgnoredDuringExecution:
                    - weight: 100
                      podAffinityTerm:
                        labelSelector:
                            matchLabels:
                                app.omnilium.local/identifier: onedev
                        topologyKey: topology.omnilium.local/host
        topologySpreadConstraints:
            - labelSelector:
                matchLabels:
                    app.omnilium.local/identifier: onedev
              topologyKey: topology.kubernetes.io/zone
              maxSkew: 1
              whenUnsatisfiable: ScheduleAnyway
        service:
            annotations:
                traefik.ingress.kubernetes.io/service.sticky.cookie: "true"
                traefik.ingress.kubernetes.io/service.sticky.cookie.name: glue
                traefik.ingress.kubernetes.io/service.sticky.cookie.secure: "true"
                traefik.ingress.kubernetes.io/service.sticky.cookie.maxage: "3600"
            separateSSH:
                enabled: true
        ingress:
            enabled: true
            className: traefik
            annotations:
                cert-manager.io/cluster-issuer: acme
            host: git.omni.ms
            tls:
                enabled: true
                secretName: onedev-tls
        persistence:
            storageClassName: replicated
            size: 20Gi
sops:
    kms: []
    gcp_kms: []
    azure_kv: []
    hc_vault: []
    age: []
    lastmodified: "2024-04-07T20:25:29Z"
    mac: ENC[AES256_GCM,data:PZrFqGHZ7arnWjPZZoh1K4aY6llZKRG2RxhIXgfrX6YnhIDgwFnKdf5dJ+sWTpLtoGFwYKUDXpYgDEb/Uq6bKIsF13isXSLPrAA8gkHtpLUUfio1d6Ec+ui/uUpHUH0GTtB8hG5RyPWCs2TxkzBkgKhfn0YEtpBD+Ws4JxOPI1Y=,iv:C3yEINLsAOak2cFcO5Q7HT/5+OEypsAFeXt7VqwEPPc=,tag:CJ2dQtNMkItGlUPxBHEutQ==,type:str]
    pgp:
        - created_at: "2024-04-07T20:25:29Z"
          enc: |-
            -----BEGIN PGP MESSAGE-----

            hJ4D0dRkdsWQFPUSAwMEWV98rHAcDg95xTPBVlVDtQhCDHGjuOlBJbhXMOij5v3w
            uaGzYnuazKa6aJ8jhSN+EUFGpI3mEVY4hrBwnpThmoTgK8uwQz8/HcmTA930GY4O
            b4tnMpajyrZWLpVHgWevMIMRy48wDWGKUxouzEAokCYmilu3R39gp3c8rJnG6+ne
            DY3cwIBdIDNn6KR73/StrdRoAQkCEB4qXSIvWBjcBFhp5BINIV1RwKx8AS3V/Y5N
            FWBdkQKw7tE9rkqi821sUluEmuFN6cxZKHST9kRVFpXChK0Fg8jSqhWVx67AP+2R
            X8te+gIpQ46CyThDiRW1K3l5N17iyykpdFw=
            =thmW
            -----END PGP MESSAGE-----
          fp: 0F003E832B1DA1A11CA9F206712F90FA248BBBC2
        - created_at: "2024-04-07T20:25:29Z"
          enc: |-
            -----BEGIN PGP MESSAGE-----

            hJ4DLG005yzvDc8SAwMEtOpnAZCvLx0w/upc0LIa0EfE1WOT1I5y1tsYveAgUZHO
            lRjGnjv3P4PdRIpzgP9P7sVy8oLBiiiX1EuP/xxzHANp6EIw3iq8XsyodGZLL85m
            luDAiWInVdDJx/4NM5X+MK7tihhN4AekKucsm5/gsG9Fou4PfipzHXd1QcfS1tzt
            VrR4HfwfB3mgiSlLGX+guNRoAQkCEItzqmGYyWPwveDdPKkpAF5RM+mRFmIvlN9l
            081n/CDkKA+Y9y7ZmUo3/TSVUi//vekIhJka5+ceK6nVQWkzJNtqI88WJQkIabDn
            +udOPOux1s/ndYO3NMTMFfpxklA7AjIxcpU=
            =5zLP
            -----END PGP MESSAGE-----
          fp: 1918B94484C52CDE42CA1B87E7812096B8DA4A52
    encrypted_regex: ^(data|stringData|password)$
    version: 3.8.1
