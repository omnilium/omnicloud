apiVersion: helm.toolkit.fluxcd.io/v2beta1
kind: HelmRelease
metadata:
    name: onedev
    namespace: onedev
spec:
    interval: 10m0s
    chart:
        spec:
            chart: onedev
            version: '>=10.4.0 <10.5.0'
            sourceRef:
                kind: HelmRepository
                name: onedev
                namespace: onedev
            interval: 1m
    values:
        onedev:
            replicas: 3
            initSettings:
                user: admin
                password: ENC[AES256_GCM,data:US9k6wuu4Pr7b5Mc5A81me1HEwgujtJNxQGB+fr2k+Q=,iv:eQFvB3R52bT4LGVCIW2vODUPWh/1qmoQyMMnXhntx6E=,tag:j/EG78y1qzj5DEaPLA9q1Q==,type:str]
                email: webmaster@omnilium.com
        database:
            external: true
            type: postgresql
            host: postgres-postgresql.onedev.svc.cluster.local
            port: "5432"
            name: onedev
            user: onedev
            password: ENC[AES256_GCM,data:NZBvubTTwp9x/1QmhpHzZdQepmBOH2ltKQouPdDxA/U=,iv:2Dk97HJ4Qx6ybtlZhgvfmY4pCm3XW4AObM84oU3dslE=,tag:MLSDN545U6kJLetXJphVew==,type:str]
            maximumPoolSize: "30"
        podLabels:
            app.omnilium.local/identifier: onedev
        resources: {}
        affinity:
            podAntiAffinity:
                preferredDuringSchedulingIgnoredDuringExecution:
                    - weight: 100
                      podAffinityTerm:
                        labelSelector:
                            matchLabels:
                                app.omnilium.local/identifier: onedev
                        topologyKey: topology.omnilium.local/host
        topologySpreadConstraints:
            - labelSelector:
                matchLabels:
                    app.omnilium.local/identifier: onedev
              topologyKey: topology.kubernetes.io/zone
              maxSkew: 1
              whenUnsatisfiable: ScheduleAnyway
        service:
            separateSSH:
                enabled: true
        ingress:
            enabled: true
            annotations:
                cert-manager.io/cluster-issuer: acme
            host: git.omni.ms
            tls:
                enabled: true
                secretName: onedev-tls
        persistence:
            storageClassName: replicated
            size: 20Gi
sops:
    kms: []
    gcp_kms: []
    azure_kv: []
    hc_vault: []
    age: []
    lastmodified: "2024-04-07T21:11:03Z"
    mac: ENC[AES256_GCM,data:bGcqe8p4n5u0vPl2zkhEp5rSFnvOh7pHrfjeB4e/tvctyTe4b9YzZ7jk2it6zsPsha6nq0HdH6HKRyrqpUx9fD7yFF6GFvV6rA1YAqgc4FzOLp+6hEDr2zB/Uocam4+OBRGBUMa+6HRx4KjtKy7HWIwx4ZfllzPWopx3f0F7m/Y=,iv:VbAnQKHDzw+zxHFI4YBHoXAgObTCaqWxiwqeTkNlpQk=,tag:3IfOwTXxMj125ZsVsZmTGg==,type:str]
    pgp:
        - created_at: "2024-04-07T21:11:03Z"
          enc: |-
            -----BEGIN PGP MESSAGE-----

            hJ4D0dRkdsWQFPUSAwMEHDNuvhpf+QvplPrFd/fgekTBdaTmh0GTBmOaPEP9oHFZ
            dSRUizbJIS2KoLorXJHvx9io5UAaYy7vvmMFy/3PpVwEMey9FONPKi298xzAzW84
            UA84ACpZglS2y4sGlBmJMGJNXCYd86R/69IcrtRJ8hydmaqAByGCNqy3T7Y8drY6
            PydbXonVo/xOSmDUhvwP09RmAQkCEHJkb6w5WdGL/6zT3jfXp2Ii8P5DarbQBZin
            PCzKdkgDL+ddFVM1HBWu9wVnxCR6faPLlfMOjjQiJogWbt6utDv2xd2ctRMk3ykl
            fiZZipUPfMQ0KSymwgv5fm+DYVrKWVhA
            =Ck+4
            -----END PGP MESSAGE-----
          fp: 0F003E832B1DA1A11CA9F206712F90FA248BBBC2
        - created_at: "2024-04-07T21:11:03Z"
          enc: |-
            -----BEGIN PGP MESSAGE-----

            hJ4DLG005yzvDc8SAwMEfB/Ipz3JFJDIsVJ4qcaDPna9TwVwBs1vLG65OBVLw8/z
            qXVQ3HrjCWM15inkIvH/h60B1ASWBUkkFAyGPPstNtnnmJRgIo8tkrHx1ucXr3aB
            YPfxYCR4u3kxFhkN4zH8MIJnfVSUz3/dww7AxQ6xIvVnG8/ewsmukLSQ0sVUZI21
            cgbYEJRJv2BAK9ZZaljBVtRmAQkCEHuk/mr9OVWdwa99uROjRAnFhj/jgq9+DGcF
            +RD5uDu6w6SnOv/mbpXo3/RB4cVOzw30PDUtGrwrOmbA+AfXIKazOWz1ONzQPL01
            xR6N7ls8f4Cf5qZ+jgIQLbDiQZV9pjJr
            =fX1c
            -----END PGP MESSAGE-----
          fp: 1918B94484C52CDE42CA1B87E7812096B8DA4A52
    encrypted_regex: ^(data|stringData|password)$
    version: 3.8.1
