apiVersion: helm.toolkit.fluxcd.io/v2beta1
kind: HelmRelease
metadata:
    name: onedev
    namespace: onedev
spec:
    interval: 10m0s
    chart:
        spec:
            chart: onedev
            version: '>=10.4.0 <10.5.0'
            sourceRef:
                kind: HelmRepository
                name: onedev
                namespace: onedev
            interval: 1m
    values:
        onedev:
            replicas: 1
            initSettings:
                user: admin
                password: ENC[AES256_GCM,data:kjFBlR50STj83x+LagU3Br+VSmJrkD735St7qbiy3eA=,iv:dI9O5GPb4fWKtEl194nOSPMQcPjaG8TZTrIKVdJCyrs=,tag:5A4XDie2/PUTolXzm/qMwA==,type:str]
                email: webmaster@omnilium.com
        database:
            external: true
            type: postgresql
            host: postgres-postgresql-ha-pgpool.onedev.svc.cluster.local
            post: "5432"
            name: onedev
            user: onedev
            password: ENC[AES256_GCM,data:pSWzuuxXTzpUk1+EzaLSnZoLEqKPXEGHjcRA0vobdgI=,iv:uhp6p8KUKkqikLu8TuhCftiZ/mDyLI0CjpZjjBhgKvQ=,tag:qC8zscvUKwleM8x7XtVndQ==,type:str]
            maximumPoolSize: "200"
        podLabels:
            app.omnilium.local/identifier: onedev
        resources: {}
        affinity:
            podAntiAffinity:
                preferredDuringSchedulingIgnoredDuringExecution:
                    - weight: 100
                      podAffinityTerm:
                        labelSelector:
                            matchLabels:
                                app.omnilium.local/identifier: onedev
                        topologyKey: topology.omnilium.local/host
        topologySpreadConstraints:
            - labelSelector:
                matchLabels:
                    app.omnilium.local/identifier: onedev
              topologyKey: topology.kubernetes.io/zone
              maxSkew: 1
              whenUnsatisfiable: ScheduleAnyway
        service:
            annotations:
                traefik.ingress.kubernetes.io/service.sticky.cookie: "true"
                traefik.ingress.kubernetes.io/service.sticky.cookie.name: glue
                traefik.ingress.kubernetes.io/service.sticky.cookie.secure: "true"
                traefik.ingress.kubernetes.io/service.sticky.cookie.maxage: "3600"
            separateSSH:
                enabled: true
        ingress:
            enabled: true
            annotations:
                cert-manager.io/cluster-issuer: acme
            host: git.omni.ms
            tls:
                enabled: true
                secretName: onedev-tls
        persistence:
            storageClassName: replicated
            size: 20Gi
sops:
    kms: []
    gcp_kms: []
    azure_kv: []
    hc_vault: []
    age: []
    lastmodified: "2024-04-07T20:20:02Z"
    mac: ENC[AES256_GCM,data:cAXQvZW8AM1ocwl14CRzYdu4BkRMjTQ9TJdzZW956krudDlXaOszqp4J388PeVKJA7Bkrzm3BPuquYbDXE/E1AhJuZZQx8MHU0g4wElwZn/hNQI9Gnb74MQl5zVUhQpREjVffv/S8UJegZJvDqcM10wG5b5sOuI3fhPis0c5ydw=,iv:djLBmkip4/f8eaWs+vHCiIVzTvx3Bszb8afljO4sTvs=,tag:flYWaj3zo1oV0bNYbIlTug==,type:str]
    pgp:
        - created_at: "2024-04-07T20:20:02Z"
          enc: |-
            -----BEGIN PGP MESSAGE-----

            hJ4D0dRkdsWQFPUSAwMEZ9H7vxy84Jk/ztnz/s3wcf486Zxl18rWv8OX9ejcAAUe
            nVHahK7BdZZ0OD616UYLfeyW6sHHB02Al+GF2vh/ADh10qtFLxEr8zs6sTZ1kpP1
            QO6hPFbRGKuXxVXEPKKyMBy4NpqHgd/4QDjyoLVwZl6aY326GrZR8SKiPN+EZlNV
            a3ws+DbCZuGA/w+RkFYJmdRoAQkCENP34pCuqKAFjFym2n1WN8kAV5t5QTNgC/hb
            Jb3q0fzvodQXvqBT4PI2FkXXn0GLR0slAzBhQ7yDYflLQr0d8Atybv7q+XISwVA7
            Ol7tOrKZcBCqx37jkBpz28NcCZmyxtC8o+c=
            =Zk+u
            -----END PGP MESSAGE-----
          fp: 0F003E832B1DA1A11CA9F206712F90FA248BBBC2
        - created_at: "2024-04-07T20:20:02Z"
          enc: |-
            -----BEGIN PGP MESSAGE-----

            hJ4DLG005yzvDc8SAwME/4OUhbFyQOPhgmuafWVAo9oW1PBtSuXAFXdfCIiWMek8
            W4aFSPUDsxtQS7t14FaR6lINDmjZm+HdtrYNnLjcndA53lRF74LWLoZkbnGrYIgU
            1tvVQFWvmTy6+V47c6c8MLAS+0N7ivMoPmqoTxk8Ru6aH8+3AMgguB0AK4jEF2Fd
            NNylreDAMwwWnPqsPPamt9RoAQkCEOyfu1ldrcNMsg2S0ZHNZlPsG+bc7gIvmwrV
            EKdsMKiCdm0CggsI7My0VMuWYLA0xnQeh9P821Q+UitlaGV5pGR/M7NYuShOimOB
            +dQnUfGPkBq3t0wyu5n5zCghTvi3+3bUF3U=
            =HAMz
            -----END PGP MESSAGE-----
          fp: 1918B94484C52CDE42CA1B87E7812096B8DA4A52
    encrypted_regex: ^(data|stringData|password)$
    version: 3.8.1
