apiVersion: helm.toolkit.fluxcd.io/v2beta1
kind: HelmRelease
metadata:
  name: minio
  namespace: gitlab
spec:
  interval: 10m0s
  chart:
    spec:
      chart: tenant
      version: ">=5.0.14 <5.1.0"
      sourceRef:
        kind: HelmRepository
        name: minio
        namespace: gitlab
      interval: 1m
  values:
    secrets:
      name: minio-env
      accessKey: gitlab
      secretKey: ENC[AES256_GCM,data:6tJMA1o4N8DPyC/7HoudbXqAmBMN3KExxmaEuC/8dcQ=,iv:6h1Yp3YqwKgVnwO5ntVk72zxlfbv9tiJqqvPH5gqkj0=,tag:FoHsOkjj5QcIKILKU4O2VQ==,type:str]
    tenant:
      name: gitlab
      configuration:
        name: minio-env
      pools:
        - name: minio-0
          volumesPerServer: 2
          size: 25Gi
          labels:
            app.omnilium.local/identifier: minio-gitlab
          affinity:
            podAntiAffinity:
              preferredDuringSchedulingIgnoredDuringExecution:
                - weight: 100
                  podAffinityTerm:
                    labelSelector:
                      matchLabels:
                        app.omnilium.local/identifier: minio-gitlab
                    topologyKey: topology.omnilium.local/host
          resources: {}
          topologySpreadConstraints:
            - labelSelector: null
              matchLabels:
                app.omnilium.local/identifier: minio-gitlab
              topologyKey: topology.kubernetes.io/zone
              maxSkew: 1
              whenUnsatisfiable: ScheduleAnyway
      certificate:
        requestAutoCert: false
      buckets:
        - name: gitlab-artifacts
          region: hel1
        - name: git-lfs
          region: hel1
        - name: gitlab-packages
          region: hel1
        - name: gitlab-uploads
          region: hel1
        - name: gitlab-mr-diffs
          region: hel1
        - name: gitlab-terraform-state
          region: hel1
        - name: gitlab-ci-secure-files
          region: hel1
        - name: gitlab-dependency-proxy
          region: hel1
        - name: gitlab-pages
          region: hel1
        - name: gitlab-backups
          region: hel1
        - name: tmp
          region: hel1
        - name: registry
          region: hel1
        - name: runners-cache
          region: hel1
    ingress:
      api:
        enabled: true
        annotations:
          cert-manager.io/cluster-issuer: acme
        tls:
          - secretName: minio-tls
            hosts:
              - storage.git.omni.ms
        host: storage.git.omni.ms
      console:
        enabled: true
        annotations:
          cert-manager.io/cluster-issuer: local
        tls:
          - secretName: minio-console-tls
            hosts:
              - gitlab.minio.omnilium.local
        host: gitlab.minio.omnilium.local
sops:
  kms: []
  gcp_kms: []
  azure_kv: []
  hc_vault: []
  age: []
  lastmodified: "2024-04-07T15:00:12Z"
  mac: ENC[AES256_GCM,data:Qx+8Vdtd1gg8ekjAOmkqXsrXL1WGDTpuzI+xxy/nW7QmvMikPF0phnhQaEZb/DzzA/qUiMa0WHt4RkgJjg9ivrrDQ/s0x3JBvg1Q5QQQ84VEfxY9UUs8MpVWTyFCHEnM9kiqE7NEgZzdzPaMnP+bq3bKCU4ebwBevWUA7D6jLFo=,iv:A/2svNbyiGs3C8hTO/9F0ZfTUc7/LunUy6xUKjWSu+k=,tag:JIhvZncjEszBKjRUXTk/3Q==,type:str]
  pgp:
    - created_at: "2024-04-07T15:00:12Z"
      enc: |-
        -----BEGIN PGP MESSAGE-----

        hJ4D0dRkdsWQFPUSAwME6XZ96YuO476QwkDWmCjy41FSEC4YZT2yB3Dn3juXfQ+p
        +yb5oDe0FG/qayPVrP4mB3GLxsyfU5fXqmnHVi74P8b20l8SPWBwMc7CJtvqn+VE
        QPiqEC9ZZXV48x4oE4IKMIZ2dGkYU+ThvF6Q3R7yYM4O4SgELZnS0WJaZGQl/xbl
        gDW/TiBnDII6zzd9EnCqfdRoAQkCEAD9MBUxLB6epQoZqKinvpbw3qjuUNYu3qvg
        Fb8fdwzxWqolz0yc0SWuuaYprkcyTqFAM4vx7mJ6wzpEyf9eT2YvbLcXDYLi7fzR
        b/MJ8hyQKiv7T76/diblic4NYQVbRbtOcQQ=
        =OinF
        -----END PGP MESSAGE-----
      fp: 0F003E832B1DA1A11CA9F206712F90FA248BBBC2
    - created_at: "2024-04-07T15:00:12Z"
      enc: |-
        -----BEGIN PGP MESSAGE-----

        hJ4DLG005yzvDc8SAwMEv6Lw7yGlx98wd8G1ZqYjoWXoIiOV90WfdN2TsYzXeMs2
        UnsojtzijxGlsIN+98XxBBjOCamrijwZE2t2L4VVTi/0aSk2F1ApzNqUSJtCtbXG
        8Fq0oYW2vJ9Yonw09So1MCTf8Df8SZDRgna7ismQYiqlghWRnetyTe976maue93H
        gAZIVrFtrkPk0GaAOikwB9RoAQkCEIwX+hR8uDxjs267WCcBGu9G/RnLO/oXpR4Z
        PkRf7fQCk18xOfTqI4bFW8dcRoVWwy5gsonkpuhCk646Dbq2MkaidG+FPk6diCAV
        DpPyp9VCVQUof0z20Tu87Qmy/sg6I6bBxkk=
        =Y9+m
        -----END PGP MESSAGE-----
      fp: 1918B94484C52CDE42CA1B87E7812096B8DA4A52
  encrypted_regex: ^(secretKey)$
  version: 3.8.1
