apiVersion: helm.toolkit.fluxcd.io/v2beta1
kind: HelmRelease
metadata:
    name: postgres
    namespace: gitlab
spec:
    interval: 10m0s
    chart:
        spec:
            chart: postgresql-ha
            version: '>=14.0.2 <14.1.0'
            sourceRef:
                kind: HelmRepository
                name: bitnami
                namespace: gitlab
            interval: 1m
    values:
        global:
            storageClass: replicated
            postgresql:
                username: gitlab
                password: ENC[AES256_GCM,data:yyQcSCUZehr3WwFRUfLB76SSC6VUj4NfsMQ9t0OBQNY=,iv:UJkpHAdB+gt6ktFKHXJhGGReyHHdgTsGa1AE1GU4OFk=,tag:sOJOu8ry+Vb21ISqzV/k/A==,type:str]
                database: gitlab
                repmgrUsername: repmgr
                repmgrPassword: ENC[AES256_GCM,data:OjBxgcVuH52OeHLYJ7CLYZvuoV3GGYeJ4CV0DnphQ/8=,iv:Gh4VCSJwu2XzIpZ3DKLGHdP3FH4eH1husAOVpq/aC2E=,tag:Y4JeFJ6vfSfIK5nc4CpFNw==,type:str]
            pgpool:
                adminUsername: pgpool
                adminPassword: ENC[AES256_GCM,data:WBGmE1Nv4j6v47eviVX78wN/2EQo/lhBixTHbmvF8cU=,iv:DVfDC/VD5I92aGB+CPbKIcqcMRC0PHihKWddORgs9Uo=,tag:+TxrmUMi+mU2bMaTlkw6pg==,type:str]
        postgresql:
            podLabels:
                app.omnilium.local/identifier: postgres-gitlab
            affinity:
                podAntiAffinity:
                    preferredDuringSchedulingIgnoredDuringExecution:
                        - weight: 100
                          podAffinityTerm:
                            labelSelector:
                                matchLabels:
                                    app.omnilium.local/identifier: postgres-gitlab
                            topologyKey: topology.omnilium.local/host
            topologySpreadConstraints:
                - labelSelector: null
                  matchLabels:
                    app.omnilium.local/identifier: postgres-gitlab
                  topologyKey: topology.kubernetes.io/zone
                  maxSkew: 1
                  whenUnsatisfiable: ScheduleAnyway
            extraVolumes:
                - name: dshm
                  emptyDir:
                    medium: Memory
                    sizeLimit: 256Mi
            extraVolumeMounts:
                - name: dshm
                  mountPath: /dev/shm
            resourcesPreset: small
            postgresPassword: ENC[AES256_GCM,data:Fr4aKiuw90vsSv2R20CFG8yGxYEQ1ylhH2zniE+hPjU=,iv:cRa33J2fDPJ7HNEZuCKdRt1odCQsbOOl5T8qMt3jMPw=,tag:TWfhQqZWwQCJJceIQXdWEw==,type:str]
            maxConnections: 200
        pgpool:
            resourcesPreset: small
            numInitChildren: "10"
            maxPool: "5"
            childMaxConnections: "18"
            childLifeTime: "30"
            clientIdleLimit: "10"
            connectionLifeTime: "30"
        persistence:
            size: 10Gi
        persistentVolumeClaimRetentionPolicy:
            enabled: true
        backup:
            enabled: true
            storage:
                storageClass: replicated
                size: 10Gi
sops:
    kms: []
    gcp_kms: []
    azure_kv: []
    hc_vault: []
    age: []
    lastmodified: "2024-04-07T12:21:59Z"
    mac: ENC[AES256_GCM,data:AdyfWdNwg7nLw79B4va0gQ1PuFcZD/ycoculYS+9LfmQ+ohfR6DIW9H6iAh0X/H6JuH/I7i0bzRzR6OLAfAoaw5h8z6IUIwUQMSCRlWKbcbKF2q48VLeaVpmIcuNVio4H18dMtIlCRsHbGrBMOWbjBSm7RJvH67rRKqfLU8NN0g=,iv:67y/vRCFkfdDGMWgoc4E2BZ3K8mr6RSF2Alrw2KCXOU=,tag:HHJtlr8lDmQ80H4xGBdBNQ==,type:str]
    pgp:
        - created_at: "2024-04-07T12:21:59Z"
          enc: |-
            -----BEGIN PGP MESSAGE-----

            hJ4D0dRkdsWQFPUSAwME8vUr4bJzBUXwjJrQMrXOwR/cQPrGv0oyNsgD+QIRdOze
            PTOBvZx9mAw956ioRteyi+Ds/t+IwiTRGPL1+aPyqsLal43OyRN/1eE9Tf/Vj3FC
            ++frUE6oNVGBk4LHbQQoMOXNFNXMIR6/ROXV8Gs7A0Eh7THBs8otHT6AJs1mRDYK
            WHFnX+vuENqA+LlLPaql+dRmAQkCEODQViQlUYPgN6BCoMHS/iS/dbBRMEI0j2lX
            8YqA44rQQiTOLzyyDOzFnDSAFWpMrtabjqusppEUZUb56QnltJwhEikjFBZf7YY/
            LotA3OrGilZD5vmvkVBAbr/itw5GH0fW
            =2Xaa
            -----END PGP MESSAGE-----
          fp: 0F003E832B1DA1A11CA9F206712F90FA248BBBC2
        - created_at: "2024-04-07T12:21:59Z"
          enc: |-
            -----BEGIN PGP MESSAGE-----

            hJ4DLG005yzvDc8SAwMENHeakcURE5euPl30NUMboQcWHUV1SJF95acLy93fD3aI
            RAKN7nHd/QKPY295mmrNOEdtP/CoTXO/u/ux4oMPMkvhTL02WpwMtLyQrU1YMrtF
            oLTynV8KDSGRnWkqJZP8MBvKcJy1asAUP+7XLRGKs1LtinLF5a5rnOytj8MCmABt
            jvSQFtXiARgpDDtpINppjdRmAQkCEPbyn6u1OsBfnXCTx2yh3EN2QgAGBcxmkOfz
            rZeiZTJPrGrncH24+QF5suhcju7ukUSPk8yxofe/EqADJ183OBHmuc6Rya08vjYl
            6UCopyR1jlZDFFDSPPlvGkkhFx/gHU/5
            =cghK
            -----END PGP MESSAGE-----
          fp: 1918B94484C52CDE42CA1B87E7812096B8DA4A52
    encrypted_regex: ^(password|repmgrPassword|adminPassword|postgresPassword)$
    version: 3.8.1
