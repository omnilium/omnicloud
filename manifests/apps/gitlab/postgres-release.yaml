apiVersion: helm.toolkit.fluxcd.io/v2beta1
kind: HelmRelease
metadata:
    name: postgres
    namespace: gitlab
spec:
    interval: 10m0s
    chart:
        spec:
            chart: postgresql-ha
            version: '>=14.0.2 <14.1.0'
            sourceRef:
                kind: HelmRepository
                name: bitnami
                namespace: gitlab
            interval: 1m
    values:
        global:
            storageClass: replicated
            postgresql:
                username: gitlab
                password: ENC[AES256_GCM,data:AyNBYQ6ktZntwDLDK7/EPQ/DbOdwtkY80YRTri1PhZo=,iv:CuZURQb5OMOi4i8mLSrIIqbRmYZ/6Nyb15VC8svCYW8=,tag:pRC6gpP4Rxe5a1np03wCXg==,type:str]
                database: gitlab
                repmgrUsername: repmgr
                repmgrPassword: ENC[AES256_GCM,data:PrgnXKkLfeuWWs2nKzqje7fYN0mUHJXpk/ij5DRTCbE=,iv:G5i5enZzY5eEvEiGHuBYjQnD9kV764n6B20pqb4EsKQ=,tag:TnXgJKn9nBLKhBi6R3evzg==,type:str]
            pgpool:
                adminUsername: pgpool
                adminPassword: ENC[AES256_GCM,data:vLCTVErn+lz+rFJXtY2OAYYYvJNcsturNxDvzFtCTlU=,iv:I0QYgOCaIAR5kKeJeco18ohWYj5Y81ghLTfRtCdqeX8=,tag:YDLb89V1MKsN2fZrhEaphQ==,type:str]
        postgresql:
            podLabels:
                app.omnilium.local/identifier: postgres-gitlab
            affinity:
                podAntiAffinity:
                    preferredDuringSchedulingIgnoredDuringExecution:
                        - weight: 100
                          podAffinityTerm:
                            labelSelector:
                                matchLabels:
                                    app.omnilium.local/identifier: postgres-gitlab
                            topologyKey: topology.omnilium.local/host
            topologySpreadConstraints:
                - labelSelector: null
                  matchLabels:
                    app.omnilium.local/identifier: postgres-gitlab
                  topologyKey: topology.kubernetes.io/zone
                  maxSkew: 1
                  whenUnsatisfiable: ScheduleAnyway
            extraVolumes:
                - name: dshm
                  emptyDir:
                    medium: Memory
                    sizeLimit: 256Mi
            extraVolumeMounts:
                - name: dshm
                  mountPath: /dev/shm
            resourcesPreset: small
            password: ENC[AES256_GCM,data:qs+aUHCYliCrmxnzaI0/igWy6bXTg3JC5YpPXKbAx50=,iv:L3zALRV7OfSUuyqf5ik9HTRqHzZ+xmLCmvsgLMYSs0g=,tag:QOlQlZahwnGejihinUgBwA==,type:str]
            postgresPassword: ENC[AES256_GCM,data:zhkIeO7wk2upI0gf+lmxP+Kz2IkVju22e2nxRxyFWVI=,iv:EVC3t71bFaj8ME1uX5RvES1dqswpZci4K8oeyZm3Owo=,tag:F2u6F6gSmVh0aFAS84Vmgg==,type:str]
            maxConnections: 200
        pgpool:
            resourcesPreset: small
            numInitChildren: "10"
            maxPool: "5"
            childMaxConnections: "18"
            childLifeTime: "30"
            clientIdleLimit: "10"
            connectionLifeTime: "30"
        persistence:
            size: 10Gi
        persistentVolumeClaimRetentionPolicy:
            enabled: true
        backup:
            enabled: true
            storage:
                storageClass: replicated
                size: 10Gi
sops:
    kms: []
    gcp_kms: []
    azure_kv: []
    hc_vault: []
    age: []
    lastmodified: "2024-04-07T12:23:50Z"
    mac: ENC[AES256_GCM,data:1p6oOpRDQ/FcGvc02Cj32+Aq1pV5YNIJexk5ubyNGB1A6GCpBaS/Jstez0lmyI0FskJgezKBWC3uCg6HDA9GkIKylNnHCI+Eq/YBKYdxyj7fpzrVVIwD05IYg/3gDvjWAyLktW07N0PJTXZeTs/0RltozBpVRg0uTocmKKm6RrI=,iv:fApd8pSPKV1ed7DhzqDsv67NRbanwUHvV6iR8IR9is0=,tag:ekrkJDSgazUdIPZ2QPd1Gw==,type:str]
    pgp:
        - created_at: "2024-04-07T12:23:50Z"
          enc: |-
            -----BEGIN PGP MESSAGE-----

            hJ4D0dRkdsWQFPUSAwMENjyt0FvY+lPeiLqZRSO4sq2KdilgoKtALRBoAPMyEmUb
            GbKoL1KW9joTeFBm7J9ZCkhqRF20MzmJwSXADs/E2Pv8jQ1Fwb6cGLtv2Mv2wGNn
            X4RMH45H/s11GRuFS4mMMCxlyZJdxaQjXOKatqNoTDtmQn48VcZmip5Zb6ZQ1Cpu
            mTlOomkEPf9u+/j75CBgu9RoAQkCEM+zVSXyc/a8fE35UsT8572GPZg+ty4dBUr9
            lcuxRRB2/DTFeTYaFlR7rJODCVrdhiA13l9CmNlf9UPeFN8jjDXJdi8hpjl8oqcW
            iEEfvhnNbHMEMqSXBkVMRDv66OcKS32o1u8=
            =RyL9
            -----END PGP MESSAGE-----
          fp: 0F003E832B1DA1A11CA9F206712F90FA248BBBC2
        - created_at: "2024-04-07T12:23:50Z"
          enc: |-
            -----BEGIN PGP MESSAGE-----

            hJ4DLG005yzvDc8SAwMEya8MBpsTb5WJn25SMSsgVm8uN5DjZf8Ls81Q0WUzGQZ7
            BV4QixwHuynPxp9LPQy0w6ivyYZ5mV8iRi/GYQG4qkiYSDsVk0NCkCgUS6dMhKhM
            1ET4qyAfaRqh4PkckCEyMI7SaANLMmeUjwysVm9f8FeNYr1WyB8NpcvxdmimsJHU
            KtzbtP2GVfEUWqouDC1xW9RoAQkCEBsfPAZIOZOuZrEl/mbtf8RNk/deobrRHHk3
            +5hrAW1h8Ur37h147MdOLGoGmHIIuMgHaZzGrjOi2inIAHHVd64YrXyo5Qxlmzs4
            +ApfdgudABSjmAqGsrYkP22HZoEb1J/gs8w=
            =MM/t
            -----END PGP MESSAGE-----
          fp: 1918B94484C52CDE42CA1B87E7812096B8DA4A52
    encrypted_regex: ^(password|repmgrPassword|adminPassword|postgresPassword)$
    version: 3.8.1
