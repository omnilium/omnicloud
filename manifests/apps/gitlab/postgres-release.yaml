apiVersion: helm.toolkit.fluxcd.io/v2beta1
kind: HelmRelease
metadata:
    name: postgres
    namespace: gitlab
spec:
    interval: 10m0s
    chart:
        spec:
            chart: postgresql-ha
            version: '>=14.0.2 <14.1.0'
            sourceRef:
                kind: HelmRepository
                name: bitnami
                namespace: gitlab
            interval: 1m
    values:
        global:
            postgresql:
                username: gitlab
                password: ENC[AES256_GCM,data:0n5Ivm+vtRBTK5IBmJTYCN+q9nb+SF9sWZ2+I9FLk88=,iv:CAEuV3FMHkMmlRD2pCVYFeKQwan4YoWw2FL+QQ7OBdw=,tag:ZhQNFgMRE5cQZE8Jozq4jg==,type:str]
                database: gitlab
                repmgrUsername: repmgr
                repmgrPassword: ENC[AES256_GCM,data:ZcnfzhTRnJ9yslQbcgfzcj9TjDmvYScunKwmthp0wUo=,iv:ig8iaBgWIXrMnFR/4UqU1Fvoo9ZxS2r4eKBG9MyeTWY=,tag:1ZLqrY+v6snR9wz2LFKfNQ==,type:str]
            pgpool:
                adminUsername: pgpool
                adminPassword: ENC[AES256_GCM,data:nt5xa3apNy8uMYCEQYkwUagfn2oSq/ZH3IaepRyamHo=,iv:qeyzAolahT517ev7cRUgL+IPSQY4B9WXeBxWxCd3t4M=,tag:5qP9IsjWUNPU1WNa3gYthA==,type:str]
        postgresql:
            podLabels:
                app.omnilium.local/identifier: postgres-gitlab
            affinity:
                podAntiAffinity:
                    preferredDuringSchedulingIgnoredDuringExecution:
                        - weight: 100
                          podAffinityTerm:
                            labelSelector:
                                matchLabels:
                                    app.omnilium.local/identifier: postgres-gitlab
                            topologyKey: topology.omnilium.local/host
            topologySpreadConstraints:
                - labelSelector: null
                  matchLabels:
                    app.omnilium.local/identifier: postgres-gitlab
                  topologyKey: topology.kubernetes.io/zone
                  maxSkew: 1
                  whenUnsatisfiable: ScheduleAnyway
            extraVolumes:
                - name: dshm
                  emptyDir:
                    medium: Memory
                    sizeLimit: 256Mi
            extraVolumeMounts:
                - name: dshm
                  mountPath: /dev/shm
            resourcesPreset: medium
            password: ENC[AES256_GCM,data:ni/zQ6w1GBQ14PImcIjcF5QtFUEdY/Qe2Qbktp61sfY=,iv:mUQ8sXPb1EErip4QHrpJN8QyDQ7IZoA5x0L/lO9Jw1s=,tag:stpTjj67Cu+1VN+2NwuPmg==,type:str]
            postgresPassword: ENC[AES256_GCM,data:oPM+cA+yEeVN0dLAIRZ9sQBWQzf4S/aTYWrI05MDYR4=,iv:UP9hBLVRaoZYAJqY2LDYw2JSwAAcvMG91QWwy0qshwQ=,tag:R/8g91tHMnX4StbdNvB1XQ==,type:str]
            repmgrPassword: ENC[AES256_GCM,data:kSUzmAcITUao+/Xi30jYlDafvmMA6x63fa3PTJ6fb7Q=,iv:unhcWuQWbAKv6keToslnOzOWkcx45lMKr8IHIlj09xE=,tag:d8nfxolMWw20+Kr/gpW3Vg==,type:str]
            maxConnections: 300
            postgresConnectionLimit: 20
            dbUserConnectionLimit: 280
            priorityClassName: high
        pgpool:
            resourcesPreset: small
            adminPassword: ENC[AES256_GCM,data:x1PNX+i8VBKmwptbONe7ZptXbYjSNctkJ74/6UhbG+Q=,iv:6s9+10BlUYRsX+LdMld3iClI11R2zHEuD4LdxiBKjl4=,tag:EP9oMG6b4BixApCFpzpWSg==,type:str]
            numInitChildren: "35"
            maxPool: "8"
            clientIdleLimit: "5"
            connectionLifeTime: "10"
            priorityClassName: high
        persistence:
            size: 10Gi
        persistentVolumeClaimRetentionPolicy:
            enabled: true
        backup:
            enabled: true
            cronjob:
                storage:
                    storageClass: replicated
                    size: 10Gi
sops:
    kms: []
    gcp_kms: []
    azure_kv: []
    hc_vault: []
    age: []
    lastmodified: "2024-04-07T14:45:46Z"
    mac: ENC[AES256_GCM,data:vLD85wh4yCd3nNYJZep5ST4PThcbMPKgwKRG4/9W+xDRLG44IWlxr+/f4qgXFj8bzoTqkyH7GtMHxNy1067UtdUEiY7nLMLMbhz1UTpySXyEUOAVvYxIwQs6Hd2y8UHpYBPeP8uFMgcYCO4jAPTEHE+o7j3nIseHhA5TYa6MUUM=,iv:efExmZ1ddvuBtHFxZ/auNIWuNjXpPNIWRuh0ROMVtGA=,tag:MweLC3FxMypQ32lTN/ha6g==,type:str]
    pgp:
        - created_at: "2024-04-07T14:45:46Z"
          enc: |-
            -----BEGIN PGP MESSAGE-----

            hJ4D0dRkdsWQFPUSAwMEJfXaviySX8uIwDYt5m6lEQihp6oRlp9bxkjitti3HMvm
            AcyTBiNewZZtRTVGtUxdHi6L7Hc4BgXgzS0wx7Lkf3/6FxY/KQIcrTJcIAflMY+o
            gazkv5X+yVmzHJq40BPIMK355jaicbWo6cFh/ete6vT/9ESgMmlb0NgUgrMvvCKu
            5MXPnK5zBrPEORIYsSzJ/9RoAQkCEHTLbwfWVF5P1wcZtt3oeYOseRupOmhSGNxW
            O5Jm62Hwcfiu4uCItJTNMhg3a9UvZhxXFrEMLxdZ++Q+IPBJfF9bc5UEY2HPxNsJ
            cjLimnCLKbaJ61WTFDRfDtlufNlEuZvcpWA=
            =nXgj
            -----END PGP MESSAGE-----
          fp: 0F003E832B1DA1A11CA9F206712F90FA248BBBC2
        - created_at: "2024-04-07T14:45:46Z"
          enc: |-
            -----BEGIN PGP MESSAGE-----

            hJ4DLG005yzvDc8SAwMEiHnTRXLdcPR8y60pmDtH1IIoepBZ4s4gn0Whi68GLH4P
            YFKOF/dFNFhDiqzTdJaaYsfonlxydwDxlyHVFXKMClnfMAbL7rGiuc03TN01DJMs
            DzBAvHGstW44S3+MnXaTMFD9qjS3tOZcuoRZejMxb3cDDE0/LFqk8YkWbq/I6p5Z
            lUqqX5AGAU6TeDhTuqChmNRoAQkCEHosD9gJrFP5EkC8LUE4P9SQDbJGi5xtJkuB
            nrI4EBNnsm16pY7Nxsmn1IX8kHq8KKCE7bqF0shO9jbMem/d7Ckhk048toLpbqrg
            pMSDvWv1PM532kut/IO2cLlgncWkQ14OzdQ=
            =syf2
            -----END PGP MESSAGE-----
          fp: 1918B94484C52CDE42CA1B87E7812096B8DA4A52
    encrypted_regex: ^(password|repmgrPassword|adminPassword|postgresPassword)$
    version: 3.8.1
