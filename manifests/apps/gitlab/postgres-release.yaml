apiVersion: helm.toolkit.fluxcd.io/v2beta1
kind: HelmRelease
metadata:
    name: postgres
    namespace: gitlab
spec:
    interval: 10m0s
    chart:
        spec:
            chart: postgresql-ha
            version: '>=14.0.2 <14.1.0'
            sourceRef:
                kind: HelmRepository
                name: bitnami
                namespace: gitlab
            interval: 1m
    values:
        global:
            storageClass: replicated
            postgresql:
                username: gitlab
                password: ENC[AES256_GCM,data:XMcUW6zJpG0ZM4wKIjIpUDnUr9XFex2V1IobPcsI59A=,iv:4T2YNnrGeUxqmKvhhJ42zeA3cKIR1M6z/YCUSvDyK1w=,tag:zZK2TepqffZiObfPYCpzAg==,type:str]
                database: gitlab
                repmgrUsername: repmgr
                repmgrPassword: ENC[AES256_GCM,data:ByO8CZjpgfL1tOTOe8iMXLajInKRHJtaOiRou9ATUP4=,iv:gx2ubNPe+rVEN4u8yZo2ByLwIR4z6C/CdQ58F+SMukE=,tag:Qa2NNFG+pyJZsFuh4KgubQ==,type:str]
                repmgrDatabase: repmgr
            pgpool:
                adminUsername: pgpool
                adminPassword: ENC[AES256_GCM,data:IefwcEoCYT4tXWJONGP+OxSV7OGSdlEZ5x2wYkUPv5E=,iv:38AICDrr76oVoGJk2by0haxZLeV4HO6nh55hr9duPtQ=,tag:cssCxkMrgIEd6kNuS5oxiA==,type:str]
        postgresql:
            podLabels:
                app.omnilium.local/identifier: postgres-gitlab
            affinity:
                podAntiAffinity:
                    preferredDuringSchedulingIgnoredDuringExecution:
                        - weight: 100
                          podAffinityTerm:
                            labelSelector:
                                matchLabels:
                                    app.omnilium.local/identifier: postgres-gitlab
                            topologyKey: topology.omnilium.local/host
            topologySpreadConstraints:
                - labelSelector: null
                  matchLabels:
                    app.omnilium.local/identifier: postgres-gitlab
                  topologyKey: topology.kubernetes.io/zone
                  maxSkew: 1
                  whenUnsatisfiable: ScheduleAnyway
            resourcesPreset: small
        persistence:
            size: 10Gi
sops:
    kms: []
    gcp_kms: []
    azure_kv: []
    hc_vault: []
    age: []
    lastmodified: "2024-04-07T08:58:57Z"
    mac: ENC[AES256_GCM,data:o3LzTSpjbcntTuHqDNH5MokfBonk6gUfeLYBgfBEn/gYuIg6zcbAje+APNT46tY0YzqBAXhZbSGEy8VF/CaK2RLfeAVUJ7pVSCb9+dBxWRib7c1QyHMQmip/8bkA7/QGBp3OZdNnePexxCh8UxUbXQRZ49Mai+VWUI7unKVykws=,iv:20OtW6C6FPIRCUg0zhU3PWHJ6qK6nwwsQDSPMAi8j9w=,tag:EWnntOHXOtZ1SEYvMI5Ovg==,type:str]
    pgp:
        - created_at: "2024-04-07T08:58:57Z"
          enc: |-
            -----BEGIN PGP MESSAGE-----

            hJ4D0dRkdsWQFPUSAwME+gkbF29fHiPsLv6Usk526oaOtqxfUIkuznI23L3N7GPk
            8BOfLChTP0pGkw6Wm1vyfHhKmPHErzYQRiyMD5o65eCatZXkUoorpkVzIBE/1C/p
            sauP+qEPpKV5yDmbSjgBMMoJ5pCvM8jYZyOO3inPk90zBub7dAOJYD9B9qhV0pjI
            0aRaQKhjaoDLb/1bB03XctRmAQkCEIeVdtRF9C9GYI+yrm3iur6ocV2WW6dU7lz5
            JmL75CLArB55eYNYFXcBvr5DwbgHY1wP8Z8I8WWte9JorhLOuq8CIIMzUrrOGb//
            nBBDGenB6w5FA7oZjJRM8a8h1LDr59yn
            =yQun
            -----END PGP MESSAGE-----
          fp: 0F003E832B1DA1A11CA9F206712F90FA248BBBC2
        - created_at: "2024-04-07T08:58:57Z"
          enc: |-
            -----BEGIN PGP MESSAGE-----

            hJ4DLG005yzvDc8SAwME7I/7712zWZNNqWGqQH2qMYrJx1I9kFow9OB78+tQkA4f
            dAPwraV/zYRZJICs+U8N2zkNUJhz8AsL79gTqYqeIxkEHTiKa4No/eBCl5TRsWwO
            9hCH9xAhOc8iq3PrtTGRMHcAWCW2VQ6Gn69mRhNTGZYSyccgD7AWXnTS74YK7ln5
            onR5+rhW39q7HQk5fajWbNRmAQkCEG4aq2G3ZFpOZ+3hhmO3CsZIm58SWt4e1aiz
            j9S20z5kTiseIOILf3DM35kvD+elGqYXeolIIwpMuPs1CsJzZtPl+lQKPuAUddMm
            kV9JRHP5/h/kvvCF+D+HtJL9B2wwUVxk
            =dXUI
            -----END PGP MESSAGE-----
          fp: 1918B94484C52CDE42CA1B87E7812096B8DA4A52
    encrypted_regex: ^(password|repmgrPassword|adminPassword)$
    version: 3.8.1
