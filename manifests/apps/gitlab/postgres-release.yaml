apiVersion: helm.toolkit.fluxcd.io/v2beta1
kind: HelmRelease
metadata:
    name: postgres
    namespace: gitlab
spec:
    interval: 10m0s
    chart:
        spec:
            chart: postgresql-ha
            version: '>=14.0.2 <14.1.0'
            sourceRef:
                kind: HelmRepository
                name: bitnami
                namespace: gitlab
            interval: 1m
    values:
        global:
            storageClass: replicated
            postgresql:
                username: gitlab
                password: ENC[AES256_GCM,data:0x+d7Czy5wrNcGLUR5zhMptUAZLU7wsgZB6P0xSlUCk=,iv:rDA+tAqXXoeTzNf/EgKOq8DAPUdx85YiPQM69TwaJ34=,tag:EioVkysMNcauvTE3teFEFw==,type:str]
                database: gitlab
                repmgrUsername: repmgr
                repmgrPassword: ENC[AES256_GCM,data:bAm3iaBvqvyeFQLNGykaDh4KGzXLp1830XjNbv/rMJI=,iv:RzZySI2+e1T6K3L0qoHOI+mRYm/NxZm403G2Zp0dc8k=,tag:2KBUj7BpFXuwtcvTzRqxyw==,type:str]
            pgpool:
                adminUsername: pgpool
                adminPassword: ENC[AES256_GCM,data:L2rPu2bBzutv24EDXO8XHQKKidMUGyy1ghjSTOdmfvA=,iv:i4Mgaq84lUiBjbYKyP9mJ0BtD0FoNzakbAycCAS7hk4=,tag:v+iKyR9YecntTcim/yQLPA==,type:str]
        postgresql:
            podLabels:
                app.omnilium.local/identifier: postgres-gitlab
            affinity:
                podAntiAffinity:
                    preferredDuringSchedulingIgnoredDuringExecution:
                        - weight: 100
                          podAffinityTerm:
                            labelSelector:
                                matchLabels:
                                    app.omnilium.local/identifier: postgres-gitlab
                            topologyKey: topology.omnilium.local/host
            topologySpreadConstraints:
                - labelSelector: null
                  matchLabels:
                    app.omnilium.local/identifier: postgres-gitlab
                  topologyKey: topology.kubernetes.io/zone
                  maxSkew: 1
                  whenUnsatisfiable: ScheduleAnyway
            resourcesPreset: small
            postgresPassword: ENC[AES256_GCM,data:ssWTQsDtenu6Z2cXFTRp1vbH8i5YcpsEwd87yzNVMKU=,iv:/tXvIk35qdzBC435TnFzNzYTxw/KzeF1PiQqXdlhVVs=,tag:1cuHJpQ8PUOQ02InIgFK6w==,type:str]
        persistence:
            size: 10Gi
sops:
    kms: []
    gcp_kms: []
    azure_kv: []
    hc_vault: []
    age: []
    lastmodified: "2024-04-07T09:16:35Z"
    mac: ENC[AES256_GCM,data:wWOQOe/bbweJvsgiYCU+Km3pjf0g/HGouP8BWUguKHW5XUkKPj4FoMrISdsNRvmXcIAK/6f/sH0+knM+kXiT3fBKpXY68r4SFTuTLOT6lwsKg8sER24Hc7WeT6c7ltIHI+ET2bdA6N695v6zXhbiXPIauurjlUrNZ+fNsEwpQ2k=,iv:njXwtFAX9A0HqOEAV9SKliIJLDushFHM7DAitq7eov4=,tag:c1gDTXN1/C+XYZc+jgoAqg==,type:str]
    pgp:
        - created_at: "2024-04-07T09:16:35Z"
          enc: |-
            -----BEGIN PGP MESSAGE-----

            hJ4D0dRkdsWQFPUSAwMEf/BJOc0zqPlH0m/e+SqTV1r6oZsk/Rd3ggqld6IQjHUE
            mLp0IaAAMF9fdAWnr+j28CkePyfqDO47JzYJbxAk7NKWZL/nz78P+purA08GbjiM
            asA9egLIkGXexuk66ty0MKBNA/mTWKmYJ+q6oVb7TQilcEgxg1HBHMElZh8hZ9cW
            xbc1w2FE7AKh4tmVLBX0FNRoAQkCEDt612r/aq1OcNatVdGKxX6iSAQYXQi6uR6C
            1DF9x0qVHWOa+KB7/JTeducHEdmIIVM9XPv+b265xqbWbwsso65Q+9uz79LZ0nxt
            hMz1nFV6SuCxFVs/z6NvfF/6qR/3FxGEm+0=
            =6K20
            -----END PGP MESSAGE-----
          fp: 0F003E832B1DA1A11CA9F206712F90FA248BBBC2
        - created_at: "2024-04-07T09:16:35Z"
          enc: |-
            -----BEGIN PGP MESSAGE-----

            hJ4DLG005yzvDc8SAwMEkLF1laKc/xOLraHJHURukIYWqxgl+xVR8P93eKehVeOw
            WMzwlrA9Be/TGEFVDZwfUiA4qcB0qpAf1pnU+0yp9Falfr7IZ0ehCP/U0nzYk1M/
            SAbHBB2dGB9UCOMR4Lz3MLpzt+A/yRhM8B4IyTX+GQLjZE6VhOQYm9DxgJpiaPsr
            syNtZbtDws+gQVmTUTW5BNRoAQkCEDrjMpEBL7jeYaSCi6YafwV1klD6p715Hs2l
            6asABsxmnGP6kTmqGwtnaw3mPwtsKZFjjVaMciVpYi+fF3JlWduVxPOHnu0E1mpb
            siUwTPWrRdOXUNO1dHdLmlzKpGXaL7bNdIQ=
            =vKbP
            -----END PGP MESSAGE-----
          fp: 1918B94484C52CDE42CA1B87E7812096B8DA4A52
    encrypted_regex: ^(password|repmgrPassword|adminPassword|postgresPassword)$
    version: 3.8.1
