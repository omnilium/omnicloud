apiVersion: helm.toolkit.fluxcd.io/v2beta1
kind: HelmRelease
metadata:
    name: postgres
    namespace: gitlab
spec:
    interval: 10m0s
    chart:
        spec:
            chart: postgresql-ha
            version: '>=14.0.2 <14.1.0'
            sourceRef:
                kind: HelmRepository
                name: bitnami
                namespace: gitlab
            interval: 1m
    values:
        global:
            postgresql:
                username: gitlab
                password: ENC[AES256_GCM,data:UAw0eiatb8yYUOW4iIKBJB2GmqlLcLmDWYUXsqdfwXQ=,iv:kSiJHv8YHuxY8WZ0QJ9K4A7TmQv51gQEf/IExMQnxsI=,tag:y6h+Ah+h3HGhPiz1MfTG7g==,type:str]
                database: gitlab
                repmgrUsername: repmgr
                repmgrPassword: ENC[AES256_GCM,data:kzIW+Y8cAxXJWyOLMsATHcTKLqG2W7mh/vB7DNOnfvM=,iv:xzDKQV3uLUIoxDJfMQLizmYopd2obLhFvKnyvHxQdS8=,tag:Y48RsBORf55sNoyOExB+eg==,type:str]
            pgpool:
                adminUsername: pgpool
                adminPassword: ENC[AES256_GCM,data:LzMbDQXc+jH+EwwzushsCZEKkam6TGR43vlz2aGdmas=,iv:BsNj62pkE/CBejcocSaZlPExDXUEA9DvlbwIFReB1Xs=,tag:CHs1Fs3n5TqPyxHccjUZaw==,type:str]
        postgresql:
            podLabels:
                app.omnilium.local/identifier: postgres-gitlab
            affinity:
                podAntiAffinity:
                    preferredDuringSchedulingIgnoredDuringExecution:
                        - weight: 100
                          podAffinityTerm:
                            labelSelector:
                                matchLabels:
                                    app.omnilium.local/identifier: postgres-gitlab
                            topologyKey: topology.omnilium.local/host
            topologySpreadConstraints:
                - labelSelector: null
                  matchLabels:
                    app.omnilium.local/identifier: postgres-gitlab
                  topologyKey: topology.kubernetes.io/zone
                  maxSkew: 1
                  whenUnsatisfiable: ScheduleAnyway
            extraVolumes:
                - name: dshm
                  emptyDir:
                    medium: Memory
                    sizeLimit: 256Mi
            extraVolumeMounts:
                - name: dshm
                  mountPath: /dev/shm
            resourcesPreset: medium
            password: ENC[AES256_GCM,data:x+ojp8N2r42tOo/joJh4iwxJyO5CJP1S8lSD+johKyA=,iv:iG8PhfOwhGe1cJrlPKt42WVpOtjyDulquoP7xIc/dWw=,tag:Cdrqrq5XpfytiWS7d9qYIw==,type:str]
            postgresPassword: ENC[AES256_GCM,data:rLSPVBSlgIDFbVJrcmbjwk16z6Xc6wfJVBFH0DaMiuw=,iv:nEGORaLwrawbLqqzlLtIl5XnROGxx4xAwak8fx7O6l0=,tag:mcY3r/OxMKod+YHbpTnFBQ==,type:str]
            repmgrPassword: ENC[AES256_GCM,data:UkSnpdloLIpCapQREB7X44mvzZa58txPT5W5dYfqNE0=,iv:T/9PPXtz8jKV8rTgFM74NjB8bM9L4sVxrwdcBNgR2dY=,tag:K07E6+gpfXHrleZaTm3WLw==,type:str]
            maxConnections: 300
            postgresConnectionLimit: 20
            dbUserConnectionLimit: 280
        pgpool:
            resourcesPreset: small
            adminPassword: ENC[AES256_GCM,data:JtRZ3fjdED/Uj9ZEiTTNFJzq9CeijeQ/FALx3mZNbBk=,iv:CyYOuo8g5tH+PKcNNUDMUfSbproXcH0jFOG3JW4wetg=,tag:843BG5j6ASUAC9PPF2WL6w==,type:str]
            numInitChildren: "35"
            maxPool: "8"
            clientIdleLimit: "5"
            connectionLifeTime: "10"
        persistence:
            size: 10Gi
        persistentVolumeClaimRetentionPolicy:
            enabled: true
        backup:
            enabled: true
            cronjob:
                storage:
                    storageClass: replicated
                    size: 10Gi
sops:
    kms: []
    gcp_kms: []
    azure_kv: []
    hc_vault: []
    age: []
    lastmodified: "2024-04-07T13:51:16Z"
    mac: ENC[AES256_GCM,data:QCEsLQH8cV4xkEuUjc6451uU+L8Tr6kRMXZwIEKz1vHp/UkvLcpoyhzNOWc9C6hxjK7MqaU4s/2Na0Cxqo8bWWejPCwFgJmFwYdGEJ1lSMO/TKdA9HkwHyNZms3LPpjIsgvntMqAyK5HDx9xCuzSoG0X5Sp+ccjHhx4NT8mJ3uA=,iv:RZDpudgyoiE+7eAywhXH+TawwlwteUREJEMmSzETdy0=,tag:pWE/ILz3clnZgE6gNkBArA==,type:str]
    pgp:
        - created_at: "2024-04-07T13:51:16Z"
          enc: |-
            -----BEGIN PGP MESSAGE-----

            hJ4D0dRkdsWQFPUSAwMEADRtNBis/T+81IK1Zh3TkqEvju39BA/p5LVCDBcUqtMS
            xNb3qgbMkRDZ/M519zKjQozR6F89J+tinQZ4TqpnWkVJehR8GBfDjzao1iw2RqQX
            R0FH8ge39RUNnqKKaJbFMLx6YtcFlkeD/SnGzCzqpLas97SWoDUXZiKBvfSy2hP6
            7rTfTNPg1RhSJ4fDCXhAOtRmAQkCEP0Ts0HiVPDtKt9l7jX+KpDzAsojUHmE37ht
            Pgki8N3JBM5pn4DWcOfpqPBJoVtaQarWVFSJHmjsREFCCx+tD+bgzv9inMfLmepY
            n1pMwZv3lSwGJXAaQYyYjVzvS7NcgA4i
            =H9MC
            -----END PGP MESSAGE-----
          fp: 0F003E832B1DA1A11CA9F206712F90FA248BBBC2
        - created_at: "2024-04-07T13:51:16Z"
          enc: |-
            -----BEGIN PGP MESSAGE-----

            hJ4DLG005yzvDc8SAwMEk/0czWeHdLTaiW92VatblXB7UciIVSk2VrLnUZSKWZ/H
            Z4+VP4+iYh97piMnVUSk6dVuB/QdbokzB1RPUUjbultH1qgWux5FVjPX/DZSN/iT
            iJtDxFLbw/agb092bapdMHtadhRdb/TwfbiAq3c/kVJn4kySvQdUfNkCusKOBZRN
            GA8UakoCaYaNansAfeD4Y9RmAQkCEPC1H5vhvD5JBYjJIpKKthWtOKJE0WvHuy4/
            QI3CBFkIHcj6iXpGqt254K7K2z3NB7fBfNQG7Gvq076WeeH8t73DhJ9Gzp9a+80g
            5D4HVgExL9MHPF83Uzl07UzPiWCkQ6Tb
            =NFa4
            -----END PGP MESSAGE-----
          fp: 1918B94484C52CDE42CA1B87E7812096B8DA4A52
    encrypted_regex: ^(password|repmgrPassword|adminPassword|postgresPassword)$
    version: 3.8.1
