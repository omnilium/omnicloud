apiVersion: helm.toolkit.fluxcd.io/v2beta1
kind: HelmRelease
metadata:
    name: postgres
    namespace: gitlab
spec:
    interval: 10m0s
    chart:
        spec:
            chart: postgresql-ha
            version: '>=14.0.2 <14.1.0'
            sourceRef:
                kind: HelmRepository
                name: bitnami
                namespace: gitlab
            interval: 1m
    values:
        global:
            storageClass: replicated
            postgresql:
                username: gitlab
                password: ENC[AES256_GCM,data:oc3MHb1UW3Vm8raGWjMFAQS+yCphbENDm5tu5XvV0GE=,iv:EZ+RdIVcAac2bluN+14u5rYE64SJdjVlG7ERNpnut5c=,tag:1zpL8j/6ZY4GKGiMQjfrvA==,type:str]
                database: gitlab
                repmgrUsername: repmgr
                repmgrPassword: ENC[AES256_GCM,data:AuZkrNgrpAIviK0jz0kL0lACDDeM2DLziexswUNraj4=,iv:CQKjqkm6kus14x+A2YNFBWD+e/WArhxrZgmNtIBxL1U=,tag:XsrVJ9nFotlgdfly0v1KGw==,type:str]
            pgpool:
                adminUsername: pgpool
                adminPassword: ENC[AES256_GCM,data:VU0abXNqUlXxGIZJoDnB26PLXiH35tbJbRzEIoMohzM=,iv:7V7AUlKsbMvy3aRk7lR6rOftzis1FEIi1KfM3EgnBHM=,tag:pbtlSdk7nPZ6S0gWFz7GkA==,type:str]
        postgresql:
            podLabels:
                app.omnilium.local/identifier: postgres-gitlab
            affinity:
                podAntiAffinity:
                    preferredDuringSchedulingIgnoredDuringExecution:
                        - weight: 100
                          podAffinityTerm:
                            labelSelector:
                                matchLabels:
                                    app.omnilium.local/identifier: postgres-gitlab
                            topologyKey: topology.omnilium.local/host
            topologySpreadConstraints:
                - labelSelector: null
                  matchLabels:
                    app.omnilium.local/identifier: postgres-gitlab
                  topologyKey: topology.kubernetes.io/zone
                  maxSkew: 1
                  whenUnsatisfiable: ScheduleAnyway
            resourcesPreset: small
        persistence:
            size: 10Gi
sops:
    kms: []
    gcp_kms: []
    azure_kv: []
    hc_vault: []
    age: []
    lastmodified: "2024-04-07T09:01:31Z"
    mac: ENC[AES256_GCM,data:8VKSfOdGxZrBDTchoB9REZ59vGr06TYoBxonA2OwMKjJidlYzoKGX6hSHjjkf6BcwhAglBtnACwLkbZboLGCy2hFxmSE57r47ueos4mut84JsDfp3rvGIGgJuoGCj5cdaA4NvQkCqSxr4X7F9QXLMADVx+tDQ+u1sOOkZpl4YLg=,iv:RIrdDMndVmUWa5xiUtTkmtcWllVphMy3zAS0MPqsF1s=,tag:plsoryqZPKoW48awqwuIMw==,type:str]
    pgp:
        - created_at: "2024-04-07T09:01:31Z"
          enc: |-
            -----BEGIN PGP MESSAGE-----

            hJ4D0dRkdsWQFPUSAwMEXvQxueUAFtQ5/otQzQmfoKdXafGgU0lDU2X3mRLNeCFE
            zIhwasD4RjZyx/pMXkfHbx2arhOHD9Yo1EZq2TN/XlDsdRxL/whIHLvfOst8ONnW
            JFIEGXC/a8zCGTJmo3NnMO7tORmb9u5Bi0iLmkVc36QpyC/NEPtYwjo1pUCKQ1Xv
            sxnoeY4ctqb/ot+C1MYMwdRmAQkCEOKofmxwT/6EdlLgA3SPlw1SWzdQaAj5xjjm
            7MP4R5CzTs8/9KSsxGJDMAYiRzuo9w6Y1Gw9776t8qiFEOiaCSj5m6+/CSKg2fXH
            s5wDhdwPRMRl+nqfny5Xz4WX7L5XhrtN
            =s7lr
            -----END PGP MESSAGE-----
          fp: 0F003E832B1DA1A11CA9F206712F90FA248BBBC2
        - created_at: "2024-04-07T09:01:31Z"
          enc: |-
            -----BEGIN PGP MESSAGE-----

            hJ4DLG005yzvDc8SAwMEh9yUs0mFhHmfLvU6hxj6/vm60WXnJ9Lpe3l8iw6T1C41
            k7Aq/Iaok7tbGPF1uCEDLo+hb9qupz3SNp0ixxb7wNp0aMlwM79lwlpy8zFVL8If
            nCFd/JWpKfEFlOuoQmK4MHsZaXXjm6FTenZmN/jQ8Jmot6Y91Ui7F02twWRgxfCZ
            gXkWVb5nl/n7ZcT2ZJ7UztRmAQkCEKdHVkTloinR4tYVkB9rVBgl4eY8haQTmvaC
            t5w1I8BdXZRnXyqDVhD593gNcZH9ZjXa2cLpa1qxX1mW8uNm2vRPMB9PonW3nXqb
            26irQksOxP0GoSfYxq1oxz7K4LThiGco
            =8AXy
            -----END PGP MESSAGE-----
          fp: 1918B94484C52CDE42CA1B87E7812096B8DA4A52
    encrypted_regex: ^(password|repmgrPassword|adminPassword)$
    version: 3.8.1
