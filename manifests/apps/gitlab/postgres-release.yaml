apiVersion: helm.toolkit.fluxcd.io/v2beta1
kind: HelmRelease
metadata:
    name: postgres
    namespace: gitlab
spec:
    interval: 10m0s
    chart:
        spec:
            chart: postgresql-ha
            version: '>=14.0.2 <14.1.0'
            sourceRef:
                kind: HelmRepository
                name: bitnami
                namespace: gitlab
            interval: 1m
    values:
        global:
            storageClass: replicated
            postgresql:
                username: gitlab
                password: ENC[AES256_GCM,data:JLPb1tIKevKywRHa69KbdG6pCCXTy5L6SyiLjaBrOBI=,iv:N7NIdIVtKbs8KJXkrz8f4T64r9TASRIecKvWl1VRjdg=,tag:ckWgO1I8uGO+7M+Crdzbrg==,type:str]
                database: gitlab
                repmgrUsername: repmgr
                repmgrPassword: ENC[AES256_GCM,data:TuXywQvT9c/g90FOoJEVOjuK4+qKMwaApayKxwAtzWU=,iv:Bq7qu1O8CH7gv+XjY8Lxhhf5iTlxe8SnSi1yh65aiVk=,tag:B5gVZLa9NPqrgi9cbyyJRA==,type:str]
            pgpool:
                adminUsername: pgpool
                adminPassword: ENC[AES256_GCM,data:d/a9wPGChzhtyXl2MLdCW7W8jzVU9WBFxyeq8l1LZwQ=,iv:XrsemKvYj6YTUw/LRAyO2VzJp/NEjunvt5yYkASZTBI=,tag:zAPH4OFw19CWqrLkjjt4Sw==,type:str]
        postgresql:
            podLabels:
                app.omnilium.local/identifier: postgres-gitlab
            affinity:
                podAntiAffinity:
                    preferredDuringSchedulingIgnoredDuringExecution:
                        - weight: 100
                          podAffinityTerm:
                            labelSelector:
                                matchLabels:
                                    app.omnilium.local/identifier: postgres-gitlab
                            topologyKey: topology.omnilium.local/host
            topologySpreadConstraints:
                - labelSelector: null
                  matchLabels:
                    app.omnilium.local/identifier: postgres-gitlab
                  topologyKey: topology.kubernetes.io/zone
                  maxSkew: 1
                  whenUnsatisfiable: ScheduleAnyway
            extraVolumes:
                - name: dshm
                  emptyDir:
                    medium: Memory
                    sizeLimit: 256Mi
            extraVolumeMounts:
                - name: dshm
                  mountPath: /dev/shm
            resourcesPreset: small
            password: ENC[AES256_GCM,data:dT/6NHNm9lBox3CaAYlm3+HUDoEEjVefctqohr6TJ50=,iv:BFB+9N2BjseG3uBKQY1UJOIqhiYx9xgYyJw2m3yGL8U=,tag:AJ2usXOQuxHqfATgugYE7A==,type:str]
            postgresPassword: ENC[AES256_GCM,data:ggWkgoLoSZPgB9auB20KChEqNr9JtTbB/P5QsPfFnZ0=,iv:bQppjkNdO2bQGuEaYhAeiu+FzZBj3UCd+JCl4A3cDiU=,tag:oTYrBaXWgVr4NqwM57yTNQ==,type:str]
            repmgrPassword: ENC[AES256_GCM,data:+2Mt5R1y0D79fB3P8ZjOGUgFpNN7aO8oDIfJvFy2kxo=,iv:u2NrMt2GTAMgf9n1IgrLS+MlZ5nZMkhQdIwU/kYHuwQ=,tag:xjdy308WFagrK/a6ZZ83bA==,type:str]
            maxConnections: 200
        pgpool:
            resourcesPreset: small
            adminPassword: ENC[AES256_GCM,data:JvTa/5l5kIfBIh17GGWOabUlnp47NQVrVoqmkJAhlG4=,iv:lJJP/DZNsjb9KAgjJTQF3Wm+JfpJbYac3SrarxZRRCU=,tag:+pAqKkZY3YRR3tasxbKvaQ==,type:str]
            numInitChildren: "10"
            maxPool: "5"
            childMaxConnections: "18"
            childLifeTime: "30"
            clientIdleLimit: "10"
            connectionLifeTime: "30"
        persistence:
            size: 10Gi
            storageClass: single
        persistentVolumeClaimRetentionPolicy:
            enabled: true
        backup:
            enabled: true
            cronjob:
                storage:
                    storageClass: replicated
                    size: 10Gi
sops:
    kms: []
    gcp_kms: []
    azure_kv: []
    hc_vault: []
    age: []
    lastmodified: "2024-04-07T12:28:40Z"
    mac: ENC[AES256_GCM,data:eEHei5fR8moEdnh+6+hY1n8lEfo6H6deA562OXSu1PQNvqVMldYsZZeWWWCrDFWUJitF05uge5SRWYYBtS4nFwlnmvJOPzmpfvnv9ZCYBXM9I+D2j6SY0wVBc+YHXVn42paTLYam1lSygvNPlizu5A458n+f3GEJICHulCYKCmc=,iv:2/mYUVdvjRrpjKSFtWeGUbFeOuLCt8Tu63yoOK4R8eI=,tag:5DVKyK1A1KNW2GELi6ghpg==,type:str]
    pgp:
        - created_at: "2024-04-07T12:28:40Z"
          enc: |-
            -----BEGIN PGP MESSAGE-----

            hJ4D0dRkdsWQFPUSAwMExDx+dvpIhCA4EAJt6vcT6S2srmWTkjZTZneK4ZB0plxM
            sKBbhKoShP1p0cfKeYmQt7yQuQFk0K+m1g02F9OBRtZmwBXHE7cKg3tkmnswWtSm
            N5Ik7e5OX4el3X7i/MojMIZ0o+wyb8AHU/HXoknnWo6OX0lUDVKSTAmTgl1Otdd8
            34Vb7UBzdXpiY/zExmioydRoAQkCEBBshPVdt87n6gQx5em0I7t3mAJbPQImeSFx
            EfqaBFOhm5aVhRH32yLlaKC2aDCviHKDyZWk37sZRhtUOFiqtgfXlq2lnO/+/tWW
            Hp4npEtIVfUB9A6RlpO1/MMxudS4uC9dIco=
            =1ONx
            -----END PGP MESSAGE-----
          fp: 0F003E832B1DA1A11CA9F206712F90FA248BBBC2
        - created_at: "2024-04-07T12:28:40Z"
          enc: |-
            -----BEGIN PGP MESSAGE-----

            hJ4DLG005yzvDc8SAwMEddbEUpj6xZNtFt1yEAJ+n4Qz7aT6vLnyUA+lDCgLG/bO
            p8u2UBgx2oieVyVq4duyO4Z76/O5GPlCrM7t7eBn7kXwO5GTmCTcJk9dCS7DDVDB
            nP0kd1q0FDsZCC8UvWw/MLHbP4BBr9DCLGUtGXvo8bexEo045lNi2o8qXhKz8cbj
            GYFtuyB1Pfrnr5kdbMa36NRoAQkCENa/47RfmZjAtypK0Gb0jyqvn9Cia+FTiWWg
            3wK4F01RVF8PMvxjJ8/sNHVfDaE6mxWxuFjF2kY/aqV0xMtdpV3FaVJoij44l3pV
            Tzv1q41nVEr3OFKV/9IVIlRkWD5rk0tEsXM=
            =U4a0
            -----END PGP MESSAGE-----
          fp: 1918B94484C52CDE42CA1B87E7812096B8DA4A52
    encrypted_regex: ^(password|repmgrPassword|adminPassword|postgresPassword)$
    version: 3.8.1
