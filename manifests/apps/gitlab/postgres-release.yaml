apiVersion: helm.toolkit.fluxcd.io/v2beta1
kind: HelmRelease
metadata:
    name: postgres
    namespace: gitlab
spec:
    interval: 10m0s
    chart:
        spec:
            chart: postgresql-ha
            version: '>=14.0.2 <14.1.0'
            sourceRef:
                kind: HelmRepository
                name: bitnami
                namespace: gitlab
            interval: 1m
    values:
        global:
            storageClass: replicated
            postgresql:
                username: gitlab
                password: ENC[AES256_GCM,data:O+yeecNoLUZjGinad3xIyiaZveTJN41i8b6rMW9Imn4=,iv:qmXZrHTZyFT/VgG9+mRk+xYMMNdLsa0DZfI+rdbr6GU=,tag:iSanaOqpipuvfMfjojPHyw==,type:str]
                database: gitlab
                repmgrUsername: repmgr
                repmgrPassword: ENC[AES256_GCM,data:dju/T6NwYOuGv1DQ3fTV9QjWJ7EkAX82QgBqCGxyD8c=,iv:+RmKAO21DEfflsSvtOy+ag/ArbM8X2PZen9361lUIVk=,tag:C8WnsepPIQ5I7aEvFppXIQ==,type:str]
            pgpool:
                adminUsername: pgpool
                adminPassword: ENC[AES256_GCM,data:PKu3rUqtXWLWSS5iTp8/rFD9/I/NaQZEURtsMwyYPmg=,iv:unxIeKq4+IrdkkeWo11B8ar1sU+jNnikaJJmaDU4mXY=,tag:hI07U3g//YVXGg4rAHWbMA==,type:str]
        postgresql:
            podLabels:
                app.omnilium.local/identifier: postgres-gitlab
            affinity:
                podAntiAffinity:
                    preferredDuringSchedulingIgnoredDuringExecution:
                        - weight: 100
                          podAffinityTerm:
                            labelSelector:
                                matchLabels:
                                    app.omnilium.local/identifier: postgres-gitlab
                            topologyKey: topology.omnilium.local/host
            topologySpreadConstraints:
                - labelSelector: null
                  matchLabels:
                    app.omnilium.local/identifier: postgres-gitlab
                  topologyKey: topology.kubernetes.io/zone
                  maxSkew: 1
                  whenUnsatisfiable: ScheduleAnyway
            extraVolumes:
                - name: dshm
                  emptyDir:
                    medium: Memory
                    sizeLimit: 256Mi
            extraVolumeMounts:
                - name: dshm
                  mountPath: /dev/shm
            resourcesPreset: small
            password: ENC[AES256_GCM,data:NWlaiorxv9jmislk/mLMUI9f1GEeFFghYZ6yrbH7HRg=,iv:TNAHE84JzVWvP6Q5I/siRzRXHOmUUcVkPp7ETJmzE44=,tag:nvnzfaPcpqNddpdvJtAsPA==,type:str]
            postgresPassword: ENC[AES256_GCM,data:hujI+PIlXO6LDOXUqHy4vtbKMFKvpb323Rwct7Z00pg=,iv:RO2KXfcEBn8eignIHDBeytEgS+CO5BLVH+KGZ0fjAlA=,tag:UbsfOIt++qrtiFtufRUlOA==,type:str]
            repmgrPassword: ENC[AES256_GCM,data:sWjKvdekq2jUTvcY256l88zzzgbt3aIDsxglxGr9QTM=,iv:QzNLyks1ToHwt+mc0hvlohP9C6baVZcfvx16hwQ4jBQ=,tag:EQq5NYUcySI25iKAqceDEg==,type:str]
            maxConnections: 200
        pgpool:
            resourcesPreset: small
            adminPassword: ENC[AES256_GCM,data:jGB8JM95mdYG7Y5XqGerk9mgPwluIhDIENbTJARLe0Q=,iv:84vEkps4RISsuj/EQlXfEyMH79kFY/Asvoxlxbi5p04=,tag:yhgQ0psFyGgZK8byaooPOg==,type:str]
            numInitChildren: "10"
            maxPool: "5"
            childMaxConnections: "18"
            childLifeTime: "30"
            clientIdleLimit: "10"
            connectionLifeTime: "30"
        persistence:
            size: 10Gi
        persistentVolumeClaimRetentionPolicy:
            enabled: true
        backup:
            enabled: true
            storage:
                storageClass: replicated
                size: 10Gi
sops:
    kms: []
    gcp_kms: []
    azure_kv: []
    hc_vault: []
    age: []
    lastmodified: "2024-04-07T12:25:32Z"
    mac: ENC[AES256_GCM,data:lTPMnsQS9lg9WCRzXZTc1SVqr3/xCj9ZYQa8wE6T3Ndzg+dpuXcnncR2KcQJ0eYrij3Z2CmFR9B98VsNw1LygvQfGtXuyLFvAKFiyptmYlF+Cy7bJJDlnILdeDkQQvrgsvW3aKlnuIIFK74qu0qEf2CMFYENSrf4NvECsLHa7fk=,iv:kZjMyKX+0wgiRA2oQEFlRQMlxhCeNVdkbqtHNGiYRns=,tag:QwxYx8G2XOx0Z5xikQPJbg==,type:str]
    pgp:
        - created_at: "2024-04-07T12:25:32Z"
          enc: |-
            -----BEGIN PGP MESSAGE-----

            hJ4D0dRkdsWQFPUSAwMErU8/Zu9Dk3HJ6tXUZhtQpjVr1m66IyI7v0SrkQaPM5JL
            Z1Ozo5uVkEDaq7n8h91g6xkh6n8iDSjIglJRbwnx9IzY/8k6u0KUQH7LnC7VH3eX
            aCSO29zejlnsrIIFO1jcMJZY63/F4EodwmOpPKu5lxeI8vvuub2EJAy/OEE7cHI9
            0ktxdx6DqTVPnut12h4T7NRoAQkCEDDK2REPds22cdaXcRWKhFjJYUA2Hp/VFvBJ
            ZdHW9Mv0A/igUV9k3IbKvX7UOzjO7FmUX7G4sGCCxZVTXIBV6QQibatuuEpk6Nmk
            olW3krWj2R0Po0ZAW8KDOK3wpNZr0B8CK1o=
            =WsHM
            -----END PGP MESSAGE-----
          fp: 0F003E832B1DA1A11CA9F206712F90FA248BBBC2
        - created_at: "2024-04-07T12:25:32Z"
          enc: |-
            -----BEGIN PGP MESSAGE-----

            hJ4DLG005yzvDc8SAwMEGoMGbpY3WLylMspMJdVJ950FLK9AYhTw81Q/eqWY2glo
            SlCayNagJypKXOUMJhg4r3ULM9a6lP0T0wVA+PAvdrNxb6vUVkt/WTp3ZeHmopE5
            fuyQfgY/CxPYxcFR1a/pMEtPmsHVZaHR+NVHOWstUImgVuGToTLZTTSCuR//70ZA
            CyacGhJHl1fiDlXFvxrLEdRoAQkCEE8QYlupIlWcSoPtlLZf2JpydHxQFUhq/WMP
            LVU7kJCNhDqvWucOMEvcTfn81HsUjQrfI8R/HPzpjBSMo4A1mgFEHGWVwiEYvz6H
            nrgRquGS8bvdi6XicM7k4CjdCcyRVxGlx58=
            =SChw
            -----END PGP MESSAGE-----
          fp: 1918B94484C52CDE42CA1B87E7812096B8DA4A52
    encrypted_regex: ^(password|repmgrPassword|adminPassword|postgresPassword)$
    version: 3.8.1
