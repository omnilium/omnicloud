apiVersion: helm.toolkit.fluxcd.io/v2beta1
kind: HelmRelease
metadata:
    name: postgres
    namespace: gitlab
spec:
    interval: 10m0s
    chart:
        spec:
            chart: postgresql-ha
            version: '>=14.0.2 <14.1.0'
            sourceRef:
                kind: HelmRepository
                name: bitnami
                namespace: gitlab
            interval: 1m
    values:
        global:
            postgresql:
                username: gitlab
                password: ENC[AES256_GCM,data:RQ4yU2wMsb/Cc5zyg9QawGifuJcx8SDAvfnqU2Z/YuA=,iv:lJh5SJeNuSzHQGOOK1h9tXelrtZoyuomxu/fpkE+ylQ=,tag:GEVU2dNsokyRRaTD6bXkvg==,type:str]
                database: gitlab
                repmgrUsername: repmgr
                repmgrPassword: ENC[AES256_GCM,data:0ALAHZtO6QOQJpACW/cCdDGcI79B9wrxjaIGRZIfGEs=,iv:YQD6tvGy9/oPzluyaLm989/D6GOT8NU7fP2HZ6988dE=,tag:uMcl6Tbb1iqLfcK3qyMvdg==,type:str]
            pgpool:
                adminUsername: pgpool
                adminPassword: ENC[AES256_GCM,data:PfLUIkVIoCV/PsXbBVgV75OWEADkIXDQRE15m09XY9U=,iv:x1Oa1wJSz2E1/g7sdfBiviDZlw3FtUXZ+FHbODubX+U=,tag:V5veTWu/57kdh13VjDMF4g==,type:str]
        postgresql:
            podLabels:
                app.omnilium.local/identifier: postgres-gitlab
            affinity:
                podAntiAffinity:
                    preferredDuringSchedulingIgnoredDuringExecution:
                        - weight: 100
                          podAffinityTerm:
                            labelSelector:
                                matchLabels:
                                    app.omnilium.local/identifier: postgres-gitlab
                            topologyKey: topology.omnilium.local/host
            topologySpreadConstraints:
                - labelSelector: null
                  matchLabels:
                    app.omnilium.local/identifier: postgres-gitlab
                  topologyKey: topology.kubernetes.io/zone
                  maxSkew: 1
                  whenUnsatisfiable: ScheduleAnyway
            extraVolumes:
                - name: dshm
                  emptyDir:
                    medium: Memory
                    sizeLimit: 256Mi
            extraVolumeMounts:
                - name: dshm
                  mountPath: /dev/shm
            resourcesPreset: small
            password: ENC[AES256_GCM,data:aofZp6iH7PG9R0Ycr7XfI2gVleREOvcjuEXDwmCAv58=,iv:dJxViEzUR5O8ZMjR6ydiPGuNZ0muZn7eyOCSGLAEmyA=,tag:Jd5NG84gaBnoJNHKjG8QBQ==,type:str]
            postgresPassword: ENC[AES256_GCM,data:+wU+OSfZcUwZbYjqP4rm1s+4DTw47scPb/2pGItnV8k=,iv:zgq5EN7U7E25Toc6fzzhA35XnIiP3zVsYy2P+gmnino=,tag:fLXyHLeZWVX/ASNfwQ6UFw==,type:str]
            repmgrPassword: ENC[AES256_GCM,data:kQYF8BNiR6vgVB6ZkUBdZ76glXAEKlkUC/XnYzmLAwY=,iv:3Z8RAXfffj5+Jd6Z/jT9lCSO2gCtaNI5wjerGXkQ6AI=,tag:yFBWf/fJGx6x9eIkCzguOw==,type:str]
            maxConnections: 200
        pgpool:
            resourcesPreset: small
            adminPassword: ENC[AES256_GCM,data:D5BZUj83ttX6z1eN0BgCrbVd7JGdVAeXZ5ADHadUd/I=,iv:btLJ7pTnsjJstVO4Xlcb3u0O8vq6SkA/XWjM1DC8jV8=,tag:C68dDtuvFkKhe8tLiNcQzg==,type:str]
            numInitChildren: "10"
            maxPool: "5"
            childMaxConnections: "18"
            childLifeTime: "30"
            clientIdleLimit: "10"
            connectionLifeTime: "30"
        persistence:
            size: 10Gi
        persistentVolumeClaimRetentionPolicy:
            enabled: true
        backup:
            enabled: true
            cronjob:
                storage:
                    storageClass: replicated
                    size: 10Gi
sops:
    kms: []
    gcp_kms: []
    azure_kv: []
    hc_vault: []
    age: []
    lastmodified: "2024-04-07T12:35:28Z"
    mac: ENC[AES256_GCM,data:yY1ItRnuO5dsxOwJtWs22xOgJlCnDD+RbPzVeVooc4Gahcype0B+F7xDJweOtq8emT7WvpHfH8Z7ajOHgJzQ4g2p5pulaoFSMjx2PoGRm42dyAzF4/t9f46tryvf1BTmPsR9qoKB3WIJoSIYJa//zZZIy2sobfQVKzr8xDr5BXs=,iv:Iu+j0T2IluaqVKfz8pnPDqZ8AWuZJMkQqLc3v1BcxrA=,tag:FzW/US1cFBht0+t6TP+MzQ==,type:str]
    pgp:
        - created_at: "2024-04-07T12:35:28Z"
          enc: |-
            -----BEGIN PGP MESSAGE-----

            hJ4D0dRkdsWQFPUSAwME9Fvn8UzXdxn2LJApcgUHiHwLx2Sbm3KoQZIMLwp8NKHs
            m20g7w3IozLM7GHy8QdRDkoOZmV54q2v5Ytk36ULX6KsnSVBgTVAG+ic+kFyV+TM
            YgmTtnTUGNiBcfDovc1qMJ6Madykg3FtKkJtjL8rnutUZvXHbcomzvLg9SZt9loA
            plgs6+I2fVkFlZ/egtVrZdRoAQkCEEYRgEJO1fCne27doPz/qUrQ4Jw5Z3lBeESZ
            qI7kiJCPV5oLPrgCEy+6XG/W7x+aLRFKifNZBGvUrhdkFTyEzaOzMwTKG8fI8a9x
            l0b8UEwMCJn80r/O0BcSxoj3iP5MzzZythc=
            =kmHN
            -----END PGP MESSAGE-----
          fp: 0F003E832B1DA1A11CA9F206712F90FA248BBBC2
        - created_at: "2024-04-07T12:35:28Z"
          enc: |-
            -----BEGIN PGP MESSAGE-----

            hJ4DLG005yzvDc8SAwMEOH5lziz5mRbntLQzBehljHr1P7YqSE21v9wX6xgRbVpY
            B8+mlLQ2fsqf8JY6uVlpQJIdZRTzz5SvVsOQsPFn2VNXZ6CCIoTPfI7zU+RWIdXo
            68reV3pE6fsb3kugaygVMFbfDfRFfrYgjDPxjThLkfJmsMnV4k6MHz9mIG1BdDkD
            tq0T6FqYLy/97GRviodbktRoAQkCEAd433hP/X1tB1Igx9bh+ZhjLUozSefiN1Nx
            Hh2CQbvw1Ke5fp9POfm3GzZatp2THRQl6Qjaf4jk1kVQYbahPB79vQ8hdhadphV6
            FU71ni0N5iH9oaqZTTIoDfZG8Z24nsSrMJE=
            =+EO7
            -----END PGP MESSAGE-----
          fp: 1918B94484C52CDE42CA1B87E7812096B8DA4A52
    encrypted_regex: ^(password|repmgrPassword|adminPassword|postgresPassword)$
    version: 3.8.1
