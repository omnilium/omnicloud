apiVersion: helm.toolkit.fluxcd.io/v2beta1
kind: HelmRelease
metadata:
    name: postgres
    namespace: gitlab
spec:
    interval: 10m0s
    chart:
        spec:
            chart: postgresql-ha
            version: '>=14.0.2 <14.1.0'
            sourceRef:
                kind: HelmRepository
                name: bitnami
                namespace: gitlab
            interval: 1m
    values:
        global:
            postgresql:
                username: gitlab
                password: ENC[AES256_GCM,data:efVEnvFYsUQuANLJ8bucLq3YzQCmzTeZS/0bl9YMpF8=,iv:CR1JBEgTibs0oc7rRNqIK0kgCDQYZvWPzOvyy+2XaUQ=,tag:Jn7GaoCjqr3JjkD1uQit5A==,type:str]
                database: gitlab
                repmgrUsername: repmgr
                repmgrPassword: ENC[AES256_GCM,data:ejl5e+3aZ0g9s2MY1CM+wLT3jS40E4g2MToOSoNW9ww=,iv:yQcyCQfAlD0usS7CQsLfzC8nHkeApjmfffBzFpKru8w=,tag:F2tu+/6hHEu7Y2Zy9S6i3g==,type:str]
            pgpool:
                adminUsername: pgpool
                adminPassword: ENC[AES256_GCM,data:845iFbwJ/E1aQ3DagpeBFEltZOpQUrG5YqcR1G05uqI=,iv:SsrwVacAqRuoqGw0NWKWkC6zf9pdHE5PFBfazRzHf8w=,tag:A9TxAJgyaNxrTCBUy45rUw==,type:str]
        postgresql:
            podLabels:
                app.omnilium.local/identifier: postgres-gitlab
            affinity:
                podAntiAffinity:
                    preferredDuringSchedulingIgnoredDuringExecution:
                        - weight: 100
                          podAffinityTerm:
                            labelSelector:
                                matchLabels:
                                    app.omnilium.local/identifier: postgres-gitlab
                            topologyKey: topology.omnilium.local/host
            topologySpreadConstraints:
                - labelSelector: null
                  matchLabels:
                    app.omnilium.local/identifier: postgres-gitlab
                  topologyKey: topology.kubernetes.io/zone
                  maxSkew: 1
                  whenUnsatisfiable: ScheduleAnyway
            extraVolumes:
                - name: dshm
                  emptyDir:
                    medium: Memory
                    sizeLimit: 256Mi
            extraVolumeMounts:
                - name: dshm
                  mountPath: /dev/shm
            resourcesPreset: small
            password: ENC[AES256_GCM,data:s5qPF8IM9TXHRK1VjxqGwL+De8/fQk/WFAoX0RCvZ+E=,iv:8BLmMQwVw6cpJlESN+EVL3qIuu/ee6kr8sbZKp+S8Eo=,tag:x/u1hlphmZiVEEpgbq1vRQ==,type:str]
            postgresPassword: ENC[AES256_GCM,data:upydcHd6f73u2/RzkiCdiprUhByREk4NaWpcNTebzu0=,iv:u5ZurX8KPCdvD8loBZ5SlTHsm3zW2xGzkOm9mR3WOiI=,tag:jxTuZ+avBJsjNEMTBiiVDg==,type:str]
            repmgrPassword: ENC[AES256_GCM,data:Sf5IB+PH+pkrUt+N8Z+USoOvAeKwv2AexO2ZWjg2qAA=,iv:Jrq0TL9n1GZsMVQfzgow5SWevzkmDzVbSCcBEzlcOy0=,tag:q1vEr1PgwBfDkA4cdBArLg==,type:str]
            maxConnections: 200
            postgresConnectionLimit: 20
            dbUserConnectionLimit: 180
        pgpool:
            resourcesPreset: small
            adminPassword: ENC[AES256_GCM,data:fT16XaYPq/FLtpJdZH5nNW7hEh+2cvRNMB1YnbG75aE=,iv:9NfvptGUi5z5R5mIp1QhXsnH3I3DCwNW/ImiRYiYiKw=,tag:5fBThZs5NPr9wFI1t0cpMQ==,type:str]
            numInitChildren: "30"
            maxPool: "6"
            clientIdleLimit: "5"
            connectionLifeTime: "10"
        persistence:
            size: 10Gi
        persistentVolumeClaimRetentionPolicy:
            enabled: true
        backup:
            enabled: true
            cronjob:
                storage:
                    storageClass: replicated
                    size: 10Gi
sops:
    kms: []
    gcp_kms: []
    azure_kv: []
    hc_vault: []
    age: []
    lastmodified: "2024-04-07T13:35:16Z"
    mac: ENC[AES256_GCM,data:HOUDAoW39K2XWvGPXUvXJjuuZsbL4vqY7jTO+rSnh1B+a6xTbHhcQZXcZWeKxgXA4QaYv8pF5nOdK0T4XWysKN9QYSMKFmaC3GFWNtyFDJb7z0E+9ejwmleBqyGjr54zvYaSTj8negRA3n189agYwBJyITU5fZEfcC7XX9WrwFE=,iv:leySbrngCFcikKSc+Xa6XXwZIOTeXSJEgPyndGuOoRQ=,tag:9/oZDAd56Z4skyuL36V2tQ==,type:str]
    pgp:
        - created_at: "2024-04-07T13:35:16Z"
          enc: |-
            -----BEGIN PGP MESSAGE-----

            hJ4D0dRkdsWQFPUSAwMEIMVt2fbMlRZdI/U86lpZpBD93HiwBofpZktWrtw/U5tQ
            RJGYZxStPci6viRY1MVo/2I56cDzEdlq970l1+jCPlTaDnqxjXVF33i0A6j68wW6
            gqGK5tUxVzST04cZFkxRMFevDsbxcYFXZJVW99oC4P7cKSPFIbAiUlgdhdQD6PMT
            mrUvdrEklYQL4NpdIdFETtRoAQkCEM1Lunesh4RWDwewPpmDCRTZqSOIwE4l7xHN
            izeTZ1lLoJXDI8FHKQg+BwLFGzbPUpMQsZlX/bwnaqam68tO0VESoQ25CSnsn+/l
            BJSi9WLi19z8HAWnOdrhbOy6JrtODJXVils=
            =dsfd
            -----END PGP MESSAGE-----
          fp: 0F003E832B1DA1A11CA9F206712F90FA248BBBC2
        - created_at: "2024-04-07T13:35:16Z"
          enc: |-
            -----BEGIN PGP MESSAGE-----

            hJ4DLG005yzvDc8SAwMEOyeSRPWTiLllpYvz6EimHg1C86DW0LdzZG6NgRT00wXi
            j0wOYVteeJZ27bHvDwlU34uJL/o1K4XcFZlEcoNMXEEaBOltZKiZo+sAvQ6Gis84
            v6cf7xaz3V6bBcSCxj8VMGU3ufkdeChMIiKCYfwbtB6W9YCk8v5IPKQeEPhwMicE
            811Vyv5ZaVaGrYjAdyjFhNRoAQkCENZp1Qn8/82Q/6Un4z9niLnLGN6nREWEM/GV
            LuX7mn5mdejhudn4uiJO6ZKns1FmVaMtVa1haFGl2U5Avq8gyr91857dtpIB9F3A
            Vr8t23vM4mzMQwee8DqWzi/HUNX6kURgePU=
            =SrNW
            -----END PGP MESSAGE-----
          fp: 1918B94484C52CDE42CA1B87E7812096B8DA4A52
    encrypted_regex: ^(password|repmgrPassword|adminPassword|postgresPassword)$
    version: 3.8.1
