apiVersion: helm.toolkit.fluxcd.io/v2beta1
kind: HelmRelease
metadata:
    name: redis
    namespace: gitlab
spec:
    interval: 10m0s
    chart:
        spec:
            chart: redis
            version: '>=19.0.2 <19.1.0'
            sourceRef:
                kind: HelmRepository
                name: bitnami
                namespace: gitlab
            interval: 1m
    values:
        auth:
            password: ENC[AES256_GCM,data:HuxPcCkVakQ07di6T4mWtaGXZUsQIp9CCFyfT/spIV8=,iv:aDWwPtgkAiLc8hf5n5N0o/MJwe6hvhTgIecAqu20+xk=,tag:hqMRwPDr60O8MXotN/Gryg==,type:str]
        master:
            resourcesPreset: micro
            podLabels:
                app.omnilium.local/identifier: redis-gitlab
            affinity:
                podAntiAffinity:
                    preferredDuringSchedulingIgnoredDuringExecution:
                        - weight: 100
                          podAffinityTerm:
                            labelSelector:
                                matchLabels:
                                    app.omnilium.local/identifier: redis-gitlab
                            topologyKey: topology.omnilium.local/host
            topologySpreadConstraints:
                - labelSelector: null
                  matchLabels:
                    app.omnilium.local/identifier: redis-gitlab
                  topologyKey: topology.kubernetes.io/zone
                  maxSkew: 1
                  whenUnsatisfiable: ScheduleAnyway
            persistence:
                size: 10Gi
        replica:
            replicaCount: 3
            resourcesPreset: micro
            podLabels:
                app.omnilium.local/identifier: redis-gitlab
            affinity:
                podAntiAffinity:
                    preferredDuringSchedulingIgnoredDuringExecution:
                        - weight: 100
                          podAffinityTerm:
                            labelSelector:
                                matchLabels:
                                    app.omnilium.local/identifier: redis-gitlab
                            topologyKey: topology.omnilium.local/host
            topologySpreadConstraints:
                - labelSelector: null
                  matchLabels:
                    app.omnilium.local/identifier: redis-gitlab
                  topologyKey: topology.kubernetes.io/zone
                  maxSkew: 1
                  whenUnsatisfiable: ScheduleAnyway
            persistence:
                size: 10Gi
        sentinel:
            enabled: true
            masterSet: gitlab
            automateClusterRecovery: true
            downAfterMilliseconds: 2000
sops:
    kms: []
    gcp_kms: []
    azure_kv: []
    hc_vault: []
    age: []
    lastmodified: "2024-04-07T12:54:16Z"
    mac: ENC[AES256_GCM,data:OXY60iUjG8TwGY1mOTc76OPHZGH1LK2WHp7ZpUvUkNKcjWBFP7sb7EJJ+9CUPD3zCmX7Kaj11lK3oqMRar1gAbAsQef8u8HfViZQsE2Xn3s9FVVR0Jt8ZPWXMghgEsP2V3vuylyd/10G5FhpMu5Ljj11DHxZbNfcAvxjhxZXCGw=,iv:4Bbo39FcELBjGalO8nfDAkvwoNTM4kDyh7mYeRaU0HM=,tag:uqylJ0CqKx+31mUDGUeM7g==,type:str]
    pgp:
        - created_at: "2024-04-07T12:54:16Z"
          enc: |-
            -----BEGIN PGP MESSAGE-----

            hJ4D0dRkdsWQFPUSAwMEUL0BsdQh8tF51Dag7/mNBDJmYt8uhFsGt4uIrU+4OdEf
            WbvmIw30lxwekAZcZbJA8nBnw3Hz92PS++OXHQoowAGuXVKST6EKmwPfJRU/UPW/
            +pI+nnvBBjd6P/wQ6UaOMP6JKIvlI5ivFpN1TwQ4alDdgjrsBYmfNrXWaNua3/c9
            oHZqp0laueKCJWO/ZyebMdRoAQkCEKs26kwEDF2pMs5Nb05o/bzAioEpfG/c6EZ7
            lbeqYLjl93F1WlkM7+B7wnvaKcsNHyWk/1BgeigtA4p8f2xnlHdCjNFl0oEN0Run
            6pzX2zOp2Oi2OclMNKZ4EUcRPRdpMV4hH5s=
            =D3yw
            -----END PGP MESSAGE-----
          fp: 0F003E832B1DA1A11CA9F206712F90FA248BBBC2
        - created_at: "2024-04-07T12:54:16Z"
          enc: |-
            -----BEGIN PGP MESSAGE-----

            hJ4DLG005yzvDc8SAwMEiMS5/FjfHwjLGN3yK2brflTtCHGj/Ss7meNoTzB4yGcD
            GlV/g430VLkhV37yh87OlHFxALUHKecPIcauxMWDrUq/aEimPI977jWV5ucuFoql
            F7TMtMCl/JsvaYyUR/sNMMoqSfGu6xLKRYEZG529piZpR75iSAn2vQXFEnsrAKGG
            kS3dnR0PPCYWzHOoR7iHPdRoAQkCEBiTsoDniQjx4O+MVYmmInjuaSseS3zJuub6
            Zug8u9k1k/rhBcfGSdRkGMMpLW5F4AmPUMJuQc34OahSUKyWX1ixr2mHvLioBczL
            VDes9eYFs5sZsyPatcwBIXPka62WU83T7Ic=
            =YF+D
            -----END PGP MESSAGE-----
          fp: 1918B94484C52CDE42CA1B87E7812096B8DA4A52
    encrypted_regex: ^(password)$
    version: 3.8.1
