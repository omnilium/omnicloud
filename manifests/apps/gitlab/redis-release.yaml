apiVersion: helm.toolkit.fluxcd.io/v2beta1
kind: HelmRelease
metadata:
    name: redis
    namespace: gitlab
spec:
    interval: 10m0s
    chart:
        spec:
            chart: redis
            version: '>=19.0.2 <19.1.0'
            sourceRef:
                kind: HelmRepository
                name: bitnami
                namespace: gitlab
            interval: 1m
    values:
        auth:
            sentinel: false
            password: ENC[AES256_GCM,data:wkAzUGziHLOUBv9uLeK7i/BD2K2TLWUU7GNdi/0zj54=,iv:6vYTjUysY5OYoGgY0fDdou/4tbWtLhmKhW1RDUzc9iU=,tag:0vtuTBnM5n0l3cAe7tdeew==,type:str]
        master:
            resourcesPreset: micro
            podLabels:
                app.omnilium.local/identifier: redis-gitlab
            affinity:
                podAntiAffinity:
                    preferredDuringSchedulingIgnoredDuringExecution:
                        - weight: 100
                          podAffinityTerm:
                            labelSelector:
                                matchLabels:
                                    app.omnilium.local/identifier: redis-gitlab
                            topologyKey: topology.omnilium.local/host
            topologySpreadConstraints:
                - labelSelector: null
                  matchLabels:
                    app.omnilium.local/identifier: redis-gitlab
                  topologyKey: topology.kubernetes.io/zone
                  maxSkew: 1
                  whenUnsatisfiable: ScheduleAnyway
            persistence:
                size: 10Gi
        replica:
            replicaCount: 3
            resourcesPreset: micro
            podLabels:
                app.omnilium.local/identifier: redis-gitlab
            affinity:
                podAntiAffinity:
                    preferredDuringSchedulingIgnoredDuringExecution:
                        - weight: 100
                          podAffinityTerm:
                            labelSelector:
                                matchLabels:
                                    app.omnilium.local/identifier: redis-gitlab
                            topologyKey: topology.omnilium.local/host
            topologySpreadConstraints:
                - labelSelector: null
                  matchLabels:
                    app.omnilium.local/identifier: redis-gitlab
                  topologyKey: topology.kubernetes.io/zone
                  maxSkew: 1
                  whenUnsatisfiable: ScheduleAnyway
            persistence:
                size: 10Gi
        sentinel:
            enabled: true
            masterSet: gitlab
            automateClusterRecovery: true
            downAfterMilliseconds: 2000
sops:
    kms: []
    gcp_kms: []
    azure_kv: []
    hc_vault: []
    age: []
    lastmodified: "2024-04-07T12:58:13Z"
    mac: ENC[AES256_GCM,data:BCh8wrKs+bww2A2b9WvGpfirjQm3WAUgdOiIGEQwXgK8UqSQcipEw+1KBJo4v5xRiiwweQswTXANkuVdCv+5ZDJcy8Swpt0KKqU+g+0Xxpe2knJNf0QYslrBMYf4alwv49XTa6SF82G0npAcy7PyIdR2kojCRYwUzEzAXUuCvGQ=,iv:XKSHHyj6wQtOiOJIltxvwUTEf4PbjmZljvXCmFkp/cQ=,tag:L/V1rlBbgOT0P9fw+0084w==,type:str]
    pgp:
        - created_at: "2024-04-07T12:58:13Z"
          enc: |-
            -----BEGIN PGP MESSAGE-----

            hJ4D0dRkdsWQFPUSAwMEIoHhyJ1eZWEkcd9osd/zPUVwekT6RghhV56A/+/urQ7B
            Sw4ZES+XwELbFcWDD+TtowWYPukD1drjBb/CcQRvHr41WiRKznaCqqxaPbiXxG+n
            DH5CyY/nBZ4tTzXVcMgMMLqiNRhXlie6NhaCdDIGAbhnZavsTzNr57mqPnlui3UF
            aubu2KKyt0mduzV/Sf0qlNRoAQkCEGiiDJcSTXnPsw0fNJYfBb21o65RTaZsgTjy
            noPxo8nrAKp0C8V2ydrNCNKVsKKgwLciXbpK4Q7R+fuuVtOjFbOfkBIkdpQDv0Oe
            qlDhRHzfQT9StZKkfTUJ7n2r1BmoTkjydBo=
            =A3Da
            -----END PGP MESSAGE-----
          fp: 0F003E832B1DA1A11CA9F206712F90FA248BBBC2
        - created_at: "2024-04-07T12:58:13Z"
          enc: |-
            -----BEGIN PGP MESSAGE-----

            hJ4DLG005yzvDc8SAwMElQ8U2kMT2VTgDtYSh1AGYE1PFgTRRQ+kUzTWX3/0YtWV
            bx6Mb1Hpv04W5th8vsnn1XvHMnkw6VIjmOf3KXWw/hDW2p2kNamBDzowE2diaORC
            BqApvdiuHRID1VEmWZAhMHeo6V5s4z+2VUce2EdonchkKlgnFmzLZVdYUyFEgeOZ
            lJqZAf9N3uUzi4UqPFSb49RoAQkCEAjWAXGGmkxSVwCmVVYDEBgJJqgIAeoATPD8
            dd6W4N0ZbEXyVV+4Y4Fcas7yW+kKxtPUJ+zaIb2LoRx7x2ARarUitZRKi4duoDj5
            qjmXRf7s2X0bGS8SexFMBal1d0fSqvIHM58=
            =0AAn
            -----END PGP MESSAGE-----
          fp: 1918B94484C52CDE42CA1B87E7812096B8DA4A52
    encrypted_regex: ^(password)$
    version: 3.8.1
