apiVersion: helm.toolkit.fluxcd.io/v2beta1
kind: HelmRelease
metadata:
    name: redis
    namespace: gitlab
spec:
    interval: 10m0s
    chart:
        spec:
            chart: redis
            version: '>=19.0.2 <19.1.0'
            sourceRef:
                kind: HelmRepository
                name: bitnami
                namespace: gitlab
            interval: 1m
    values:
        auth:
            sentinel: false
            password: ENC[AES256_GCM,data:XO09vC4ezXKL2yJOL3nskSUfVO43GnBVkKPVCdRjp9s=,iv:QoKmunngrcoPYCP5z0TBoEQv5TdUgNDN34oTeyBote8=,tag:wb2VyIiEMF9czp8fbEwDnA==,type:str]
        master:
            resourcesPreset: micro
            podLabels:
                app.omnilium.local/identifier: redis-gitlab
            affinity:
                podAntiAffinity:
                    preferredDuringSchedulingIgnoredDuringExecution:
                        - weight: 100
                          podAffinityTerm:
                            labelSelector:
                                matchLabels:
                                    app.omnilium.local/identifier: redis-gitlab
                            topologyKey: topology.omnilium.local/host
            topologySpreadConstraints:
                - labelSelector: null
                  matchLabels:
                    app.omnilium.local/identifier: redis-gitlab
                  topologyKey: topology.kubernetes.io/zone
                  maxSkew: 1
                  whenUnsatisfiable: ScheduleAnyway
            persistence:
                size: 10Gi
            priorityClassName: high
        replica:
            replicaCount: 3
            resourcesPreset: micro
            podLabels:
                app.omnilium.local/identifier: redis-gitlab
            affinity:
                podAntiAffinity:
                    preferredDuringSchedulingIgnoredDuringExecution:
                        - weight: 100
                          podAffinityTerm:
                            labelSelector:
                                matchLabels:
                                    app.omnilium.local/identifier: redis-gitlab
                            topologyKey: topology.omnilium.local/host
            topologySpreadConstraints:
                - labelSelector: null
                  matchLabels:
                    app.omnilium.local/identifier: redis-gitlab
                  topologyKey: topology.kubernetes.io/zone
                  maxSkew: 1
                  whenUnsatisfiable: ScheduleAnyway
            persistence:
                size: 10Gi
            priorityClassName: medium
        sentinel:
            enabled: true
            masterSet: gitlab
            automateClusterRecovery: true
            downAfterMilliseconds: 2000
sops:
    kms: []
    gcp_kms: []
    azure_kv: []
    hc_vault: []
    age: []
    lastmodified: "2024-04-07T14:45:48Z"
    mac: ENC[AES256_GCM,data:ssiN+UKJjRIpsZq1Wy6+Brog37t5DoTuQHjUriqRhaEGGuFaBnkUw6M2UKrU/x8z5Ecgs0PDKLYffmRtivtbY1w/s9JaCX0ZqgK6jjSge7e+4XvNEUj7hp7/vfqRZgUra9yGwFECrxjYWENSfSCtpOYOH0t1LQI3LkWCTEzAS+8=,iv:VjOJe/cJYneMHsfaufr9Bf/IHYn6BAeJ0oP3SZt3Ntg=,tag:EiaUW3bt5jvrTQ8djTAZ2w==,type:str]
    pgp:
        - created_at: "2024-04-07T14:45:48Z"
          enc: |-
            -----BEGIN PGP MESSAGE-----

            hJ4D0dRkdsWQFPUSAwMEr6VdXGFtcuKR8y1h3rl2hOyintsKJKQk/WWH8tOW2Swi
            oIxFakc0Ir2678z09WJQb1H4shRUb7xqN96bEYfELBcyKv6gH2sVJvHzJPFmHiMS
            HrupPLUh6Le266TXuuL+MEdqbiJxpeLlv3hmXWkEvvWHSKxw2gKAg1OOKFHn3fFJ
            NASvH096JBubG2DY2HbQOdRoAQkCEFpIt6iOz1bx4ToDnhC3RS3+PgIK9IG3pPin
            1gqhcGktVZgrjvjSE3sJh6cUhtNbpb+F/YUeO3A2dO1FitO7E5rSW74NsCcf9Yz5
            kXGc9YfW4CMPdrQ7YzjIkhHodudYa5CLRSY=
            =OzXW
            -----END PGP MESSAGE-----
          fp: 0F003E832B1DA1A11CA9F206712F90FA248BBBC2
        - created_at: "2024-04-07T14:45:48Z"
          enc: |-
            -----BEGIN PGP MESSAGE-----

            hJ4DLG005yzvDc8SAwME+Kd+xq3xME2hlzncSR44CH52ZSzpRJToJ1orPWH/rEou
            gySx29xkGYUSt3jYY3pwlLEiUJTRAgmJs/SsMoIv3ZYuXtGW7Etivh91PnWBX4bP
            /FEpQUR0MNmgPmaWCy34MBNAQRA8uxdqYZtm7BibhjLP9K2KfTZSvoX8XnW6xNpj
            OzedrtN4YD2dji2vmOSyKNRoAQkCEF6CXKd3bn5T+DnR1gwwMnw8rzUsOXy8pNKu
            xsw5C/F+PHCsk9+6FtNHwV5N64RWUZ400fvoAyA3Swile8QJWSQAzzhupSb0FP+P
            2Uvz3uyp9ccKlUo5PtuKk0vAqfacfd15V8k=
            =wLNf
            -----END PGP MESSAGE-----
          fp: 1918B94484C52CDE42CA1B87E7812096B8DA4A52
    encrypted_regex: ^(password)$
    version: 3.8.1
