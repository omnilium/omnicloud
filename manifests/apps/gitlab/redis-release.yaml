apiVersion: helm.toolkit.fluxcd.io/v2beta1
kind: HelmRelease
metadata:
    name: redis
    namespace: gitlab
spec:
    interval: 10m0s
    chart:
        spec:
            chart: redis
            version: '>=19.0.2 <19.1.0'
            sourceRef:
                kind: HelmRepository
                name: bitnami
                namespace: gitlab
            interval: 1m
    values:
        auth:
            password: ENC[AES256_GCM,data:O88ndKn0PxAWNZoCQBBRBOg+kR2YqPagHnKjy8cNkzQ=,iv:d/NrDfMx+Lqosixtu8hO9NNxS7/b8daY48hdSdhM9y4=,tag:4K6DaNrTYUI9PfztxTAvdQ==,type:str]
        master:
            resourcesPreset: micro
            podLabels:
                app.omnilium.local/identifier: redis-gitlab
            affinity:
                podAntiAffinity:
                    preferredDuringSchedulingIgnoredDuringExecution:
                        - weight: 100
                          podAffinityTerm:
                            labelSelector:
                                matchLabels:
                                    app.omnilium.local/identifier: redis-gitlab
                            topologyKey: topology.omnilium.local/host
            topologySpreadConstraints:
                - labelSelector: null
                  matchLabels:
                    app.omnilium.local/identifier: redis-gitlab
                  topologyKey: topology.kubernetes.io/zone
                  maxSkew: 1
                  whenUnsatisfiable: ScheduleAnyway
            persistence:
                size: 10Gi
        replica:
            replicaCount: 2
            resourcesPreset: micro
            podLabels:
                app.omnilium.local/identifier: redis-gitlab
            affinity:
                podAntiAffinity:
                    preferredDuringSchedulingIgnoredDuringExecution:
                        - weight: 100
                          podAffinityTerm:
                            labelSelector:
                                matchLabels:
                                    app.omnilium.local/identifier: redis-gitlab
                            topologyKey: topology.omnilium.local/host
            topologySpreadConstraints:
                - labelSelector: null
                  matchLabels:
                    app.omnilium.local/identifier: redis-gitlab
                  topologyKey: topology.kubernetes.io/zone
                  maxSkew: 1
                  whenUnsatisfiable: ScheduleAnyway
            persistence:
                size: 10Gi
        sentinel:
            enabled: true
            masterSet: gitlab
            automateClusterRecovery: true
            downAfterMilliseconds: 2000
sops:
    kms: []
    gcp_kms: []
    azure_kv: []
    hc_vault: []
    age: []
    lastmodified: "2024-04-07T12:43:12Z"
    mac: ENC[AES256_GCM,data:hFd/bAi6A0ektHdskWGDT8K3aw6au//64uWzXHINmrjShV+fTtzlCVczzd7BNcXgYfECzmbs2lgxuILX9810pruCp7Tck7bXEGjNC9ndU9N21b0ev0UQBwX0M1+9/kduGulJ2t2gnpxmI5FWpi1rB2qI+KY91Tdf/HTRc0fEPKE=,iv:7sfhwKxOi8OXIsrjI6bqJN97ZE1idYNcGNUVcVXLAQY=,tag:pFpcEtP2kXglyr4/aQrCmw==,type:str]
    pgp:
        - created_at: "2024-04-07T12:43:12Z"
          enc: |-
            -----BEGIN PGP MESSAGE-----

            hJ4D0dRkdsWQFPUSAwMEzrm9/3HIuC8gEHyFSHRL5kgLG++UuqxNSmlPwgsE+2S3
            TIxKRqtEjzyePN9ME0qPdfnvJcQCoRb9F3QzCvO6iFSDk0D7N/tuZnq1JcUn+9XW
            QhVUjA6hQ6qi/gHGi7xQMNn/mllJrq4Ng4Rngfvl/NVGGzLuY3R2spxxBkmGYd/c
            E1GYAABkb+1RNWrhGW6O3NRoAQkCEPPAmgoZYRnHTvGECtz1VT3c7FC8H/hGQPQq
            ijO2Kc3b9wqggChK6RHV3BH2CV+44NbqHbq8Bp6XHNID79Cqqk96Q/HkLRrzoLEf
            T8A76ZPfv8v0wwjRhcYoeXoGW6j+qYSeQTk=
            =E574
            -----END PGP MESSAGE-----
          fp: 0F003E832B1DA1A11CA9F206712F90FA248BBBC2
        - created_at: "2024-04-07T12:43:12Z"
          enc: |-
            -----BEGIN PGP MESSAGE-----

            hJ4DLG005yzvDc8SAwMEoP6QxhQGvRmmZAEiOzP2cDgRbXPVinv571gKLaFUYJDR
            rll3M1qc3PsnlpwYERCcC/d0NMc4YaUkETLA5Pofa2jUgO9H4oGVaB46NakkFSL0
            60UsUq96j2t2+841cJFZMPa4ygasUE3v6oHUiZTj1aXdhuZxTbssMxmRfm6TtNbZ
            rny50sF3ddoetI2UChJYiNRoAQkCEPIFcYFr+Om/f6eV2V0ZxwXiEzuloRtI56qa
            55kehGT/iZNll4BVIeSB1ss75hoiLNORkZ+wyAZTk6fH2Qi++iTOoNkSUTYMhqTP
            ZHHaolhERM43FFPYIoUbOQJaS25U6IpoOak=
            =gsQw
            -----END PGP MESSAGE-----
          fp: 1918B94484C52CDE42CA1B87E7812096B8DA4A52
    encrypted_regex: ^(password)$
    version: 3.8.1
