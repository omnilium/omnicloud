apiVersion: helm.toolkit.fluxcd.io/v2beta1
kind: HelmRelease
metadata:
    name: redis
    namespace: gitlab
spec:
    interval: 10m0s
    chart:
        spec:
            chart: redis
            version: '>=19.0.2 <19.1.0'
            sourceRef:
                kind: HelmRepository
                name: bitnami
                namespace: gitlab
            interval: 1m
    values:
        auth:
            sentinel: false
            password: ENC[AES256_GCM,data:tN9xYU8LlRTcDoEmRBzE08xePGCewDK/FuR9tN7FpuM=,iv:8WMlZzKRFPVKOUIV5y5cu32xCnVD1sjwUtSQMRhrSz0=,tag:BwrQzwGe7mPYHkzaRTM4iA==,type:str]
        master:
            resourcesPreset: micro
            podLabels:
                app.omnilium.local/identifier: redis-gitlab
            affinity:
                podAntiAffinity:
                    preferredDuringSchedulingIgnoredDuringExecution:
                        - weight: 100
                          podAffinityTerm:
                            labelSelector:
                                matchLabels:
                                    app.omnilium.local/identifier: redis-gitlab
                            topologyKey: topology.omnilium.local/host
            topologySpreadConstraints:
                - labelSelector: null
                  matchLabels:
                    app.omnilium.local/identifier: redis-gitlab
                  topologyKey: topology.kubernetes.io/zone
                  maxSkew: 1
                  whenUnsatisfiable: ScheduleAnyway
            persistence:
                size: 10Gi
            priorityClassName: high
        replica:
            replicaCount: 3
            resourcesPreset: micro
            podLabels:
                app.omnilium.local/identifier: redis-gitlab
            affinity:
                podAntiAffinity:
                    preferredDuringSchedulingIgnoredDuringExecution:
                        - weight: 100
                          podAffinityTerm:
                            labelSelector:
                                matchLabels:
                                    app.omnilium.local/identifier: redis-gitlab
                            topologyKey: topology.omnilium.local/host
            topologySpreadConstraints:
                - labelSelector: null
                  matchLabels:
                    app.omnilium.local/identifier: redis-gitlab
                  topologyKey: topology.kubernetes.io/zone
                  maxSkew: 1
                  whenUnsatisfiable: ScheduleAnyway
            persistence:
                size: 10Gi
            priorityClassName: high
        sentinel:
            enabled: true
            masterSet: gitlab
            automateClusterRecovery: true
            downAfterMilliseconds: 2000
sops:
    kms: []
    gcp_kms: []
    azure_kv: []
    hc_vault: []
    age: []
    lastmodified: "2024-04-07T14:48:47Z"
    mac: ENC[AES256_GCM,data:5tFvMrvKuJYJwSUyl+J0p78l4m7XUOflUn3mmoE7IrX4qqPNmzQBa8tXHcD/2Er13S8DUe+k0rVkoDX3G/34cJTc6IL2ebO9EbIlRbGof/pGfGPEfY0UqQowihk+xkAxRGWyIB7meqGe2OpErZuhZz/svMvn/hUz2b2J+S49WL8=,iv:dkONbhZ2DhZ2FkkWcU+lHhsHxgwa9MUx5XQWi6tqyuc=,tag:cpR6iwDUzScMdI+gTbsjfg==,type:str]
    pgp:
        - created_at: "2024-04-07T14:48:47Z"
          enc: |-
            -----BEGIN PGP MESSAGE-----

            hJ4D0dRkdsWQFPUSAwME8PwlDjrCx5/1YvvhaYSKu4UJYSfe+6G8aL1i1PCujUsu
            x6w6jlHGO5hnjA/qwnMO12Eftgp3ziqUfW23YERgY8aDE/VFh28aMAFxLiYGe0Su
            HDwCp//EIl83BXjKewkXMGN9Ji0EEY2lUuClQ4o2TDW0A7Un7xU3+d8kuNwyJI27
            9LoGlPyvtUb52tenaTIZqNRoAQkCELyidj2qUZhGxFK9/bTWF1yVXAkq5ozQMx5N
            Glnk99YbQ8hmlk5D6H7IFNdM26cuS6/z3aRPqXHtv34skJP3su8jPqMTuY01BmVs
            ZjgtRNl+7VQiO6xIBCiEby0mTJMHr4B+hDQ=
            =Y9tc
            -----END PGP MESSAGE-----
          fp: 0F003E832B1DA1A11CA9F206712F90FA248BBBC2
        - created_at: "2024-04-07T14:48:47Z"
          enc: |-
            -----BEGIN PGP MESSAGE-----

            hJ4DLG005yzvDc8SAwMEXVQPDOBo1mCt6yDztRyDPN5E8QGphZla+ymOFzXBzwoM
            fnd0OU3n5oMYIFZdkuRiZmqjw5Zu4oQP0Q3tQqGTnwTsUnnPcRyvfArnNKpu2RH7
            cHpF2lxNZcOXfwKL+W5LMG6bU4n/ifwI+Ja2pRFPISsu8bpvQH7qbyH0iSfopTJL
            Wel8suIS3ge4c+9c0l0xZNRoAQkCEJoXKWfusZKBX1JflMfXLNQ0ULyneFe4ZzDG
            5PBzr/KSpgmHemHGtDdplj+6kBZ/WBa8bd0RkO+I4DsPfaloEoYj+0Z+vkKnqtSZ
            VtFz5eM5WqhMorLOyYU9TNTQEW37EA9h/qw=
            =+gj3
            -----END PGP MESSAGE-----
          fp: 1918B94484C52CDE42CA1B87E7812096B8DA4A52
    encrypted_regex: ^(password)$
    version: 3.8.1
