apiVersion: helm.toolkit.fluxcd.io/v2beta1
kind: HelmRelease
metadata:
  name: minio
  namespace: gitlab
spec:
  interval: 10m0s
  chart:
    spec:
      chart: tenant
      version: ">=5.0.14 <5.1.0"
      sourceRef:
        kind: HelmRepository
        name: minio
        namespace: gitlab
      interval: 1m
  values:
    secrets:
      name: minio-env
      accessKey: gitlab
      secretKey: ENC[AES256_GCM,data:SYS0aTu3gHVKfJXm4Q/kovP5ULTinbsDUdfbfjftfsA=,iv:rzALTYPCRO5d3Jb+hDBTj6CMJ0UF4pTAFGjEMaUmMoc=,tag:tNwKGzW9Ff3jqAQb2laazg==,type:str]
    tenant:
      name: gitlab
      configuration:
        name: minio-env
      pools:
        - name: minio-0
          volumesPerServer: 2
          size: 25Gi
          labels:
            app.omnilium.local/identifier: minio-gitlab
          affinity:
            podAntiAffinity:
              preferredDuringSchedulingIgnoredDuringExecution:
                - weight: 100
                  podAffinityTerm:
                    labelSelector:
                      matchLabels:
                        app.omnilium.local/identifier: minio-gitlab
                    topologyKey: topology.omnilium.local/host
          resources: {}
          topologySpreadConstraints:
            - labelSelector: null
              matchLabels:
                app.omnilium.local/identifier: minio-gitlab
              topologyKey: topology.kubernetes.io/zone
              maxSkew: 1
              whenUnsatisfiable: ScheduleAnyway
      certificate:
        requestAutoCert: false
      buckets:
        - name: gitlab-artifacts
          region: hel1
        - name: git-lfs
          region: hel1
        - name: gitlab-packages
          region: hel1
        - name: gitlab-uploads
          region: hel1
        - name: gitlab-mr-diffs
          region: hel1
        - name: gitlab-terraform-state
          region: hel1
        - name: gitlab-ci-secure-files
          region: hel1
        - name: gitlab-dependency-proxy
          region: hel1
        - name: gitlab-pages
          region: hel1
        - name: gitlab-backups
          region: hel1
        - name: tmp
          region: hel1
        - name: registry
          region: hel1
    ingress:
      api:
        enabled: true
        annotations:
          cert-manager.io/cluster-issuer: acme
        tls:
          - secretName: minio-tls
            hosts:
              - storage.git.omni.ms
        host: storage.git.omni.ms
      console:
        enabled: true
        annotations:
          cert-manager.io/cluster-issuer: local
        tls:
          - secretName: minio-console-tls
            hosts:
              - gitlab.minio.omnilium.local
        host: gitlab.minio.omnilium.local
sops:
  kms: []
  gcp_kms: []
  azure_kv: []
  hc_vault: []
  age: []
  lastmodified: "2024-04-07T12:34:32Z"
  mac: ENC[AES256_GCM,data:B76zKkRzx53RC6gTFzIvdanNFaB1UUlgZV/DFyQ95rq3vzFFV9txLgD66rmKiWhdB//JMhhjuArap/c07Z1qAjrFdpctrqSyT6REp/lIRnpeWdlDL2FqpnJ/iOXFKdOcsBw5tTgfDLrv2aM1QXqD6pTNXyAIGHSqHBy3lWMSSdQ=,iv:v42ucn7/VnltPxNxGOh8K+Hmjb3Gi2mWQ25O3og1d8E=,tag:OYkPjWA94JsCM15f1Ssdvw==,type:str]
  pgp:
    - created_at: "2024-04-07T12:34:32Z"
      enc: |-
        -----BEGIN PGP MESSAGE-----

        hJ4D0dRkdsWQFPUSAwMEmFvHyfJ0yauhYSemj8Y6A/CRFmKImVplPATerRzukRxP
        fBnCG8i8e3qQTi+FbI+D2G2wICzNu2n4tFxWw5GFMQVbRNu3vGdOls05+0a1ZrgA
        10PqMTd7+UrMteElgve7MDXcYDej5hxqC3mrKGD93z/yGXjM+s2zbSCGzLX3Q2Zy
        yO0KRSOkm5H07gFrxR4CA9RoAQkCEC1ro6ZDTjeRP+M+4isk4+iJUqw7cgkDJJ4j
        JdhCFffWrYbnumBQonCjydZo4LBQr/CkK38IxgrlnfJXr3qXIACWq/yhtvc60jp8
        VxUlBNVFU+6KmN5/d+Orcl+9yI3sAQ4OfqA=
        =/ygb
        -----END PGP MESSAGE-----
      fp: 0F003E832B1DA1A11CA9F206712F90FA248BBBC2
    - created_at: "2024-04-07T12:34:32Z"
      enc: |-
        -----BEGIN PGP MESSAGE-----

        hJ4DLG005yzvDc8SAwME8sWnpqNvHDz6NrnsHyRe+lb921PHJs4uEJ7LuoQIj+RY
        +p8CM86U2btiMfi0gI5E8P1LRcnAhOpcG6L1nVr8t36QTgEACxZwCVblXWUwkzmW
        3yvR76o502HBtyCfTgGRMLfS5fEQn6KJxERpsr7Pf/2bchuandE9hkzRsptO2rVs
        5BGnQRnNPBCE1OGqDyvDHtRoAQkCEOgHJm8byeohV47z74wXh9lZONNEwwXU77Zs
        2GogzNhm/xLQeSipRGrgatnOSuRePEwa+oWypywV7pWMWr9XrwdBB7xKXQM7xvxH
        yzCePM+JCIZ/zD6k96SAtMJBBOS3sBdNwUs=
        =MOge
        -----END PGP MESSAGE-----
      fp: 1918B94484C52CDE42CA1B87E7812096B8DA4A52
  encrypted_regex: ^(secretKey)$
  version: 3.8.1
