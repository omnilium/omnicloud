apiVersion: helm.toolkit.fluxcd.io/v2beta1
kind: HelmRelease
metadata:
    name: forgejo
    namespace: forgejo
spec:
    interval: 10m0s
    chart:
        spec:
            chart: forgejo
            version: '>=5.0.3 <5.1.0'
            sourceRef:
                kind: HelmRepository
                name: forgejo
                namespace: forgejo
            interval: 1m
    values:
        service:
            ssh:
                type: LoadBalancer
        ingress:
            enabled: true
            annotations:
                cert-manager.io/cluster-issuer: acme
            hosts:
                - host: git.omni.ms
                  paths:
                    - path: /
                      pathType: Prefix
            tls:
                - secretName: forgejo-tls
                  hosts:
                    - git.omni.ms
        resources: {}
        persistence:
            size: 25Gi
            storageClass: replicated
            annotations:
                helm.sh/resource-policy: keep
        gitea:
            admin:
                username: webmaster
                password: ENC[AES256_GCM,data:SNGFtFeSY7OSeXL5OvP/q6d7Qr73cgEopIlzebpkf+KwqJlzJoEi8gPuLQ==,iv:o1YlpDpiUcIXq9Wykk+1KVCo+Iu3DOpIVAnpRmIqJ0M=,tag:6t6v9zpWJF0XqlwVNnI7ew==,type:str]
                email: webmaster@omnilium.com
        postgresql-ha:
            global:
                postgresql:
                    database: forgejo
                    password: ENC[AES256_GCM,data:VVfROk921nX8kR6SAzxN6wU82cVTbb2nZEV8duFLxc612NwiVgnHDkVOBA==,iv:YUcE3Cpxj1obvwmmOT8nG//ybjjSH33Rf6mjo8d9oYo=,tag:FkagsQR2ewERg7JdK7WGsg==,type:str]
                    username: forgejo
            postgresql:
                repmgrPassword: ENC[AES256_GCM,data:CAjhxObw6+A/92Nc4a6DnaT60hHaU3j3TkHLEX3UbLw7t1/j0gRhInsx3A==,iv:0eUKNK9Ng9aZCzIeNI009LyFwIypg5JgMFaY8zsmzZ8=,tag:L8bN247+JOqhku7mx3LgMQ==,type:str]
                postgresPassword: ENC[AES256_GCM,data:jB+SAaufZyh32KbvbxJ+VhHo3FJhiI5e3EON6zksqt8iVu6mDm7iJpqz+g==,iv:+429bOZsWo6C6FLHolIuqbcTyG6s0WW7KJrE9NjcIQo=,tag:lZRSUCvuLKa5/hdPmg3uNA==,type:str]
                password: ENC[AES256_GCM,data:B8nLpF0a8RnRcfnfeOL4UlTVziBpQmEOBKaiwBkzZzpclrKACwWmzhDEPw==,iv:pd3xkVFeCVHGSxd7HUNERj/SQhk2usWxEasZ0DzcJhE=,tag:U1kcH5myBgOqGzE00+M1RQ==,type:str]
            pgpool:
                adminPassword: ENC[AES256_GCM,data:pgSje7Hcka4CUygLah2bfIHJGacYarw0I1nqKpkw1n6+FZStY0dqm4TMzw==,iv:61EdJ86Jpz+24JN2TIfCU+h+F+ofXD/qpe0dNcL5AlQ=,tag:eTpeORaJA4QJRjgBNju42Q==,type:str]
sops:
    kms: []
    gcp_kms: []
    azure_kv: []
    hc_vault: []
    age: []
    lastmodified: "2024-04-06T20:12:56Z"
    mac: ENC[AES256_GCM,data:00G6blqxWeODGrvdyGe6WbvK0d3PHkGTp051ZaLZbcH9sBu784rYNF6err/AI/hSLRZ6jVajIMsZONu+0P4C1Eh4Kre03nD4DoVsOZ5nfpawNWA3XzmMhiQwbYGpOzpmj0pR8vqJZIPpcoGA8kNO3/0AzL5opdbjRUFtJXbtQDg=,iv:f3AP3E02zgX/n/rWtOsNw48Q0oZBc2o8VuLWVxX7yVI=,tag:CezQGpjBAOKpb0+wIJ7Sdg==,type:str]
    pgp:
        - created_at: "2024-04-06T20:12:56Z"
          enc: |-
            -----BEGIN PGP MESSAGE-----

            hJ4D0dRkdsWQFPUSAwMEl2YSXEm9DbdkGE4y4MqCS3eM8Xy2di23xYukrOZrBTrj
            TN9d92/ZikZuf0aI1mS0CedAufeIdc2IUt+EBlWw/ngQmzrWFbxAcWvpseed1hPH
            VQ463o/6yAz3T1xcQ1YiMCNFBVZwaZQbaJkj+Uf/4PfKVML5pJDzTbfhNcBvYj3n
            LxMREST75GHKJHvgc/wDztRmAQkCEP5JaJ0/ZEEabtFPSk40hHl5bcZdLt6bdwc3
            vZe6Pg87pdUUipQxyMejYqwftuVXFWDaz61nVo0ZlrGM2c4xOk5nkjEw8kDACyv3
            QbiOjr0LcNxEDmaq/V+9Q8KL0otyJ+s9
            =wV88
            -----END PGP MESSAGE-----
          fp: 0F003E832B1DA1A11CA9F206712F90FA248BBBC2
        - created_at: "2024-04-06T20:12:56Z"
          enc: |-
            -----BEGIN PGP MESSAGE-----

            hJ4DLG005yzvDc8SAwMEWZMFL6TcBCa0C2wvUBjEfiXxp8ef/h0Q8Q7EX/xCNVZq
            kyLfVuirYziygFmIs5trZOm1QbUAYTSgCGY8r49J9Jci9fgjSXjvxuipA5ZEVlzV
            rg0aJWdhLRuDYODVjivnMP8fZjGegQfpXcLsr1UH633429tZk74wc8CFf5Dx6ZjG
            xd2HP02COtUFZ9UnIYVWA9RmAQkCEPsAMF5MoWZHGLfsWso24dtyw0+x2Sd9JzAQ
            Ox1sg80A8tv91E3PNFsXUpbIRgHnP+GDwr6j0C/xdJMrQ04CLbR2b6xTr8rEOViL
            eW5j6BuhaTPzOsgaoL9xyfbKO+rvTejn
            =E/Mq
            -----END PGP MESSAGE-----
          fp: 1918B94484C52CDE42CA1B87E7812096B8DA4A52
    encrypted_regex: ^(data|stringData|password|repmgrPassword|postgresPassword|adminPassword)$
    version: 3.8.1
---
apiVersion: helm.toolkit.fluxcd.io/v2beta1
kind: HelmRelease
metadata:
    name: minio
    namespace: forgejo
spec:
    interval: 10m0s
    chart:
        spec:
            chart: tenant
            version: '>=5.0.14 <5.1.0'
            sourceRef:
                kind: HelmRepository
                name: minio
                namespace: forgejo
            interval: 1m
    values:
        secrets:
            existingSecret:
                name: minio-config
        tenant:
            name: forgejo
            configuration:
                name: minio-config
            pools:
                - servers: 4
                  name: pool-0
                  volumesPerServer: 1
                  size: 25Gi
                  labels:
                    minio.omnilium.local/tenant: forgejo
                  affinity:
                    podAntiAffinity:
                        preferredDuringSchedulingIgnoredDuringExecution:
                            - weight: 100
                              podAffinityTerm:
                                labelSelector:
                                    matchLabels:
                                        minio.omnilium.local/tenant: forgejo
                                topologyKey: topology.omnilium.local/host
                  resources: {}
                  topologySpreadConstraints:
                    - labelSelector:
                        matchLabels:
                            minio.omnilium.local/tenant: forgejo
                      topologyKey: topology.kubernetes.io/zone
                      maxSkew: 1
                      whenUnsatisfiable: ScheduleAnyway
            certificate:
                requestAutoCert: false
        ingress:
            console:
                enabled: true
                annotations:
                    cert-manager.io/cluster-issuer: local
                host: forgejo.minio.omnilium.local
                tls:
                    - secretName: minio-console-tls
                      hosts:
                        - forgejo.minio.omnilium.local
sops:
    kms: []
    gcp_kms: []
    azure_kv: []
    hc_vault: []
    age: []
    lastmodified: "2024-04-06T20:12:56Z"
    mac: ENC[AES256_GCM,data:00G6blqxWeODGrvdyGe6WbvK0d3PHkGTp051ZaLZbcH9sBu784rYNF6err/AI/hSLRZ6jVajIMsZONu+0P4C1Eh4Kre03nD4DoVsOZ5nfpawNWA3XzmMhiQwbYGpOzpmj0pR8vqJZIPpcoGA8kNO3/0AzL5opdbjRUFtJXbtQDg=,iv:f3AP3E02zgX/n/rWtOsNw48Q0oZBc2o8VuLWVxX7yVI=,tag:CezQGpjBAOKpb0+wIJ7Sdg==,type:str]
    pgp:
        - created_at: "2024-04-06T20:12:56Z"
          enc: |-
            -----BEGIN PGP MESSAGE-----

            hJ4D0dRkdsWQFPUSAwMEl2YSXEm9DbdkGE4y4MqCS3eM8Xy2di23xYukrOZrBTrj
            TN9d92/ZikZuf0aI1mS0CedAufeIdc2IUt+EBlWw/ngQmzrWFbxAcWvpseed1hPH
            VQ463o/6yAz3T1xcQ1YiMCNFBVZwaZQbaJkj+Uf/4PfKVML5pJDzTbfhNcBvYj3n
            LxMREST75GHKJHvgc/wDztRmAQkCEP5JaJ0/ZEEabtFPSk40hHl5bcZdLt6bdwc3
            vZe6Pg87pdUUipQxyMejYqwftuVXFWDaz61nVo0ZlrGM2c4xOk5nkjEw8kDACyv3
            QbiOjr0LcNxEDmaq/V+9Q8KL0otyJ+s9
            =wV88
            -----END PGP MESSAGE-----
          fp: 0F003E832B1DA1A11CA9F206712F90FA248BBBC2
        - created_at: "2024-04-06T20:12:56Z"
          enc: |-
            -----BEGIN PGP MESSAGE-----

            hJ4DLG005yzvDc8SAwMEWZMFL6TcBCa0C2wvUBjEfiXxp8ef/h0Q8Q7EX/xCNVZq
            kyLfVuirYziygFmIs5trZOm1QbUAYTSgCGY8r49J9Jci9fgjSXjvxuipA5ZEVlzV
            rg0aJWdhLRuDYODVjivnMP8fZjGegQfpXcLsr1UH633429tZk74wc8CFf5Dx6ZjG
            xd2HP02COtUFZ9UnIYVWA9RmAQkCEPsAMF5MoWZHGLfsWso24dtyw0+x2Sd9JzAQ
            Ox1sg80A8tv91E3PNFsXUpbIRgHnP+GDwr6j0C/xdJMrQ04CLbR2b6xTr8rEOViL
            eW5j6BuhaTPzOsgaoL9xyfbKO+rvTejn
            =E/Mq
            -----END PGP MESSAGE-----
          fp: 1918B94484C52CDE42CA1B87E7812096B8DA4A52
    encrypted_regex: ^(data|stringData|password|repmgrPassword|postgresPassword|adminPassword)$
    version: 3.8.1
