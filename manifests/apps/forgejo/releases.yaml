apiVersion: helm.toolkit.fluxcd.io/v2beta1
kind: HelmRelease
metadata:
    name: forgejo
    namespace: forgejo
spec:
    interval: 10m0s
    chart:
        spec:
            chart: forgejo
            version: '>=5.0.3 <5.1.0'
            sourceRef:
                kind: HelmRepository
                name: forgejo
                namespace: forgejo
            interval: 1m
    values:
        service:
            ssh:
                type: LoadBalancer
        ingress:
            enabled: true
            annotations:
                cert-manager.io/cluster-issuer: acme
            hosts:
                - host: git.omni.ms
                  paths:
                    - path: /
                      pathType: Prefix
            tls:
                - secretName: forgejo-tls
                  hosts:
                    - git.omni.ms
        resources: {}
        persistence:
            size: 25Gi
            storageClass: replicated
            annotations:
                helm.sh/resource-policy: keep
        signing:
            enabled: true
            existingSecret: forgejo-signing
        gitea:
            admin:
                username: webmaster
                password: ENC[AES256_GCM,data:bn+JE8YssikoBvFNSuUji2YGYFBK/zro0cD+flrKXTDlWqkfOssPaV0/Hw==,iv:Sae20oo/lUVDZ26m5esyytS/9RJklmDqVXyyw441LW8=,tag:AF/QvzarLTENVFPCnCwuTg==,type:str]
                email: webmaster@omnilium.com
            config:
                repository:
                    ACCESS_CONTROL_ALLOW_ORIGIN: git.omni.ms
                    DEFAULT_REPO_UNITS: repo.code,repo.releases,repo.pulls
                repository.pull-request:
                    DEFAULT_MERGE_STYLE: rebase-merge
                repository.upload:
                    FILE_MAX_SIZE: 10
        postgresql-ha:
            global:
                postgresql:
                    database: forgejo
                    password: ENC[AES256_GCM,data:r1opbkVt3OJPH8yH+ENIfxi888aEw8Hxf2VLHMPvFwL8EndSH4AMMykFiA==,iv:o/5STfLoCWbmf0bxJaXEfZ5BZF+Jx2vwLzHBo3d+4mU=,tag:yOj8Z89w+zSZtbIdsBtxkA==,type:str]
                    username: forgejo
            postgresql:
                repmgrPassword: ENC[AES256_GCM,data:7lKr1AlZCXP1wNmUUipcA36Gju4d+p0TzDwECNH7O5mTPm2E/jWEc0ttFA==,iv:sNsBwL5ljk+t4QjNK01f8s4VGpOHHo9wHfX+NeBv4BM=,tag:2B/q3yenl/eOjZtTc3XROA==,type:str]
                postgresPassword: ENC[AES256_GCM,data:jaKEac5GgLm5JRWRoJIHix7i6M2gXZse6MzDRvJQ9btQGc2z56no/OY9tQ==,iv:DiMMOGgbrxdaNQt5rK89Na1f32sjP4rO3wyunWwOq+k=,tag:r8lLBrRZ7kgjwzlRiCZrnw==,type:str]
                password: ENC[AES256_GCM,data:q/6ScWGosHp8jeFMGnQAXFlgfsK469LjH1C1p6lhlgOhJXdhE+u7VDyNtA==,iv:GP/btOCMBLxxLqcWvOj1UO+LJpGtvXkr29xFKAtnofk=,tag:ZRa7jm6QSOds7R0MYe6fsA==,type:str]
            pgpool:
                adminPassword: ENC[AES256_GCM,data:2XZ4RKaj8eOiB4MUHqywKCfHFUthpyIEPqx2qnDLteovXw9AUOET4YrHeg==,iv:9W1pF7wavlv93pmDgrh+JlgLQ4TuGDyVCk5lqf2CgPM=,tag:i5QhVa6/MGDssUON8ZsLpw==,type:str]
sops:
    kms: []
    gcp_kms: []
    azure_kv: []
    hc_vault: []
    age: []
    lastmodified: "2024-04-06T20:28:39Z"
    mac: ENC[AES256_GCM,data:PNxfO02/Al8HUsJAZpoBFXajgqbb9HXjDEF6CqqVVdm2O1uPDWXIdO6WziRvN2EVM9FP05K7eix+DSnXifLiueVAEIGyH+f+0Xh0Pw5UXL7PRNYyYM474QNanNnIuTJO0GuVIXLCiF5eiG7BcfiDFnalpFG6SbUHrxpB9ahVDFE=,iv:1nB4huU9d20C2KRPl3fhtdLMaeo0YIwJ+LuqeLs2TuA=,tag:HQ6VIQz58RODOrfeqFwO+A==,type:str]
    pgp:
        - created_at: "2024-04-06T20:28:39Z"
          enc: |-
            -----BEGIN PGP MESSAGE-----

            hJ4D0dRkdsWQFPUSAwMEfiJQgJKI69Rjq3+WHK+S6s1Ory7XaVSJK4lrX9Jz8UUT
            Js+Lpg1kp/Me6ydYOX001Nr87Rlzv9PsZxPrHNrbZsKhBi14urPTdVRpxPNqZPrL
            Ah3QEmgVZvy37N5/TpYEMOjPRfh/1A1AyVcj6HEqWA5Tz+IpQsaFDiwdurXRd26T
            Sq5M5FmuCrqiKAIOSdRZG9RoAQkCEGMLgPC7SoSCxNDlXyXt3eH+lOJHxUf/tJeg
            ppyF7D1B2+pgkLwbJ4n10u7Oo6eUeZpHAvMALZ9pCv7jogLUzKYjMKUd1A1DjV5B
            Am9Fopt7LHy9j6Brg27O2VhSUpwgpIGPfvY=
            =DFy+
            -----END PGP MESSAGE-----
          fp: 0F003E832B1DA1A11CA9F206712F90FA248BBBC2
        - created_at: "2024-04-06T20:28:39Z"
          enc: |-
            -----BEGIN PGP MESSAGE-----

            hJ4DLG005yzvDc8SAwMEbwz5ulgyId1rubF9USdKOcT7feLE1YKifo1NKrED8r8F
            tsWPybUOnH4PPhfmuK8kP1xdsqc3MBLWB8PC6o3QxzqFWUcAhShJBpQeqwngp4I2
            fX+cm7ep7iL9eurGQTQHMAWx3VVQf8KLrNtfKfvcaQCdpgilV4pRUvMrQuq4gnYy
            mDgtlOThqahG7aoidFFlytRoAQkCEPhMwEEHmcCzCFho+K7s2Z2yp1JNGosVlC8o
            lGdWamkuzcbF2d4IsxEg9cH121PkQwwEUPqQy8PAmJrxAbzWsAWhrFobdP44Xyb1
            jV+/+qkdLvgE5e6avbqHs7pTZcP6EQQfgK0=
            =K+so
            -----END PGP MESSAGE-----
          fp: 1918B94484C52CDE42CA1B87E7812096B8DA4A52
    encrypted_regex: ^(data|stringData|password|repmgrPassword|postgresPassword|adminPassword)$
    version: 3.8.1
---
apiVersion: helm.toolkit.fluxcd.io/v2beta1
kind: HelmRelease
metadata:
    name: minio
    namespace: forgejo
spec:
    interval: 10m0s
    chart:
        spec:
            chart: tenant
            version: '>=5.0.14 <5.1.0'
            sourceRef:
                kind: HelmRepository
                name: minio
                namespace: forgejo
            interval: 1m
    values:
        secrets:
            existingSecret:
                name: minio-config
        tenant:
            name: forgejo
            configuration:
                name: minio-config
            pools:
                - servers: 4
                  name: pool-0
                  volumesPerServer: 1
                  size: 25Gi
                  labels:
                    minio.omnilium.local/tenant: forgejo
                  affinity:
                    podAntiAffinity:
                        preferredDuringSchedulingIgnoredDuringExecution:
                            - weight: 100
                              podAffinityTerm:
                                labelSelector:
                                    matchLabels:
                                        minio.omnilium.local/tenant: forgejo
                                topologyKey: topology.omnilium.local/host
                  resources: {}
                  topologySpreadConstraints:
                    - labelSelector:
                        matchLabels:
                            minio.omnilium.local/tenant: forgejo
                      topologyKey: topology.kubernetes.io/zone
                      maxSkew: 1
                      whenUnsatisfiable: ScheduleAnyway
            certificate:
                requestAutoCert: false
        ingress:
            console:
                enabled: true
                annotations:
                    cert-manager.io/cluster-issuer: local
                host: forgejo.minio.omnilium.local
                tls:
                    - secretName: minio-console-tls
                      hosts:
                        - forgejo.minio.omnilium.local
sops:
    kms: []
    gcp_kms: []
    azure_kv: []
    hc_vault: []
    age: []
    lastmodified: "2024-04-06T20:28:39Z"
    mac: ENC[AES256_GCM,data:PNxfO02/Al8HUsJAZpoBFXajgqbb9HXjDEF6CqqVVdm2O1uPDWXIdO6WziRvN2EVM9FP05K7eix+DSnXifLiueVAEIGyH+f+0Xh0Pw5UXL7PRNYyYM474QNanNnIuTJO0GuVIXLCiF5eiG7BcfiDFnalpFG6SbUHrxpB9ahVDFE=,iv:1nB4huU9d20C2KRPl3fhtdLMaeo0YIwJ+LuqeLs2TuA=,tag:HQ6VIQz58RODOrfeqFwO+A==,type:str]
    pgp:
        - created_at: "2024-04-06T20:28:39Z"
          enc: |-
            -----BEGIN PGP MESSAGE-----

            hJ4D0dRkdsWQFPUSAwMEfiJQgJKI69Rjq3+WHK+S6s1Ory7XaVSJK4lrX9Jz8UUT
            Js+Lpg1kp/Me6ydYOX001Nr87Rlzv9PsZxPrHNrbZsKhBi14urPTdVRpxPNqZPrL
            Ah3QEmgVZvy37N5/TpYEMOjPRfh/1A1AyVcj6HEqWA5Tz+IpQsaFDiwdurXRd26T
            Sq5M5FmuCrqiKAIOSdRZG9RoAQkCEGMLgPC7SoSCxNDlXyXt3eH+lOJHxUf/tJeg
            ppyF7D1B2+pgkLwbJ4n10u7Oo6eUeZpHAvMALZ9pCv7jogLUzKYjMKUd1A1DjV5B
            Am9Fopt7LHy9j6Brg27O2VhSUpwgpIGPfvY=
            =DFy+
            -----END PGP MESSAGE-----
          fp: 0F003E832B1DA1A11CA9F206712F90FA248BBBC2
        - created_at: "2024-04-06T20:28:39Z"
          enc: |-
            -----BEGIN PGP MESSAGE-----

            hJ4DLG005yzvDc8SAwMEbwz5ulgyId1rubF9USdKOcT7feLE1YKifo1NKrED8r8F
            tsWPybUOnH4PPhfmuK8kP1xdsqc3MBLWB8PC6o3QxzqFWUcAhShJBpQeqwngp4I2
            fX+cm7ep7iL9eurGQTQHMAWx3VVQf8KLrNtfKfvcaQCdpgilV4pRUvMrQuq4gnYy
            mDgtlOThqahG7aoidFFlytRoAQkCEPhMwEEHmcCzCFho+K7s2Z2yp1JNGosVlC8o
            lGdWamkuzcbF2d4IsxEg9cH121PkQwwEUPqQy8PAmJrxAbzWsAWhrFobdP44Xyb1
            jV+/+qkdLvgE5e6avbqHs7pTZcP6EQQfgK0=
            =K+so
            -----END PGP MESSAGE-----
          fp: 1918B94484C52CDE42CA1B87E7812096B8DA4A52
    encrypted_regex: ^(data|stringData|password|repmgrPassword|postgresPassword|adminPassword)$
    version: 3.8.1
