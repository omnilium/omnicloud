apiVersion: helm.toolkit.fluxcd.io/v2beta1
kind: HelmRelease
metadata:
    name: forgejo
    namespace: forgejo
spec:
    interval: 10m0s
    chart:
        spec:
            chart: forgejo
            version: '>=5.0.3 <5.1.0'
            sourceRef:
                kind: HelmRepository
                name: forgejo
                namespace: forgejo
            interval: 1m
    values:
        service:
            ssh:
                type: LoadBalancer
        ingress:
            enabled: true
            annotations:
                cert-manager.io/cluster-issuer: acme
            hosts:
                - host: git.omni.ms
                  paths:
                    - path: /
                      pathType: Prefix
            tls:
                - secretName: forgejo-tls
                  hosts:
                    - git.omni.ms
        resources: {}
        persistence:
            size: 25Gi
            storageClass: replicated
            annotations:
                helm.sh/resource-policy: keep
        signing:
            enabled: true
            existingSecret: forgejo-signing
        gitea:
            admin:
                username: webmaster
                password: ENC[AES256_GCM,data:h/rCWndYi96vf+IWIV/AZhHco/JxVawAf8xqVnJy/d2ZFHOns26phKB8gg==,iv:fSc3mVUftz1YG7FSOxc/76r/7u0a+gFjOzjmg6+ZKws=,tag:2YPRnD6y64pUG3jUH8OM/A==,type:str]
                email: webmaster@omnilium.com
            config:
                repository:
                    ACCESS_CONTROL_ALLOW_ORIGIN: git.omni.ms
                    DEFAULT_REPO_UNITS: repo.code,repo.releases,repo.pulls
                    pull-request:
                        DEFAULT_MERGE_STYLE: rebase-merge
                    upload:
                        FILE_MAX_SIZE: 10
        postgresql-ha:
            global:
                postgresql:
                    database: forgejo
                    password: ENC[AES256_GCM,data:uGeV3lK9Al/gDmJFEuLrXuiIsWoVmoop3YZWC1XxMOIJvebiGa63Lpf8Og==,iv:3nJtOioMNka+Ak52hd/46UWnrrO8iPdOHnzvn88xBHc=,tag:fmtXieFpFGTPx4l6wQHgZw==,type:str]
                    username: forgejo
            postgresql:
                repmgrPassword: ENC[AES256_GCM,data:YjscwPqdyGCjhSzzDWNInO6a4mfcz4a3fPGk7UlfzvnQ8MRPkU1xbMPshw==,iv:l5fHgyAOum/bbZWdqaovD7ZZRPflcKJxMXj68ZQTSx4=,tag:3w0WiwfXTZkbdDy7B2QmjQ==,type:str]
                postgresPassword: ENC[AES256_GCM,data:O8Bfjyf0IU3C7YV8a8+GSqd+2heDtOgPX6X5r7idTxDBf9T+q/c56VaFaA==,iv:RIMWF1zEb7qGJpFNcrajltbqBm9uRMrhjtrJBYG2y/0=,tag:4bUWBOr6xvht5CmZZekiMA==,type:str]
                password: ENC[AES256_GCM,data:LnYH0ZGBNEPJXrkbF0ljmQ68+RmRXvcOQI29dDdoKs5kEm7a0wrSJz6v6Q==,iv:aRPEQUDQLjlZPEAB2uNkuVJqFTn1Gf3IYTYQ33O6e98=,tag:DaOzQBCIIbK4zJM/8UJr7w==,type:str]
            pgpool:
                adminPassword: ENC[AES256_GCM,data:QfRNBBGUQBQtlbi8f/uDOWqzMbr2SUoYEUOmM8caGWmVIRUDh0XXyOsRGQ==,iv:mrXlVE5YLqgFDSZ2JuKEfmDkdTwg4hUUc9jbM/Z0rK4=,tag:NbR0VV4IMFN5n6V1VxZoyg==,type:str]
sops:
    kms: []
    gcp_kms: []
    azure_kv: []
    hc_vault: []
    age: []
    lastmodified: "2024-04-06T20:26:39Z"
    mac: ENC[AES256_GCM,data:b0lmZNA0mcIDFUN8xdAqT+X7vaweQJFwdbyxToHDa4g1cu57kAsRpuVihdwFYSX4mr0FnIkAZCnmAANxpAHTdQJCSqmrBULrgHygnzGg01jWAn9ElvUhtD/3h1Bwx3GT1t3UqrkhfmTtsmZDBxNToqMcoLF8U5XpdnS2B7ER0JY=,iv:rBRt5BnUZUP7p1Q/+BiGVcwjK81gTXB8wq09B7LhBXU=,tag:N5JrihelGcyWxbYpi7Yr0w==,type:str]
    pgp:
        - created_at: "2024-04-06T20:26:39Z"
          enc: |-
            -----BEGIN PGP MESSAGE-----

            hJ4D0dRkdsWQFPUSAwMEIAhyPoOUVZcbaJR58z8+kGks1rJN4djs1/SfkskM5IQT
            7U6tWgoSfa5tMgl3EHh2nw2nt7inSkinl9QDW0ZO2bKwXItmAW75WiKJVibgfO93
            HX2BQC55lhP/BBv78zVhMDKN2Hi4BpJW7UAHQ2/et7fjkKdfYQ4vPo0DynhXDlhz
            Y2Bzid52YL3DzF/qj2jy1dRoAQkCEM9Kdd9Hoa0NfpO0Hgpzg4XOTQqJ0BGHku5S
            9R/FgcvWC54gpErKGvMX1mLDY/waghAoW62R9zoRnPA7wnnx6L1CiBFz4t/hvfDV
            vtUYgBKQTVotWMNP85QxmSHL8QNjMUWxoN4=
            =qBNs
            -----END PGP MESSAGE-----
          fp: 0F003E832B1DA1A11CA9F206712F90FA248BBBC2
        - created_at: "2024-04-06T20:26:39Z"
          enc: |-
            -----BEGIN PGP MESSAGE-----

            hJ4DLG005yzvDc8SAwMEiSzNHjiwhYWZs1heqRsaddyteY2ZFs4iBxzuKPdE9u7r
            X7M7xQPl2P5KgR3CHKqie0BkJCfCd4fuHZVBMJ2PSIetDQg17WdBecyag0ORpJGx
            K6lwH7qqnbhNYaLzjml8MB2CWnReSnirDT58TAuBHeCQjyQo7A/REUTy2K1DnztB
            NhRYgNobfBQ2ChTPnqKn4tRoAQkCEKJ1mQynmAdRAjs6Mm6+BNIUTZH7Uqo/S3vS
            8iQjaepWAWBUeDZjTgSgV7H8DRKOE7bvUvqY6XRDrbcJOWXBzqzCSA9jSem1ZVY6
            RR3aUcThUiz8GU1Ui247WcSOwebBQFOnJLM=
            =aKii
            -----END PGP MESSAGE-----
          fp: 1918B94484C52CDE42CA1B87E7812096B8DA4A52
    encrypted_regex: ^(data|stringData|password|repmgrPassword|postgresPassword|adminPassword)$
    version: 3.8.1
---
apiVersion: helm.toolkit.fluxcd.io/v2beta1
kind: HelmRelease
metadata:
    name: minio
    namespace: forgejo
spec:
    interval: 10m0s
    chart:
        spec:
            chart: tenant
            version: '>=5.0.14 <5.1.0'
            sourceRef:
                kind: HelmRepository
                name: minio
                namespace: forgejo
            interval: 1m
    values:
        secrets:
            existingSecret:
                name: minio-config
        tenant:
            name: forgejo
            configuration:
                name: minio-config
            pools:
                - servers: 4
                  name: pool-0
                  volumesPerServer: 1
                  size: 25Gi
                  labels:
                    minio.omnilium.local/tenant: forgejo
                  affinity:
                    podAntiAffinity:
                        preferredDuringSchedulingIgnoredDuringExecution:
                            - weight: 100
                              podAffinityTerm:
                                labelSelector:
                                    matchLabels:
                                        minio.omnilium.local/tenant: forgejo
                                topologyKey: topology.omnilium.local/host
                  resources: {}
                  topologySpreadConstraints:
                    - labelSelector:
                        matchLabels:
                            minio.omnilium.local/tenant: forgejo
                      topologyKey: topology.kubernetes.io/zone
                      maxSkew: 1
                      whenUnsatisfiable: ScheduleAnyway
            certificate:
                requestAutoCert: false
        ingress:
            console:
                enabled: true
                annotations:
                    cert-manager.io/cluster-issuer: local
                host: forgejo.minio.omnilium.local
                tls:
                    - secretName: minio-console-tls
                      hosts:
                        - forgejo.minio.omnilium.local
sops:
    kms: []
    gcp_kms: []
    azure_kv: []
    hc_vault: []
    age: []
    lastmodified: "2024-04-06T20:26:39Z"
    mac: ENC[AES256_GCM,data:b0lmZNA0mcIDFUN8xdAqT+X7vaweQJFwdbyxToHDa4g1cu57kAsRpuVihdwFYSX4mr0FnIkAZCnmAANxpAHTdQJCSqmrBULrgHygnzGg01jWAn9ElvUhtD/3h1Bwx3GT1t3UqrkhfmTtsmZDBxNToqMcoLF8U5XpdnS2B7ER0JY=,iv:rBRt5BnUZUP7p1Q/+BiGVcwjK81gTXB8wq09B7LhBXU=,tag:N5JrihelGcyWxbYpi7Yr0w==,type:str]
    pgp:
        - created_at: "2024-04-06T20:26:39Z"
          enc: |-
            -----BEGIN PGP MESSAGE-----

            hJ4D0dRkdsWQFPUSAwMEIAhyPoOUVZcbaJR58z8+kGks1rJN4djs1/SfkskM5IQT
            7U6tWgoSfa5tMgl3EHh2nw2nt7inSkinl9QDW0ZO2bKwXItmAW75WiKJVibgfO93
            HX2BQC55lhP/BBv78zVhMDKN2Hi4BpJW7UAHQ2/et7fjkKdfYQ4vPo0DynhXDlhz
            Y2Bzid52YL3DzF/qj2jy1dRoAQkCEM9Kdd9Hoa0NfpO0Hgpzg4XOTQqJ0BGHku5S
            9R/FgcvWC54gpErKGvMX1mLDY/waghAoW62R9zoRnPA7wnnx6L1CiBFz4t/hvfDV
            vtUYgBKQTVotWMNP85QxmSHL8QNjMUWxoN4=
            =qBNs
            -----END PGP MESSAGE-----
          fp: 0F003E832B1DA1A11CA9F206712F90FA248BBBC2
        - created_at: "2024-04-06T20:26:39Z"
          enc: |-
            -----BEGIN PGP MESSAGE-----

            hJ4DLG005yzvDc8SAwMEiSzNHjiwhYWZs1heqRsaddyteY2ZFs4iBxzuKPdE9u7r
            X7M7xQPl2P5KgR3CHKqie0BkJCfCd4fuHZVBMJ2PSIetDQg17WdBecyag0ORpJGx
            K6lwH7qqnbhNYaLzjml8MB2CWnReSnirDT58TAuBHeCQjyQo7A/REUTy2K1DnztB
            NhRYgNobfBQ2ChTPnqKn4tRoAQkCEKJ1mQynmAdRAjs6Mm6+BNIUTZH7Uqo/S3vS
            8iQjaepWAWBUeDZjTgSgV7H8DRKOE7bvUvqY6XRDrbcJOWXBzqzCSA9jSem1ZVY6
            RR3aUcThUiz8GU1Ui247WcSOwebBQFOnJLM=
            =aKii
            -----END PGP MESSAGE-----
          fp: 1918B94484C52CDE42CA1B87E7812096B8DA4A52
    encrypted_regex: ^(data|stringData|password|repmgrPassword|postgresPassword|adminPassword)$
    version: 3.8.1
