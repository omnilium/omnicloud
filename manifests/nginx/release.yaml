apiVersion: helm.toolkit.fluxcd.io/v2beta2
kind: HelmRelease
metadata:
    name: nginx
    namespace: flux-system
spec:
    interval: 10m0s
    timeout: 5m0s
    chart:
        spec:
            chart: ingress-nginx
            version: 4.10.*
            sourceRef:
                kind: HelmRepository
                name: nginx
            interval: 60m0s
    releaseName: nginx
    targetNamespace: nginx
    install:
        remediation:
            retries: 3
        createNamespace: true
    upgrade:
        remediation:
            retries: 3
    values:
        controller:
            enableAnnotationValidations: true
            ingressClassResource:
                default: true
            podLabels:
                app.omnilium.cloud/identifier: nginx
            maxmindLicenseKey: ENC[AES256_GCM,data:e2hmutzyLe3zWf3pZMoVRJ0/uWtrFFQynBPQlpb/licBLw8JITY9lg==,iv:a3SI8i47LEReASLE8VLzcnPCF5SWrJjE1tdoLkt660o=,tag:DAnvy8KcvsO+cqMz084ZCA==,type:str]
            updateStrategy:
                rollingUpdate:
                    maxUnavailable: 1
                type: RollingUpdate
            affinity:
                podAntiAffinity:
                    preferredDuringSchedulingIgnoredDuringExecution:
                        - weight: 100
                          podAffinityTerm:
                            labelSelector:
                                matchExpressions:
                                    - key: app.kubernetes.io/name
                                      operator: In
                                      values:
                                        - ingress-nginx
                                    - key: app.kubernetes.io/instance
                                      operator: In
                                      values:
                                        - ingress-nginx
                                    - key: app.kubernetes.io/component
                                      operator: In
                                      values:
                                        - controller
                            topologyKey: topology.omnilium.cloud/host
            maxUnavailable: 1
            resources:
                limits:
                    cpu: 500m
                    memory: 512Mi
                requests:
                    cpu: 100m
                    memory: 256Mi
            autoscaling:
                enabled: true
                minReplicas: 3
                maxReplicas: 10
                targetCPUUtilizationPercentage: 75
                targetMemoryUtilizationPercentage: 75
                behavior:
                    scaleDown:
                        policies:
                            - type: Pods
                              value: 1
                              periodSeconds: 60
                    scaleUp:
                        stabilizationWindowSeconds: 60
                        policies:
                            - type: Pods
                              value: 1
                              periodSeconds: 30
            service:
                ipFamilyPolicy: RequireDualStack
                ipFamilies:
                    - IPv4
                    - IPv6
        tcp:
            "8000": onedev/onedev:22
sops:
    kms: []
    gcp_kms: []
    azure_kv: []
    hc_vault: []
    age: []
    lastmodified: "2024-04-14T15:36:35Z"
    mac: ENC[AES256_GCM,data:0alIaVMpzQo2UiRBFYjmYDUa9pKhg7XojFOpnqbfJq91DLBkRXYpPg2oamXJK397BGzMO2oFdiCJadfcPzfDOkO3bm3uKeKn/qQZ/jFnkUe/mLunoVe/eGyMKETo8zLlRataj6b5D7Xh7CjGRmQ7KjZG2bbQKIa4FBFpq7rfFFY=,iv:uGhKWgkko1JT2A4tHKYK/mLJs8lCM7jZi6EyJ30Y6o4=,tag:uJrmvQo+EiLW5F03IjXg7w==,type:str]
    pgp:
        - created_at: "2024-04-14T15:36:35Z"
          enc: |-
            -----BEGIN PGP MESSAGE-----

            hJ4D0dRkdsWQFPUSAwMEmu6RoZG7Wo7Farmlxq2lTiH8wSC4HeCPgIZg80nD0Zit
            Yk4QCUviJF+eS63pMoTy2YqqB2t76xmnUmMzToK35YPNFXfjKFkkxIbKZsXScQMM
            /DezfY8t/ARdSfJdJGjQMOxOUDqJG+b3cQyAPole6ZOixtXxpjPyL1WZ0jOOFBxr
            lqsJhO8HrDtJVxbocO7OLNRoAQkCEOMLhL1+G2SkcKZsd/MrsIBm2kjKOZbyB8Zh
            GZgpQooMnMgkt1lUUrw3pdIjTLFHw/qjhw7nQFUPv1uTcrzGMGu6yH0M6eFjAGb1
            K1Y26R6OXbqYl/g8RSlmpFhu7OPmDNObt5E=
            =mltq
            -----END PGP MESSAGE-----
          fp: 0F003E832B1DA1A11CA9F206712F90FA248BBBC2
        - created_at: "2024-04-14T15:36:35Z"
          enc: |-
            -----BEGIN PGP MESSAGE-----

            hJ4DLG005yzvDc8SAwMEuKAHgw6QKoM5k+5zfzpKCRqctgRYANOosL4a4TRY1t25
            6m2YuCWqxIFxfANNCYYxwhkIJ4NMjSVs7gLnWkMlItq7XqqV9nk04M4b+1TZLKtA
            gZewbZX7ue13YiI6JD4DMHJa2qVCeh9+2DumO8vG0+67M0JGkuF7ESJgdx0um+ol
            BMOv0H3atEB7sNlNYxhMc9RoAQkCEI+HaOpoFEh3HqqjY0TDyoLE3+wO+z2Fm4lG
            4LTz0/K4EbV4sguV+8X1NBsnNlZP7lJlyp61fcz6uhcePAtMrX0xYE6KmfnMDF8e
            l+4Zpa0Qcj0OgvrvZsOfgDx0TnIkShoyPI4=
            =0tby
            -----END PGP MESSAGE-----
          fp: 1918B94484C52CDE42CA1B87E7812096B8DA4A52
    encrypted_regex: ^maxmindLicenseKey$
    version: 3.8.1
