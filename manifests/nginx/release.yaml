apiVersion: helm.toolkit.fluxcd.io/v2beta2
kind: HelmRelease
metadata:
    name: nginx
    namespace: flux-system
spec:
    interval: 10m0s
    timeout: 5m0s
    chart:
        spec:
            chart: ingress-nginx
            version: 4.10.*
            sourceRef:
                kind: HelmRepository
                name: nginx
            interval: 60m0s
    releaseName: nginx
    targetNamespace: nginx
    install:
        remediation:
            retries: 3
        createNamespace: true
    upgrade:
        remediation:
            retries: 3
    values:
        controller:
            enableAnnotationValidations: true
            ingressClassResource:
                default: true
            podLabels:
                app.omnilium.cloud/identifier: nginx
            maxmindLicenseKey: ENC[AES256_GCM,data:h07h/N3i8Lwo+CJQVwjkIiq0zerwxQpOYheIdg1kfGi4RkVAq/XrRg==,iv:ndp/Ll/TN+nmK+l9+YY3In8udLIWA2Gc8+66z9fWf6w=,tag:WBYfnBPq7YEC0EIr8k2GLQ==,type:str]
            updateStrategy:
                rollingUpdate:
                    maxUnavailable: 1
                type: RollingUpdate
            affinity:
                podAntiAffinity:
                    preferredDuringSchedulingIgnoredDuringExecution:
                        - weight: 100
                          podAffinityTerm:
                            labelSelector:
                                matchExpressions:
                                    - key: app.kubernetes.io/name
                                      operator: In
                                      values:
                                        - ingress-nginx
                                    - key: app.kubernetes.io/instance
                                      operator: In
                                      values:
                                        - ingress-nginx
                                    - key: app.kubernetes.io/component
                                      operator: In
                                      values:
                                        - controller
                            topologyKey: topology.omnilium.cloud/host
            maxUnavailable: 1
            resources:
                limits:
                    cpu: 500m
                    memory: 256Mi
                requests:
                    cpu: 100m
                    memory: 64Mi
            autoscaling:
                enabled: true
                minReplicas: 3
                maxReplicas: 10
                targetCPUUtilizationPercentage: 75
                targetMemoryUtilizationPercentage: 75
                behavior:
                    scaleDown:
                        policies:
                            - type: Pods
                              value: 1
                              periodSeconds: 60
                    scaleUp:
                        stabilizationWindowSeconds: 60
                        policies:
                            - type: Pods
                              value: 1
                              periodSeconds: 30
            service:
                ipFamilyPolicy: RequireDualStack
                ipFamilies:
                    - IPv4
                    - IPv6
        tcp:
            "8000": onedev/onedev:22
sops:
    kms: []
    gcp_kms: []
    azure_kv: []
    hc_vault: []
    age: []
    lastmodified: "2024-04-14T15:33:36Z"
    mac: ENC[AES256_GCM,data:7NqVnRz8wR4zVlV+LLdZb8ePTBWzvrjcbVKdJ71dztgeKh6jrvWPWSR3kgsH4EJSnFj6Rtx9Os+x0KOiHwhR3TE2eUrBaBURJr8gDgkm3O0sSKZl8BEjXKS2z8FTGNZH31e+OR7ffYzs0IhrJyEyYeLos67nfgqI+hUxeiPNIN8=,iv:qP7pDFfkSZpiDNZv1yfDneege7R6Njq86gJmsqbicMw=,tag:DFrrN3yFhwcXEUFRXykIag==,type:str]
    pgp:
        - created_at: "2024-04-14T15:33:36Z"
          enc: |-
            -----BEGIN PGP MESSAGE-----

            hJ4D0dRkdsWQFPUSAwMEIpWWzdgMHZlwwAQQk99THb817IWwbDwpltiHlOrQ6IW6
            sI+IbWE2+yWO1LTwHTITkKT42BOwy83nr//s91s8MaI8U1ReennqOsLZiyWrwrTo
            9e1pMBiRPNZJgW0z+GWvMEAhWjkldS+8BzFaRhkWw9oW/a3n5Rw696YYPvBfhVjL
            w8CuolJsa0P+wHoBUwv9pNRmAQkCEIn9QC9PfyoI390OK1lnr2Mpdox2j0udCoaR
            aYeJKB73ngvaRAdBSOnbVDSYADPuAnYh/HPAExiM3eCddZExrYQjttHJ6TZuuX7H
            W385cgnkGA4o96jC3Shb12bvqH6Er0JD
            =VHiX
            -----END PGP MESSAGE-----
          fp: 0F003E832B1DA1A11CA9F206712F90FA248BBBC2
        - created_at: "2024-04-14T15:33:36Z"
          enc: |-
            -----BEGIN PGP MESSAGE-----

            hJ4DLG005yzvDc8SAwMEd3hkp4FRdMYG+QgCE5RtoMFPgx9TqpPuayoSL1jhom6O
            21SPPv41gc9eGatuaY9NZRNcs1sPnRyZnF/pxItJGd8megpxBap5ZSN4oyf5NOkN
            nlK5oozPmZYGajt7jjEbMNgrXxuEsbtg3JzgkXV4QkeIGMS9el9eI1Q7d2fuZYxI
            U10rYO6OgjlIXdxfWODaHtRmAQkCEMRUvl91QSsM/szjoEYkjpYaU6q+xW1S528a
            C7yjiKHCcc9n8tvio6hQdOHeGdsyUsc+xoOqGhviy0+/LWUWLj+8ISIq2fip5tjB
            BnvP1rHAuqILZrEvup6GD0kS1vlXg76r
            =E8BT
            -----END PGP MESSAGE-----
          fp: 1918B94484C52CDE42CA1B87E7812096B8DA4A52
    encrypted_regex: ^maxmindLicenseKey$
    version: 3.8.1
