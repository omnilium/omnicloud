apiVersion: helm.toolkit.fluxcd.io/v2beta2
kind: HelmRelease
metadata:
    name: woodpecker
    namespace: flux-system
spec:
    interval: 10m0s
    timeout: 5m0s
    chart:
        spec:
            chart: woodpecker
            version: 1.2.*
            sourceRef:
                kind: HelmRepository
                name: woodpecker
            interval: 60m0s
    releaseName: woodpecker
    targetNamespace: woodpecker
    install:
        remediation:
            retries: 3
        createNamespace: true
    upgrade:
        remediation:
            retries: 3
    values:
        agent:
            replicaCount: 3
            env:
                WOODPECKER_SERVER: woodpecker-server:9000
                WOODPECKER_AGENT_SECRET: ENC[AES256_GCM,data:+v1lDn8ylOW6IdNdxQz02BDANa8Po3Yhp5pu0k27Svs=,iv:4EX/scY80v02P4pkRm5t+j9kw4HRIdyqU1ZytsJr0ic=,tag:xcxYmMOggQSemoNdSC0vpQ==,type:str]
                WOODPECKER_BACKEND: kubernetes
                WOODPECKER_BACKEND_K8S_NAMESPACE: woodpecker
                WOODPECKER_BACKEND_K8S_VOLUME_SIZE: 10G
                # TODO: LINSTOR doesn't support RWX?
                WOODPECKER_BACKEND_K8S_STORAGE_RWX: false
                WOODPECKER_CONNECT_RETRY_COUNT: "3"
        server:
            statefulSet:
                replicaCount: 1
            env:
                WOODPECKER_HOST: https://ci.omni.ms
                WOODPECKER_ADMIN: woodpecker,admin,webmaster,andrei
                WOODPECKER_OPEN: false
                WOODPECKER_AGENT_SECRET: ENC[AES256_GCM,data:cK3mwWUU65QKZUqGbDjZW5X7xxVUb9qezOAZLmKy3Do=,iv:iZbAoQVRGC/SsvmudG89MNMGGLeGkYg7hb6KHyoKZOM=,tag:hvnUSiHYLbdPUaXlsqSskw==,type:str]
                WOODPECKER_DATABASE_DRIVER: postgres
                WOODPECKER_DATABASE_DATASOURCE: ENC[AES256_GCM,data:vo+ofAbE0DChVfVtngzLo2Sj3MY8YaLNNN19evsFAz2Ny2sUCViGaoKRBsPdZbSJtZwJ/gcySeqyzyZ5JBs8ea1XblmMowJzaUUQaUjUKxxYxwg/Hji6V6hmvn/lvolZUX4+YeO0+JvCptwXsWySDugnl9oLCJYh3K2aE7OlmpwwQJaU5KnGN5ji0PkPEA==,iv:9/6w+9c56C1OCUiYO6fZgi52i/P4rNBknzIN4PaNXBE=,tag:xSfegCfxDqpSqCFRz8HdLg==,type:str]
                WOODPECKER_GITEA: true
                WOODPECKER_GITEA_URL: https://git.omni.ms
                WOODPECKER_GITEA_CLIENT: 1fc71f6c-48c2-4334-ac37-4dff1203a7c2
                WOODPECKER_GITEA_SECRET: ENC[AES256_GCM,data:Xie/OxZbngiqcnv4ya8ieoWct4KTGURV8MLJ1u1Gc8bjn+kaNKfjp4JBn5SX8i3W4JkxdI04AsQ=,iv:2hE1F3rO1GyeHqjfJaoJHTZbYMYpg9/9sWn84MGsh4w=,tag:slkLNESUBLpUDBPGVYHKlA==,type:str]
            persistentVolume:
                storageClass: solid-state-replicated
sops:
    kms: []
    gcp_kms: []
    azure_kv: []
    hc_vault: []
    age: []
    lastmodified: "2024-04-16T16:58:26Z"
    mac: ENC[AES256_GCM,data:jLF0eCl7gwVn+h1RtUhEy9NaIuNSDLVQrY7lOexHTtEqXupsTBlfLxaAoumLmOLo1Rfpw5msZTKM/kWYEOUgP3Rop/tO3FN+aiUl/dlvDif7Oq6xtQ4+SfS9Wls0TCo5omjRIy2iCZaOhkvQhCTmvybJGPU6WOlq4ednDFjYQV4=,iv:DY3Z3utfa+qNTvo92EVtgruPXZ7XaTVuVZIqYOqwqtk=,tag:VbPqIoDbmyCTVUJWlqSAzA==,type:str]
    pgp:
        - created_at: "2024-04-16T16:58:26Z"
          enc: |-
            -----BEGIN PGP MESSAGE-----

            hJ4D0dRkdsWQFPUSAwME9pq8zmvH4ALQlBZYQx219zdJq/MBkRuX27a5BHD+syFh
            H4xbswLz8BRcd9yaMOpU2mpP1LBbnk5uzL8oXpTcwEDO7310PGiNZcsQqUaKFZab
            TUzWy+P7rNGm7QEI4fkhMG65gB75ytkm/lO7cKJhzXL1ZIPhXZ5N/bUd14SofKTu
            okoFgA4hUQEeBHyNgVk2BNRmAQkCEJN2vIn6t1qc4oMMIQb5j2Cgl/Glxvw2Mibd
            grGdHUJ5wz/j1T/+F/dLb/bWzyQpgqfvdcFEmS3aYUPo/i0H6AgO7yAf+1UxRLI3
            t7aZ/0yXfRph/9NGs8izVgJ33OIPgFWV
            =l1KU
            -----END PGP MESSAGE-----
          fp: 0F003E832B1DA1A11CA9F206712F90FA248BBBC2
        - created_at: "2024-04-16T16:58:26Z"
          enc: |-
            -----BEGIN PGP MESSAGE-----

            hJ4DLG005yzvDc8SAwMEmXQSGAhHLBE5TBCkVYzXRR+wyWTGN5sEmREqT1xzqlu9
            lWy8s5gB4d9EoN/gm+kVkLEJAvz90f7df04LSe60rD5Lgd/lmN520kbWY9En4I7k
            ehcgZtGa/MiqBibiF/XXMJGHTRpzoqKE3mY7Iqjhu1zDMRHSugi9OBS5dTGzpZ+W
            O1/OfkpR1HtZ5vGmTrasqNRmAQkCEOrM1/LhULiGqLbVjbNxzpjadUQpan/bgr4K
            DoLTzwpYSqdC4dq5/r1SU+BA4syhNRcl5XN768MGJUDXtm8S60INbuy19Fu0xvFf
            4mVGSfLcYF4/JWR9CHYD7zaI5bw2jHpR
            =yeMa
            -----END PGP MESSAGE-----
          fp: 1918B94484C52CDE42CA1B87E7812096B8DA4A52
    encrypted_regex: ^(WOODPECKER_AGENT_SECRET|WOODPECKER_DATABASE_DATASOURCE|WOODPECKER_GITEA_SECRET)$
    version: 3.8.1
