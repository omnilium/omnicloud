apiVersion: helm.toolkit.fluxcd.io/v2beta2
kind: HelmRelease
metadata:
    name: woodpecker
    namespace: flux-system
spec:
    interval: 10m0s
    timeout: 5m0s
    chart:
        spec:
            chart: woodpecker
            version: 1.2.*
            sourceRef:
                kind: HelmRepository
                name: woodpecker
            interval: 60m0s
    releaseName: woodpecker
    targetNamespace: woodpecker
    install:
        remediation:
            retries: 3
        createNamespace: true
    upgrade:
        remediation:
            retries: 3
    values:
        agent:
            replicaCount: 3
            env:
                WOODPECKER_SERVER: woodpecker-server:9000
                WOODPECKER_AGENT_SECRET: ENC[AES256_GCM,data:QaZJEmMbpUSLRWMxyZKlS/xsI7r96gU3LtyGBEXMN6E=,iv:Sbatn/6ph//u/RhPK8MHvFCj8K48VHX1picHD3RP79Y=,tag:6JIHNojw/xYg96eYWgbywg==,type:str]
                WOODPECKER_BACKEND: kubernetes
                WOODPECKER_BACKEND_K8S_NAMESPACE: woodpecker
                WOODPECKER_BACKEND_K8S_VOLUME_SIZE: 10G
                # TODO: LINSTOR doesn't support RWX?
                WOODPECKER_BACKEND_K8S_STORAGE_RWX: false
                WOODPECKER_CONNECT_RETRY_COUNT: "3"
        server:
            statefulSet:
                replicaCount: 1
            env:
                WOODPECKER_HOST: https://ci.omni.ms
                WOODPECKER_ADMIN: woodpecker,admin,webmaster,andrei
                WOODPECKER_OPEN: false
                WOODPECKER_AGENT_SECRET: ENC[AES256_GCM,data:JvZg2p/UYIwmQg1aLb6llxfwCTRBEcXoyoyo7EoojKo=,iv:Z86HS1/EwZzIRyIMUntBe6XfjLikSteU40AmIvJq1b4=,tag:s45xAGpjW4k4E2sBQm7xJQ==,type:str]
                WOODPECKER_DATABASE_DRIVER: postgres
                WOODPECKER_DATABASE_DATASOURCE: ENC[AES256_GCM,data:r2CTLn3o4jQ8bl3+iiKQeXwfZmHtPBH7gLElrBcLcbRlWNyObMzxDEKSXb9qlSM+cZit54mHm7Tz74xU9wwDCjNn2x5iw+LI+0Bp41OvD5Ucc2HSmMa+ivtwxClSzxSiCXcG25+Pl3V95SQ0QOwJjOOygwWxnSEFLHcQesjfg06rTNtYiMFwf2uENCAEmw==,iv:0+boV3ghYG850cAtlzwt/DIR4uVt4j0rRVP2pwsrL/s=,tag:QoQkjOXlacCDubth0Z2Dgw==,type:str]
                WOODPECKER_GITEA: true
                WOODPECKER_GITEA_URL: https://git.omni.ms
                WOODPECKER_GITEA_CLIENT: 1fc71f6c-48c2-4334-ac37-4dff1203a7c2
                WOODPECKER_GITEA_SECRET: ENC[AES256_GCM,data:Y3M/RW31x4IEsBjccpqDBe0I1fDsQxsRben8QCVIhjQTuC+J/pitHqNja5NIEHxpw99N4/E2W9M=,iv:0fWdkhdb5f9UZsbYivsLo2N6megljXuSNw6RsW/npWw=,tag:/Pj53YqB5/x9+rnofOQ3+w==,type:str]
            persistentVolume:
                storageClass: solid-state-replicated
sops:
    kms: []
    gcp_kms: []
    azure_kv: []
    hc_vault: []
    age: []
    lastmodified: "2024-04-15T09:52:46Z"
    mac: ENC[AES256_GCM,data:Q6zyGKnUBXA1evBjyIkXNvkOXpQ8AhqMYMNXxs+U1eEUestFiazBUqkwxKHF/7Z41aH7a/R/3uAm0DpjbBemVF2cb/gHOGwe3nV+7beWQ48xl9BovaTVDY/txydjHeD8PiUVYr4FUt+3KykgI9BwYQlqUC16xuFU+UuIHTu5Gcg=,iv:5XZXVGuFzjAsH3+x+y3207EXFbfU3aw4KPR2JszHRRI=,tag:046x+E6pj1ZqPItu1WVJzQ==,type:str]
    pgp:
        - created_at: "2024-04-15T09:52:46Z"
          enc: |-
            -----BEGIN PGP MESSAGE-----

            hJ4D0dRkdsWQFPUSAwMEBrEAjslB9mv03DbZVt2C9ZHNGrNEQpJReLwvUv4wg583
            v2DZHiOWTaxqhAqWtnYiFf7Mhi3nwP2PVi9FcikeD90k0fVJUIteyJuyToICEkYl
            156svL1vDnKxfeC7jRZ3MBMTLSUIRZT5Q6U/YSL/DmietzV+x6YNJMxA04vIJRXQ
            MtxyiX0nYDDDLU2+BmZzitRmAQkCEDhmQwA03SRfgKHvYmR0WXtIMcPlIOOj5a3s
            vYPbcJ7FserCIoFF+TOhhAdMEAPRPnFZ05W5aLtfSj3hC7CvFXyT67B7ny3m337M
            EhGb1G6eIAseQtoy8f8EZsJbJQcKSQVM
            =2PyA
            -----END PGP MESSAGE-----
          fp: 0F003E832B1DA1A11CA9F206712F90FA248BBBC2
        - created_at: "2024-04-15T09:52:46Z"
          enc: |-
            -----BEGIN PGP MESSAGE-----

            hJ4DLG005yzvDc8SAwMETlLeiQSopmlGO0DIh3TFLkVBSpiwWZrqDrcJ8WpEdjt3
            3QCt9VjW38CO/qFO0ySOePbufpRBSF/M1gAuUcKI1y+j73gHLCFg8Q3/mpiL5gul
            l+Rhm7AAK+BMxTCsOEnaMHCCf5T5jyvZ5K6dU22O79YR54j1fDqKljlJdQ4+RHRI
            SQDNaHrGRP5STL8DlW6L09RmAQkCEJc58k16HEG1P3LtViCPd7xqF7jCE9hJ3Pyh
            TvD3nPfiznXCMNvDYy2j+TBLHmdJsrP9H0iVBR/gstuno0Gh+DxLEE6F8mIsTY/7
            AHBkGQm75zNZ/x1PaAGnbgcdxj8OnUkn
            =Iwq6
            -----END PGP MESSAGE-----
          fp: 1918B94484C52CDE42CA1B87E7812096B8DA4A52
    encrypted_regex: ^(WOODPECKER_AGENT_SECRET|WOODPECKER_DATABASE_DATASOURCE|WOODPECKER_GITEA_SECRET)$
    version: 3.8.1
