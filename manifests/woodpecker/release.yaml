apiVersion: helm.toolkit.fluxcd.io/v2beta2
kind: HelmRelease
metadata:
    name: woodpecker
    namespace: flux-system
spec:
    interval: 10m0s
    timeout: 5m0s
    chart:
        spec:
            chart: woodpecker
            version: 1.2.*
            sourceRef:
                kind: HelmRepository
                name: woodpecker
            interval: 60m0s
    releaseName: woodpecker
    targetNamespace: woodpecker
    install:
        remediation:
            retries: 3
        createNamespace: true
    upgrade:
        remediation:
            retries: 3
    values:
        agent:
            replicaCount: 3
            env:
                WOODPECKER_SERVER: woodpecker-server:9000
                WOODPECKER_AGENT_SECRET: ENC[AES256_GCM,data:5ZwhN1gWqDGCCXKpttSQlLZqeLqMFmf8kQtDChbXYao=,iv:L1ibpeIsQXHNiSGC142sYTR/FZfMBl10JNLHWThMibk=,tag:bsQElQwvqOpSljVS0+TYrg==,type:str]
                WOODPECKER_BACKEND: kubernetes
                WOODPECKER_BACKEND_K8S_NAMESPACE: woodpecker
                WOODPECKER_BACKEND_K8S_VOLUME_SIZE: 10G
                # TODO: LINSTOR doesn't support RWX?
                WOODPECKER_BACKEND_K8S_STORAGE_RWX: false
                WOODPECKER_CONNECT_RETRY_COUNT: "3"
        server:
            statefulSet:
                replicaCount: 1
            env:
                WOODPECKER_HOST: https://ci.omni.ms
                WOODPECKER_ADMIN: woodpecker,admin,webmaster,andrei
                WOODPECKER_OPEN: false
                WOODPECKER_AGENT_SECRET: ENC[AES256_GCM,data:7gHOq4qmUCeyyhCxu8Xi3VSugn0iLsjFPtiw46qLh0Q=,iv:V+0NyRnLyjTG4nwTGDbTa0Q226fXsnr70Cas+y6Bepk=,tag:em+h1xUxRLmLK2U7UC77lA==,type:str]
                WOODPECKER_DATABASE_DRIVER: postgres
                WOODPECKER_DATABASE_DATASOURCE: ENC[AES256_GCM,data:hMTOiZR0YzMqesxCLJjQh7RgQgsPQ07rFDkTPblx0C+emEA38VxHKtwxfi6DZSzcJKixj5J55wWyUkcyNojeyvbRJHxf+I/S7D/79lJsMs9L6FFOjDohnWACv8NF1aU9uPRjn06N1omIoQYlwG2b9sFFAegstIgN4AcQDH+onNTcjnWniNJ1gOi7YsE0XQ==,iv:rUJs/m+wsWJSlA02xL+HpNRpNbbN5qSj0SVf19U9m40=,tag:xGNvZBUIbRPfSmAOLO2sRQ==,type:str]
                WOODPECKER_GITEA: true
                WOODPECKER_GITEA_URL: https://git.omni.ms
                WOODPECKER_GITEA_CLIENT: 1fc71f6c-48c2-4334-ac37-4dff1203a7c2
                WOODPECKER_GITEA_SECRET: ENC[AES256_GCM,data:vX73gowabChocUiF7JZPY99j7Io63bzcMAHOocJq9UGsHWoMJSV/w3FWj+9/QsSB0Bm68xTtuE4=,iv:wqNw0LJZysztnNdQHYQQnlOyFFjYCji6vaNGeXbXblw=,tag:J3J3jIy5k34anLezLLMI9A==,type:str]
            persistentVolume:
                storageClass: solid-state-replicated
sops:
    kms: []
    gcp_kms: []
    azure_kv: []
    hc_vault: []
    age: []
    lastmodified: "2024-04-15T19:20:45Z"
    mac: ENC[AES256_GCM,data:tEyzW6aDbnNEqJBxQRkq1MqtONLjJ7XsD8QwOjR/qKB/Dl4/9q07ENuyEIeq1/5Shc1FqsB616yZJePLJ5u/kY3IpT9WLraOBAZlFqQMrNxJFORCT6JnP/4/zHFfJa2z5ld3DvuqZ142huVUa3qobivmClL+lW2Lgz8c26H5Odk=,iv:GU5YW05aP7jj1kPyk0FdNfesLVJMUM0HG4sJOVbiNAo=,tag:XcMiieXUZMZ1G7XD2o8Fzg==,type:str]
    pgp:
        - created_at: "2024-04-15T19:20:45Z"
          enc: |-
            -----BEGIN PGP MESSAGE-----

            hJ4D0dRkdsWQFPUSAwMEPqkIsnmpOCU3zpKBEDGkeJ/rnn5wfbGtxZ8DfcNE+Cjq
            6+paLRsQTXrn2p1of3BBiEjim+ZtsJv4CxEkrfC2sEto58e5KneQhv2JDz4Bsqtc
            3pLbsi3qUQ3uosKAY5X3MN2ISn9O/huu+/6qV7wKYjdWkEmVMlLN6aQ8xxHlQQLC
            e9uA7UZUXjbhRzDb8h1Hd9RmAQkCEEL1V4AmJN0rqrSdavAtdleAMU4/p2Nu1eyx
            5e7+lJkv1RFSyduAuojos39pwYXw+zVl4bbGbqm+xK7Ai/eLn+3SN+vUPbZWkRL1
            22Sy0msyj+Wu1+AL75FcFU/hB2F7bmwC
            =muSa
            -----END PGP MESSAGE-----
          fp: 0F003E832B1DA1A11CA9F206712F90FA248BBBC2
        - created_at: "2024-04-15T19:20:45Z"
          enc: |-
            -----BEGIN PGP MESSAGE-----

            hJ4DLG005yzvDc8SAwMEpuVu1ktHi9yun3EWQE9eqK4WWkDS2CGDk5OMhjzPn3ci
            XCELQm+Lopu47d/l1GKNn0NsCLa5SkP5EYXMGRoxADdjZFvWErd4sD0P65aOoh7+
            RUjteM5fUmy4Wi1O2/a/MLuxwhxhnuD+indEaeRlFEx8l7XPHVrltyg/52bqqv8j
            SlYrHW2QGjvFeKWAJZpGHNRmAQkCEN4M5rsSq24Qzmb/+Rk/ISulXRqj6KaYv9UO
            SFjl4hCsTJXo77PSJvGWk7gddR+QXsNiQjFUaEilLIV3XH9J9Njpd27qbb5ZN6oj
            kX2e5y+Md16x7kXDb3J8afUEfC/ZxC3a
            =M3az
            -----END PGP MESSAGE-----
          fp: 1918B94484C52CDE42CA1B87E7812096B8DA4A52
    encrypted_regex: ^(WOODPECKER_AGENT_SECRET|WOODPECKER_DATABASE_DATASOURCE|WOODPECKER_GITEA_SECRET)$
    version: 3.8.1
