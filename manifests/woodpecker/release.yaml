apiVersion: helm.toolkit.fluxcd.io/v2beta2
kind: HelmRelease
metadata:
    name: woodpecker
    namespace: flux-system
spec:
    interval: 10m0s
    timeout: 5m0s
    chart:
        spec:
            chart: woodpecker
            version: 1.2.*
            sourceRef:
                kind: HelmRepository
                name: woodpecker
            interval: 60m0s
    releaseName: woodpecker
    targetNamespace: woodpecker
    install:
        remediation:
            retries: 3
        createNamespace: true
    upgrade:
        remediation:
            retries: 3
    values:
        agent:
            replicaCount: 3
            env:
                WOODPECKER_SERVER: woodpecker-server:9000
                WOODPECKER_AGENT_SECRET: ENC[AES256_GCM,data:B3JwTsTJC0p+47KpPm7jJHMQI39Qje/DvY/Sor0xJ7w=,iv:X1nk03fSPKnPWtdnHUih9PlqqqrkS9mT96VePMvCMXI=,tag:XSDTgdOU99w+iysxfdRaEw==,type:str]
                WOODPECKER_BACKEND: kubernetes
                WOODPECKER_BACKEND_K8S_NAMESPACE: woodpecker
                WOODPECKER_BACKEND_K8S_VOLUME_SIZE: 10G
                # TODO: LINSTOR doesn't support RWX?
                WOODPECKER_BACKEND_K8S_STORAGE_RWX: false
                WOODPECKER_CONNECT_RETRY_COUNT: "3"
        server:
            statefulSet:
                replicaCount: 1
            env:
                WOODPECKER_HOST: https://ci.omni.ms
                WOODPECKER_ADMIN: woodpecker,admin,webmaster,andrei
                WOODPECKER_OPEN: false
                WOODPECKER_AGENT_SECRET: ENC[AES256_GCM,data:QnL/wqG1cIp5RMaRs+kJXd7gbDmGOLtwwDLmh+fpqsI=,iv:OPFAiaNIBurZkVSawfXF7FHCM8FT4qqBOrC7B6rFRUw=,tag:96/YXqt3oC37UHD2Qw5cmw==,type:str]
                WOODPECKER_DATABASE_DRIVER: postgres
                WOODPECKER_DATABASE_DATASOURCE: ENC[AES256_GCM,data:MPArnJMqVbQNXSCXMLTtqk9S+YvK9RIxfZ0raKrwkjRnmG7bx7ZZ33HYjT4wXQle4Wpyh8sxWjt8UCN4zMKwuT1i5Ec+XQLMtfEyUky5clpUPAu5L6QV7no51HdGZOVh1qYwe+l7DE/AATIGH9DIrCBbum3jxy3xOERVdCDvXEdfYDHcF3qc4UCSyxEsqQ==,iv:fIxHNd74ZnnGo4aOOChVgA9gK4ZZvB5tai3tc4K0xhU=,tag:Yut+yS39sWxmyIR9bkJa9w==,type:str]
                WOODPECKER_GITEA: true
                WOODPECKER_GITEA_URL: https://git.omni.ms
                WOODPECKER_GITEA_CLIENT: 1fc71f6c-48c2-4334-ac37-4dff1203a7c2
                WOODPECKER_GITEA_SECRET: ENC[AES256_GCM,data:bNAQS0Ba+dEyw6Rcl2ZDxq8hpdGCFWZH0zP3cCmf6C8T5EU+gGr6Lto664VHy4jOvRItV1APRWg=,iv:aDRhi0RgKf2noNPYfwtvtGfnPX74QqVgGoxB2fBKu8s=,tag:Li8FatxPML5bnbGOaTuXJw==,type:str]
            persistentVolume:
                storageClass: solid-state-replicated
sops:
    kms: []
    gcp_kms: []
    azure_kv: []
    hc_vault: []
    age: []
    lastmodified: "2024-04-15T10:02:28Z"
    mac: ENC[AES256_GCM,data:hD/KhQMGPH5xeNTdThB3EwrJc63i425YyCUDXqfd7aJ5e4jyPlhJ1CQtUUo6KXEz21drWQkoaANKMnvQanlUi5OJxTbf/MMNSr+Hbp4nCMN9j3B1SQlpWgPe77NKJtuo2+Om+qfwVPpj1fkoiWLaaSD8Cjx5JZApbNUaviwUpdc=,iv:nA4SLS8G6bWBh0tBbJCHVkM4a3aKXBKhK5SZzPvQ8xw=,tag:LyFwADpb0pCbTYpA5hPJiA==,type:str]
    pgp:
        - created_at: "2024-04-15T10:02:28Z"
          enc: |-
            -----BEGIN PGP MESSAGE-----

            hJ4D0dRkdsWQFPUSAwMEChMeLVj59bDpxxEvymQdVs+a1R3WH1VRNT6wKUtN851u
            r1KBPowGrb2nKZwx0TFMuHjMQRv1vpnOE94JMuKWABvnCr0HrCEdG4hxzhLBUWbu
            25MSVvMUvZyfdf3BlUr+MMMahPVNKAkT+aOGKPMs3VhpyOaq+PobjH4I3dGDx0o7
            ceJjW9M9pQIxUwCj0yxSbdRoAQkCELQz75kAut1TepnrK7aFZZW9p3j+vsRSUHx2
            I7cClSXNPaKa4a1q7H4aGFOQ6dEHgOMdNIpVRuNWo8B8kGM9HFtXoIsEU8IzGjvd
            PQMABXZsZ56k7zrLpBB3NeOh2xyFK6LcSLc=
            =TAf8
            -----END PGP MESSAGE-----
          fp: 0F003E832B1DA1A11CA9F206712F90FA248BBBC2
        - created_at: "2024-04-15T10:02:28Z"
          enc: |-
            -----BEGIN PGP MESSAGE-----

            hJ4DLG005yzvDc8SAwMEXplvExsACUA8kGirhIy5rwjvmuHJAtLtJG64JypBaXww
            oExaHT7cKucy3VwfhAd7TM516xThfbfQfWQ1z5l8tGrrU9cSO72IcaIt2D6rf+Wt
            IpqvBAGLNu+3HYkMLfrhMIO1JvrrBjQPYyKr2OFd0VRk5BS73qhweDLk5MuLT8TB
            Hf76cabjEsIxcK3WidKYJNRoAQkCEODqrITSXPqF7lV46OTvv3PnYHbaWRg25nNW
            4xTYM1Qujg+g5Eo1agazXRTijcEE3ouvFoEcBT32r7fsf2DYTa8Pgm+1f2ea5poQ
            QZ0pCbx9J2peWA8CYT1L36hMSK68OnRZbFY=
            =D2wa
            -----END PGP MESSAGE-----
          fp: 1918B94484C52CDE42CA1B87E7812096B8DA4A52
    encrypted_regex: ^(WOODPECKER_AGENT_SECRET|WOODPECKER_DATABASE_DATASOURCE|WOODPECKER_GITEA_SECRET)$
    version: 3.8.1
