apiVersion: helm.toolkit.fluxcd.io/v2beta2
kind: HelmRelease
metadata:
    name: woodpecker
    namespace: flux-system
spec:
    interval: 10m0s
    timeout: 5m0s
    chart:
        spec:
            chart: woodpecker
            version: 1.2.*
            sourceRef:
                kind: HelmRepository
                name: woodpecker
            interval: 60m0s
    releaseName: woodpecker
    targetNamespace: woodpecker
    install:
        remediation:
            retries: 3
        createNamespace: true
    upgrade:
        remediation:
            retries: 3
    values:
        agent:
            replicaCount: 3
            env:
                WOODPECKER_SERVER: woodpecker-server:9000
                WOODPECKER_AGENT_SECRET: ENC[AES256_GCM,data:Dp4eFcseWPi3G4hSV3W7bPADeGK/TdF1EGP587C0rw0=,iv:iwKO9D9XGDJklyuWK2XmCaAUrUFj4Fe8oCNQ+n+EQbE=,tag:ts/1pTOaFTmYXd6uXVWlIw==,type:str]
                WOODPECKER_BACKEND: kubernetes
                WOODPECKER_BACKEND_K8S_NAMESPACE: woodpecker
                WOODPECKER_BACKEND_K8S_VOLUME_SIZE: 10G
                # TODO: LINSTOR doesn't support RWX?
                WOODPECKER_BACKEND_K8S_STORAGE_RWX: false
                WOODPECKER_CONNECT_RETRY_COUNT: "3"
        server:
            statefulSet:
                replicaCount: 1
            env:
                WOODPECKER_HOST: https://ci.omni.ms
                WOODPECKER_ADMIN: woodpecker,admin,webmaster,andrei
                WOODPECKER_OPEN: false
                WOODPECKER_AGENT_SECRET: ENC[AES256_GCM,data:wui5LdmSWDNM4AIs4z6i5LVNgZVNMS5bf82jMeuBe30=,iv:64iqno2ZapLiiOIm4ZsienHWrJYO7lwJ4b5fCCXlWz4=,tag:MfldyOA5wTxrm5TZ3odk1A==,type:str]
                WOODPECKER_DATABASE_DRIVER: postgres
                WOODPECKER_DATABASE_DATASOURCE: ENC[AES256_GCM,data:y4YuErh5qAmsHG9OrKIK7zL1SVR5z1VJlq4PWnRy3/g7AqsXw6CrI3CLoWATpE2NOe/bErjMMhWfoTigluhh004yGuSb2nfchSv8/zowH5Ob+D5Osg6QI5oHapiarqiWSCfLb/5I1lSif+SP9akxnHGqe8ZpcW9PU1j2jI75iVbOrSNbV4VooQiFvfZgwg==,iv:AJBjf7RVXJYpvf+tQG6ihglvRMaNsjSOmrIObJ/vkBA=,tag:W5pmIZr7nOmtkERmTOklhQ==,type:str]
                WOODPECKER_GITEA: true
                WOODPECKER_GITEA_URL: https://git.omni.ms
                WOODPECKER_GITEA_CLIENT: 1fc71f6c-48c2-4334-ac37-4dff1203a7c2
                WOODPECKER_GITEA_SECRET: ENC[AES256_GCM,data:IZy3gNGuFWNdOd/FRXSZj+815z08DgQerVMJ5yo4Sn7Q16S4o5v7vhhwZwMs5leq5ydqrMB7hH4=,iv:elevn33Kf7YnpeAqdehu/nEtC7JHYpW/uaKpu3qGtoY=,tag:ehLI0z76DDsj1ia9JB5cRw==,type:str]
            persistentVolume:
                storageClass: solid-state-replicated
sops:
    kms: []
    gcp_kms: []
    azure_kv: []
    hc_vault: []
    age: []
    lastmodified: "2024-04-15T10:41:23Z"
    mac: ENC[AES256_GCM,data:45HrwM1TCFpEPceu2EoVRiprFBEHAROHdfHZJAXHhpTPT2NTsj2IuhEtt0a+z9SgDfHZwk6u2lIbmCocsrCL+hpzQNSbEB+BOYwGeLK7D9qKIzPH+yZB1tsJ8JWs9LfFlk0/6wb9U4XdSbMfKyvseGKUVFoj+V1x7whA96KrvOQ=,iv:xMMyRbfbNvW9RVyYwgGxU7LahM8WM31SugJXoeHeMiU=,tag:XdfSiP3NXOV+GLvmo6KPDw==,type:str]
    pgp:
        - created_at: "2024-04-15T10:41:23Z"
          enc: |-
            -----BEGIN PGP MESSAGE-----

            hJ4D0dRkdsWQFPUSAwMExjxgSIEGbV2JSZAZlfLg+yudLb2SrvbkAzKaZgRBzdVB
            E0XU3hJ6tkgJzS1VCLqGL5e2m++sHYkfWZ0h5TJWjXKq6qoc8cmkRPIaUZfK+RmX
            bJf0FM+6O6B1LMQ9JyWpMJO+VLySSfdR5mSG7tBRQWlMmAgUhP9W0C0Dm+1m4ffT
            HeW7TgtScLI07+JrXxLrWtRmAQkCEDo+M0DHwLb4xT2L1xY61s3s1S0b15hP4oDL
            Ktcucl42ZOr+2gy/Mz2E027SH6stqe3FjTa7xXcBV5ENo1PD+ns1eS7/atgsx+i+
            k2Y1PXZPLHgifsbk0x9H4pghptMs1jEM
            =BJ7W
            -----END PGP MESSAGE-----
          fp: 0F003E832B1DA1A11CA9F206712F90FA248BBBC2
        - created_at: "2024-04-15T10:41:23Z"
          enc: |-
            -----BEGIN PGP MESSAGE-----

            hJ4DLG005yzvDc8SAwMEBKPu6RYh9BVhZgHd8wuikaBkD+nZLVAUMKo/LhUsZ/+N
            DhGxxItrHKvu2Kt7iGkJvzXWkv1EVRZ1Kvj89iojo0FgkD8Dqi0uuP6VXJO+dly6
            HRlLCg1JxFa2S5HqMCUyMKvkQHCy7TLhDX77/+uF0ILLfMLS9ieH4R8pvuPHgIVN
            mad/ZW4X3VvIqUQp1L3Q29RmAQkCEMWVjxNGBXsBzPYFKgbEFQlRuDA9UfWZ285F
            wYmZ1nq/Bnj87Lc7AgTfBK7xBswEuwwmbp5FfMI1BPz9FWxILIgnlI6WOJ1D0v/b
            FxSykC+tEf5JMMs2uJ5wovCtGPaaetBQ
            =ajBa
            -----END PGP MESSAGE-----
          fp: 1918B94484C52CDE42CA1B87E7812096B8DA4A52
    encrypted_regex: ^(WOODPECKER_AGENT_SECRET|WOODPECKER_DATABASE_DATASOURCE|WOODPECKER_GITEA_SECRET)$
    version: 3.8.1
