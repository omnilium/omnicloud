apiVersion: helm.toolkit.fluxcd.io/v2beta2
kind: HelmRelease
metadata:
    name: woodpecker
    namespace: flux-system
spec:
    interval: 10m0s
    timeout: 5m0s
    chart:
        spec:
            chart: woodpecker
            version: 1.2.*
            sourceRef:
                kind: HelmRepository
                name: woodpecker
            interval: 60m0s
    releaseName: woodpecker
    targetNamespace: woodpecker
    install:
        remediation:
            retries: 3
        createNamespace: true
    upgrade:
        remediation:
            retries: 3
    values:
        agent:
            replicaCount: 3
            env:
                WOODPECKER_SERVER: woodpecker-server:9000
                WOODPECKER_AGENT_SECRET: ENC[AES256_GCM,data:7J0J/hOsg6V+mlrgv/r1XT6QbY4EMxwiz/Mz2jPT1PA=,iv:Jm+twwsbwHfH9dEj9axfL5bU4Fhry10SRMxasRPid6I=,tag:uTnn3Rqy6SNdgl7Hp+uMeQ==,type:str]
                WOODPECKER_BACKEND: kubernetes
                WOODPECKER_BACKEND_K8S_NAMESPACE: woodpecker
                WOODPECKER_BACKEND_K8S_VOLUME_SIZE: 10G
                WOODPECKER_BACKEND_K8S_STORAGE_RWX: true
                WOODPECKER_CONNECT_RETRY_COUNT: "3"
        server:
            statefulSet:
                replicaCount: 1
            env:
                WOODPECKER_HOST: https://ci.omni.ms
                WOODPECKER_ADMIN: woodpecker,admin,webmaster
                WOODPECKER_ORGS: omnilium
                WOODPECKER_OPEN: false
                WOODPECKER_AGENT_SECRET: ENC[AES256_GCM,data:58xIgC/KTz16qRAvUuwt7Og85dbAu4cuFMF//5ygSwE=,iv:Qdxj9JuZM81k5zV8/tYOyO4AA6uMVQPQBqZjS8YLEhk=,tag:fC7DzOYeJy1PTBWXVZ+TZw==,type:str]
                # WOODPECKER_DATABASE_DATASOURCE: # TODO: https://woodpecker-ci.org/docs/administration/server-config#woodpecker_database_datasource
                WOODPECKER_GITEA: true
                WOODPECKER_GITEA_URL: https://git.omni.ms
                WOODPECKER_GITEA_CLIENT: woodpecker
                WOODPECKER_GITEA_SECRET: ENC[AES256_GCM,data:KqW8,iv:rX9Mw3G6MkaPLKWp1kNIb7tsmto6Bw7cpW0BCD4xpD0=,tag:GDVjqjqKg+zIAAWyvEnrag==,type:str]
            persistentVolume:
                storageClass: solid-state-replicated
sops:
    kms: []
    gcp_kms: []
    azure_kv: []
    hc_vault: []
    age: []
    lastmodified: "2024-04-14T18:23:48Z"
    mac: ENC[AES256_GCM,data:cGbzgK6N523CPioXKxkCCkGuxv8keSjI1FX3HDUs1QZ6eJ13TuCXG2tsGX+wwUKZj+BVulAvpDYxNnu2V97kUpnu6TGYzS/5S9Z3X4ZaNToUFzwChVlUHOoG8/uyDoOtwnCvMFOvSBqEPbxAG9hPT5NIHagpbctxHm6DLG36YGQ=,iv:q09kIvPqG+c2KA6gNmQxO+YsQ7gLUxLsGMZD5BVKX6A=,tag:aHVRjIHoIEQjDTl5BdJatA==,type:str]
    pgp:
        - created_at: "2024-04-14T18:23:48Z"
          enc: |-
            -----BEGIN PGP MESSAGE-----

            hJ4D0dRkdsWQFPUSAwMEd9a7zPLrjr/hYUNwQqflJGptqGE68LZ4zYRErbZQc2jO
            D+8zf28o/3DpMj8mOUfBttyiszigqRAmyUQqEPdvmgX3FWXsMtbO/Owt+KEOSNGY
            tcfutGk5zKEQma/cOQm0MH8lQyZq+1zkLuW1A0cSHXLdTjfdLFmZRRGz3SrKMQUm
            TjcekQde2StESl6ZzCMX+tRmAQkCELj7ZFkhQZi42qWd0T7ZrOW2G5IqD0yUsOLz
            4c67LVmgGvrHCyXqnGmSTMotAbC0BW18kAUmV0uTRe4uLp8mIZ/JPL1aQN1tDEY8
            bopLpllIpVBNqTxnOKaB3tSbzS7nTFMC
            =MpPA
            -----END PGP MESSAGE-----
          fp: 0F003E832B1DA1A11CA9F206712F90FA248BBBC2
        - created_at: "2024-04-14T18:23:48Z"
          enc: |-
            -----BEGIN PGP MESSAGE-----

            hJ4DLG005yzvDc8SAwMEtURK6lq0oVqd0SZy2uVI2IeLqg4lYcko9Xy5nDUrza2O
            AgFfz9mZrgNMwfsIzDKAO7sHKUgEFRiypS8rNtf/3MvFt/9SQhxf9UKobt21JW0V
            WCkoop/x+0gSl3ojHsHgMPAEQQwqtzyus4P5zH9uw3pZDQ4awSyNL+r7JuoOQDXz
            WTd5chj12A+PlgBG6Da4A9RmAQkCEBg+PVzdl46pH7pPSJVhSnq+N6hmW3uq/+Pz
            rSaAFA+uwVwdGri1XT/Dk26dnCENNpYwRFGeGgTkdAhi3t1KR17mahLEMRXURUDG
            Z+jZetPj84Yz+L+cZDn7U0BF4dx0bBcx
            =4rSm
            -----END PGP MESSAGE-----
          fp: 1918B94484C52CDE42CA1B87E7812096B8DA4A52
    encrypted_regex: ^(WOODPECKER_AGENT_SECRET|WOODPECKER_GITEA_SECRET)$
    version: 3.8.1
