apiVersion: helm.toolkit.fluxcd.io/v2beta2
kind: HelmRelease
metadata:
    name: woodpecker
    namespace: flux-system
spec:
    interval: 10m0s
    timeout: 5m0s
    chart:
        spec:
            chart: woodpecker
            version: 1.2.*
            sourceRef:
                kind: HelmRepository
                name: woodpecker
            interval: 60m0s
    releaseName: woodpecker
    targetNamespace: woodpecker
    install:
        remediation:
            retries: 3
        createNamespace: true
    upgrade:
        remediation:
            retries: 3
    values:
        agent:
            replicaCount: 3
            env:
                WOODPECKER_SERVER: woodpecker-server:9000
                WOODPECKER_AGENT_SECRET: ENC[AES256_GCM,data:GdGEeh5ndwaAJZs6qF7GTO+uvmI+sku8FWfHkVVyWJU=,iv:GlFnPttTNEjN2lSKjEGwADvms1Libos7TbjVZTQcQzw=,tag:n241H6usSI2/1Tw1ZWoHSQ==,type:str]
                WOODPECKER_BACKEND: kubernetes
                WOODPECKER_BACKEND_K8S_NAMESPACE: woodpecker
                WOODPECKER_BACKEND_K8S_VOLUME_SIZE: 10G
                # TODO: LINSTOR doesn't support RWX?
                WOODPECKER_BACKEND_K8S_STORAGE_RWX: false
                WOODPECKER_CONNECT_RETRY_COUNT: "3"
        server:
            statefulSet:
                replicaCount: 1
            env:
                WOODPECKER_HOST: https://ci.omni.ms
                WOODPECKER_ADMIN: woodpecker,admin,webmaster,andrei
                WOODPECKER_OPEN: false
                WOODPECKER_AGENT_SECRET: ENC[AES256_GCM,data:P+w/WN5vodeIOveJrUxcflOXQdVn/8CMJYsVI11JBZ8=,iv:WymsP7BMFvvVGqiB1AhLnCnZvzkJeWVZcpGo0CEAYNk=,tag:g2vq1kJGQ0WWzoeGk8WhuQ==,type:str]
                WOODPECKER_DATABASE_DRIVER: postgres
                WOODPECKER_DATABASE_DATASOURCE: ENC[AES256_GCM,data:ouzymr90+d4pFUwbdB9anfbd4e/47Bq332TCHYPHEcvIlqTa713XaER5EU85RXC7BcTBbl9tXvSeUvmxZgSfQfgVQh2wqAIhDAPtqYJZ4MORw1fs+8VMC8oWwk6OeXDGMSAC5dNg2WDIlka3MyRBVi7hOLoqNKycnF5n1sPTH2/65KP/iIFOOROoPmh9uQ==,iv:WvhsgoUJfQHgR9Byn0uxLTJYICLKWIPshdgTkwC4Jc0=,tag:wBr+pzd/K4DCdk+Jkt98Yg==,type:str]
                WOODPECKER_GITEA: true
                WOODPECKER_GITEA_URL: https://git.omni.ms
                WOODPECKER_GITEA_CLIENT: 1fc71f6c-48c2-4334-ac37-4dff1203a7c2
                WOODPECKER_GITEA_SECRET: ENC[AES256_GCM,data:iEmV/ijE+n4hkdFCw/4Dk3H8baRdxcaoxhAjueQYcDyfTyl+k6zRLjH1dY94svob6Gi5LYYStAo=,iv:3njO4SL4DR/jSMC96F9RtAaL0KaCJ5ITv2F+t/Nn/Kg=,tag:AM+8/FK+gWiS9atcAxa36g==,type:str]
            persistentVolume:
                storageClass: solid-state-replicated
sops:
    kms: []
    gcp_kms: []
    azure_kv: []
    hc_vault: []
    age: []
    lastmodified: "2024-04-16T19:19:51Z"
    mac: ENC[AES256_GCM,data:AM7NYVwUCToC6i35jT+l5md/Xrlal/gPAYh4PZsFrxmklzMaP+7zE/fZlsJpH974HWmNGUp2ZvAyclh/gVTlHzmRG25Kw+RngkmD1GsRHXp68YGmVFA89z8uX9syzKbZSxEzH+Kbl3FnqKq9kUFJ9DOtXOrHO6RSIdR7m8ReZ3c=,iv:4jMJbO1SelVrrdodfV5A9Gk5fJb2d3tO4icUCb2D8rY=,tag:bvaNJaJXW2sN4/qsULMKUQ==,type:str]
    pgp:
        - created_at: "2024-04-16T19:19:51Z"
          enc: |-
            -----BEGIN PGP MESSAGE-----

            hJ4D0dRkdsWQFPUSAwME0IAACT90I6ubNkEteC6Zr+Anh114lV2sdHs/ZmWV4hGY
            0y6/lOUoLraq4g2viOKQ/E3PYkmpd33Da0OUvgltvkgG9JEDOuFlR/2Vf5jJjWUB
            RhGV//h5Z+6Xq2cmyKiCMDKzvt59TaHc3IU9bdkLLYEk0ibc1Xd722CPRgLL06N1
            aanwrIjjEFCd/Hk9AH646tRoAQkCEMIDAOOq+u9Rnumf/RwBOcBTBqzA/6JrFLR0
            pwmvx0fs/J0Niiv8SyO757ILVNKO83QMq+Jd8zaGBDKJMpO+r01Y21wScTft/l4z
            ml1M4UEJMyBz9NyXtmRYOBSih/c0LQosiNo=
            =QK22
            -----END PGP MESSAGE-----
          fp: 0F003E832B1DA1A11CA9F206712F90FA248BBBC2
        - created_at: "2024-04-16T19:19:51Z"
          enc: |-
            -----BEGIN PGP MESSAGE-----

            hJ4DLG005yzvDc8SAwMEhKDaDZOYeOTC3OAAYGJtUftvTpacdW1g2AXcRs6W30+K
            5hk1bizv7h5pah36NVUE9yN4CYqHVYj361K7yWOb2W5qPGPWqR/JVzokdZF0SK6P
            qZWlgUqbgW5+G5ReBD8cMM6Yc7PQuTxZzvAKwqZ0Fu4f6Fk/CC43HZC3HOh5OqiG
            yYs42gSo9bEIuwjDmELV59RoAQkCECPGtd7FZ9mvJb2qh7UPWsEtRJx3fMdEcLC3
            Pl6eZW4U+WEfJsmgjXlT7IX2GsQ1sTMkkvb4f5h48P/lFR1CQ+3zr+Wjwb/D1cf5
            C/+40/J1e21R3U/Xmb8RvXUAz3rR8qUZgIo=
            =oV6h
            -----END PGP MESSAGE-----
          fp: 1918B94484C52CDE42CA1B87E7812096B8DA4A52
    encrypted_regex: ^(WOODPECKER_AGENT_SECRET|WOODPECKER_DATABASE_DATASOURCE|WOODPECKER_GITEA_SECRET)$
    version: 3.8.1
