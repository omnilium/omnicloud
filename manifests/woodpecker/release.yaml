apiVersion: helm.toolkit.fluxcd.io/v2beta2
kind: HelmRelease
metadata:
    name: woodpecker
    namespace: flux-system
spec:
    interval: 10m0s
    timeout: 5m0s
    chart:
        spec:
            chart: woodpecker
            version: 1.2.*
            sourceRef:
                kind: HelmRepository
                name: woodpecker
            interval: 60m0s
    releaseName: woodpecker
    targetNamespace: woodpecker
    install:
        remediation:
            retries: 3
        createNamespace: true
    upgrade:
        remediation:
            retries: 3
    values:
        agent:
            replicaCount: 3
            env:
                WOODPECKER_SERVER: woodpecker-server:9000
                WOODPECKER_AGENT_SECRET: ENC[AES256_GCM,data:hXeDch5zQHnoNhXhCcjfU9sPIFBRnHI/5Tzz4OJ8C/8=,iv:34sFPbCoEnUhpHPig1ES7L+dSPxnBH9pXkW+LSOkmWk=,tag:Ehz/zXwnd/PNolOZRKNT6g==,type:str]
                WOODPECKER_BACKEND: kubernetes
                WOODPECKER_BACKEND_K8S_NAMESPACE: woodpecker
                WOODPECKER_BACKEND_K8S_VOLUME_SIZE: 10G
                # TODO: LINSTOR doesn't support RWX?
                WOODPECKER_BACKEND_K8S_STORAGE_RWX: false
                WOODPECKER_CONNECT_RETRY_COUNT: "3"
        server:
            statefulSet:
                replicaCount: 1
            env:
                WOODPECKER_HOST: https://ci.omni.ms
                WOODPECKER_ADMIN: woodpecker,admin,webmaster,andrei
                WOODPECKER_OPEN: false
                WOODPECKER_AGENT_SECRET: ENC[AES256_GCM,data:ApL4PeC9e3rYDDE8AWMZsznhqbxYTvd3QOohnETQtG4=,iv:5ddalI8rahnb7JqqCKyN2VlPqGQ/4v+iqbsJSAvlbfA=,tag:TO13WLaovLd1yYE8/CMG6Q==,type:str]
                WOODPECKER_DATABASE_DRIVER: postgres
                WOODPECKER_DATABASE_DATASOURCE: ENC[AES256_GCM,data:Bl0HUkf1zb5TU1xdux4MhtAg/v72GfUJ/VILf54eHnsrlIZMvdjyUdN6hge6qsul0zVZOc/fKIau/qEKRPYXi5iWi0zoHRYUAZdzKcfUcEMbyD+uiYRZb3IAXiOs/zPjmzB6xX78cKK+jbU9Us+ryyIrN8VWIQYiYLdo6Q+5doUH6PfD6N3q3CWPoJzfuA==,iv:02UGDSt3paXKDWdDRLuGwcVvXh2IQTV9fRzJrWy5QDk=,tag:onED1xeRcbuXqAVIgkbdMg==,type:str]
                WOODPECKER_GITEA: true
                WOODPECKER_GITEA_URL: https://git.omni.ms
                WOODPECKER_GITEA_CLIENT: 1fc71f6c-48c2-4334-ac37-4dff1203a7c2
                WOODPECKER_GITEA_SECRET: ENC[AES256_GCM,data:gZOSdwmrtvguavF3AZskbaQjnJEcWus0AZ1Yl3yEEDwrQcd9jzSbW8Tjt267+nNvUwGBo35MnfQ=,iv:896hGtyYPAHHW1JZxn+oZ0PL3e5YGVstcmAHttnWSZk=,tag:WMbWyQg9idGIsN3Oq1dyPw==,type:str]
            persistentVolume:
                storageClass: solid-state-replicated
sops:
    kms: []
    gcp_kms: []
    azure_kv: []
    hc_vault: []
    age: []
    lastmodified: "2024-04-15T09:50:48Z"
    mac: ENC[AES256_GCM,data:tNJAUR4KEdKrELUXf+sHlfUMmvtZagkgYozcdjggy4qSElWjvO2u9cbCNh63xAoFeRE6g4YhzK4lYWsvmbvRjuBl71cpq2vFXVgzJimm/eybvKyOtsINW+4tEL6ZCEqfsCNXsxY7MBwchAkPyRoXK5zSmM7Aa1Ode+o+BOSl0Fo=,iv:TM3cxcfeeGtONh7l8cOJTz43Way/I1B5QIf4S3Z3dXU=,tag:5BeSXUfuCB2by6ohCjYGMg==,type:str]
    pgp:
        - created_at: "2024-04-15T09:50:48Z"
          enc: |-
            -----BEGIN PGP MESSAGE-----

            hJ4D0dRkdsWQFPUSAwMEHj5+E7fen3qY8/XPIbZLPQyQDn8VcMxRChheaf5GiyAp
            at7hqhDTpH3d/1/s2JWRhlVIiSATnIUCqOVnId+GM3zDgRzjTAG72WHm/R+jahHe
            MGYbhCBwyDokgodd7+IkMJALzbBfKDIBoyR4FFpvG6QRAO43mEHhZSFIkvyn6VEB
            Ik7s4SZOR6ivdiY5vt2beNRoAQkCECe51Epk6SA18reXupz/BURTSVyBiQ+4eBy5
            52DnXcwmEj0XvU5uW8Ae6LsFeTqVEGp3ibsCXtawtYzDMgSINAc5J3cr7Vj7xkIo
            iPtLO66ew+vVL7Ram7if3Sq2huHhjnoDfng=
            =Q55G
            -----END PGP MESSAGE-----
          fp: 0F003E832B1DA1A11CA9F206712F90FA248BBBC2
        - created_at: "2024-04-15T09:50:48Z"
          enc: |-
            -----BEGIN PGP MESSAGE-----

            hJ4DLG005yzvDc8SAwME6lO0tTsY+zOK3dS/MXypkzGpg1y4k3hMPJDgUDTlNn6k
            1g4LVbd+eoC6aThgK6YgoSWdZpFJ6dJta/lBb9rN3Bcv8Z8ZhGxdo8L/RF9uAdf2
            2OmhYRZJOJviAUyiXkUYMPEZvB+kAzI2Cz6UPSbIdNzpltBJuh2yXAut/Z1s+mRE
            KaQW2MbAO2LibcPiVxWM+NRoAQkCEAonUEbO+buqqxfhn5LuVLYGh8tszYd8PueA
            RR+iSw0WivfTiIl/nhznPEdX73fla3JEZy0ivKitmWny73tokJBwvEHGoXW30H2f
            XTeBcznsUANB4Tim/gDvXGXFFI2mwfli3uk=
            =8AhG
            -----END PGP MESSAGE-----
          fp: 1918B94484C52CDE42CA1B87E7812096B8DA4A52
    encrypted_regex: ^(WOODPECKER_AGENT_SECRET|WOODPECKER_DATABASE_DATASOURCE|WOODPECKER_GITEA_SECRET)$
    version: 3.8.1
