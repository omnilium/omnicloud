apiVersion: helm.toolkit.fluxcd.io/v2beta2
kind: HelmRelease
metadata:
    name: woodpecker
    namespace: flux-system
spec:
    interval: 10m0s
    timeout: 5m0s
    chart:
        spec:
            chart: woodpecker
            version: 1.2.*
            sourceRef:
                kind: HelmRepository
                name: woodpecker
            interval: 60m0s
    releaseName: woodpecker
    targetNamespace: woodpecker
    install:
        remediation:
            retries: 3
        createNamespace: true
    upgrade:
        remediation:
            retries: 3
    values:
        agent:
            replicaCount: 3
            env:
                WOODPECKER_SERVER: woodpecker-server:9000
                WOODPECKER_AGENT_SECRET: ENC[AES256_GCM,data:LE51nDJHzrDxLh5xsd8v0snnEsp+5uPVHVhdCpxvP1M=,iv:mBn8QEz99whGVKsDGvhBWCEvoatEa1mVFMMUsEHbunw=,tag:v98t/Z8yaNTRCofVyAf9lw==,type:str]
                WOODPECKER_BACKEND: kubernetes
                WOODPECKER_BACKEND_K8S_NAMESPACE: woodpecker
                WOODPECKER_BACKEND_K8S_VOLUME_SIZE: 10G
                # TODO: LINSTOR doesn't support RWX?
                WOODPECKER_BACKEND_K8S_STORAGE_RWX: false
                WOODPECKER_CONNECT_RETRY_COUNT: "3"
        server:
            statefulSet:
                replicaCount: 1
            env:
                WOODPECKER_HOST: https://ci.omni.ms
                WOODPECKER_ADMIN: woodpecker,admin,webmaster,andrei
                WOODPECKER_OPEN: false
                WOODPECKER_AGENT_SECRET: ENC[AES256_GCM,data:RzzkjirLgysCsYoBGQQGKD8urMYqKzPgiVPUDcY1Pqs=,iv:KMIguYjkVSYI9IGkpYBEexML+np4tPoFRrNvcMLmnUI=,tag:ByDbo6KQyZGHNP6P9i9nuA==,type:str]
                WOODPECKER_DATABASE_DRIVER: postgres
                WOODPECKER_DATABASE_DATASOURCE: ENC[AES256_GCM,data:v3ddVpPZgUUKrDHUJno2zhnKWVHxipCCb9p3Q9pOaI66TD3gG4BEPP4C4Tp0FqbMmZCjDpcfxoJbrLb5TSpizSecewOFTzvDrU7oKZCtuxP8HLT87Mir2EN/qxAObX98iuviFqJHxq+myAKy0MHgbOpjfbvpl8ikfi1umdyfC2R3qFWfEhBP7wiWhSsVww==,iv:pbtC3kxpRE7ZSgA/dgyy8/2W8Yn7tVSE2sVfBnKwm8c=,tag:KLLmjJ2kTjJbpyQ2/h1wUA==,type:str]
                WOODPECKER_GITEA: true
                WOODPECKER_GITEA_URL: https://git.omni.ms
                WOODPECKER_GITEA_CLIENT: 1fc71f6c-48c2-4334-ac37-4dff1203a7c2
                WOODPECKER_GITEA_SECRET: ENC[AES256_GCM,data:YPdFoJueY4E+mcvWSd5sXT9wImi14YT7KqkLBNF0ALsNl0HaPzBjP+eR4FGMu48ead9P5zyXbHI=,iv:aVpkifuLBy8Zr9Xl6tK9D/FmIRYn+dqwkv6PDwOl4ho=,tag:7svP/UvCE/MzJq+hr1srqQ==,type:str]
            persistentVolume:
                storageClass: solid-state-replicated
sops:
    kms: []
    gcp_kms: []
    azure_kv: []
    hc_vault: []
    age: []
    lastmodified: "2024-04-15T19:18:04Z"
    mac: ENC[AES256_GCM,data:BRnIsGXjNAjJEkYfOc3HCZQG7A/dfLxprfQgYNkykZoLCAMdoiMRiw3+Tz6PxlejOSboxalrds9Yv1VZCVysDWQpB5YiJnhi/h0hvsg86PaxqyOlrOYrojjf+8usiU2IV0dlXXJKaDwh3+l2P3s5Sr/hGlCG46F22YugjSaqzxg=,iv:V8dRjpoFv893lt1Zbt06703AHXUvundz5RI0/G5xCjE=,tag:9+FjOKi9BvYmmWpO1frEuw==,type:str]
    pgp:
        - created_at: "2024-04-15T19:18:04Z"
          enc: |-
            -----BEGIN PGP MESSAGE-----

            hJ4D0dRkdsWQFPUSAwMEGX9WNxzFVoK22iF95UTLatJ+uVz9N8i6mejRg+YRXyay
            gpCKUopeITtP8uHQffpGu+BLEyghcqiZQOFrkwtPSKXk0DMncf5/YiII9XbuYM07
            ZoTTjC8Ph4qX5F9WswSXMKZ2mwBETXBpOkhYfZFTTDOc2Xc50HsErEAKqqoqbvKy
            EXIafbdgOIki8HLcWDdNzdRmAQkCEN0IgN144lVEmQ7tihBtk71Pz1K2wruFkm1g
            361h+FzXuBC48NF+ncpBuZKgdxvvk+zqbMhEX3NtbDiULsVpY9LZozLkDAqX7VGS
            /bZLVDlRcLdTqICnQwV9QGcYC5rYTNFN
            =iLYm
            -----END PGP MESSAGE-----
          fp: 0F003E832B1DA1A11CA9F206712F90FA248BBBC2
        - created_at: "2024-04-15T19:18:04Z"
          enc: |-
            -----BEGIN PGP MESSAGE-----

            hJ4DLG005yzvDc8SAwMEAQP51AIjGFzMRPLMpSSrdl++cnmNYRa9JG0dl2agV/aT
            JUFyB5Sv8jl1H4x7cxqhAKUIw3L5pw6Z91C8FvPGRDeEG7omSp4TbB1eNkpl8tnY
            f13decnCNObD9/1C+cfOMBP+lz8miXqysNwjTzaLXAdRAr8+AX/zTvTT/otqrAKS
            jmMh2vBEwWktuf+AjXtu4NRmAQkCEKidi8ma63+ZQmMiuPvM4vDk9i/lNToGbaqr
            8vgiMS8MOFebtnd9pmJyagHW0IateOgb4oCFd6cxwncr5NYsG152+gihaTR1sOdP
            xpceqzwcBDCdhOtOIkftweYXSo9vi//8
            =utZ6
            -----END PGP MESSAGE-----
          fp: 1918B94484C52CDE42CA1B87E7812096B8DA4A52
    encrypted_regex: ^(WOODPECKER_AGENT_SECRET|WOODPECKER_DATABASE_DATASOURCE|WOODPECKER_GITEA_SECRET)$
    version: 3.8.1
