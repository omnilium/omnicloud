apiVersion: helm.toolkit.fluxcd.io/v2beta2
kind: HelmRelease
metadata:
    name: thanos
    namespace: flux-system
spec:
    interval: 10m0s
    timeout: 5m0s
    chart:
        spec:
            chart: thanos
            version: 1.16.*
            sourceRef:
                kind: HelmRepository
                name: stevehipwell
            interval: 60m0s
    releaseName: thanos
    targetNamespace: monitoring
    install:
        remediation:
            retries: 3
        createNamespace: true
    upgrade:
        remediation:
            retries: 3
    values:
        nameOverride: thanos
        fullnameOverride: thanos
        objstoreConfig:
            name: ENC[AES256_GCM,data:aW76SCtVPAwSQQSxKzKrSa71Iya12o9Us44jcQ==,iv:9z/lvtooxW99CQNKe6BYDy2mt0dbg8VLRbnPC5c6nA4=,tag:U4DmDXh8AJYwfjPFxEupEA==,type:str]
            value: ENC[AES256_GCM,data:YcRqGKUGh5+bkei5vigTqAKdsj28dYuyhdGplpyTCLa/utGwIVGepHUsCUfE7CR0RcIGk/CMnt4Uagbl7tALy/lAhbuFcvSI4x7D3ZBnBShOVH+c3UdEzI8kEJQIK77b3hUr29dcs49Tf9sXMg8bd+hFeIVX7iEC+tpXllUNVKmLmXfi/MpWtDoKq7KiIB7RRCGYDme6XXJnzpAOK/UblQNTU097sSarjZHbKz+n5pwUD2KUbnolULBdQngfPIHVMhW+S0gTZ7gtCuz1yHxGs/E+6qLXMalYSsn8hF1y4639Xpz7kP+ojUE23aCYniKtlWw+125v7AQ=,iv:NHTbRW6QQZzZsYfugHZ/vaHYC8celnakonShIE26efc=,tag:c+ObK4iR4+XOp9vNHqnYcA==,type:str]
        serviceMonitor:
            enabled: true
        compact:
            enabled: true
            resources: {}
        query:
            ingress:
                enabled: true
                annotations:
                    cert-manager.io/cluster-issuer: omnicloud
                hosts:
                    - thanos.omnilium.local
                tls:
                    - secretName: thanos-tls
                      hosts:
                        - thanos.omnilium.local
            replicas: 2
            resources: {}
            # autoscaling:
            #   enabled: true
            #   minReplicas: 1
            #   maxReplicas: 3
            #   targetMemoryUtilizationPercentage: 75
            # podDistruptionBudget:
            #   enabled: true
            #   minAvailable: 1
            extraArgs:
                - --store=dnssrv+_grpc._tcp.thanos-store-gateway-headless.monitoring.svc.cluster.local
                - --store=dnssrv+_grpc._tcp.promstack-thanos-discovery.monitoring.svc.cluster.local
            podLabels:
                app.omnilium.cloud/identifier: thanos
            topologySpreadConstraints:
                - maxSkew: 1
                  topologyKey: topology.omnilium.cloud/host
                  whenUnsatisfiable: ScheduleAnyway
                  labelSelector:
                    matchLabels:
                        app.omnilium.cloud/identifier: thanos
        queryFrontend:
            enabled: true
            ingress:
                enabled: true
                annotations:
                    cert-manager.io/cluster-issuer: omnicloud
                hosts:
                    - frontend.thanos.omnilium.local
                tls:
                    - secretName: thanos-frontend-tls
                      hosts:
                        - frontend.thanos.omnilium.local
            replicas: 2
            resources: {}
            # autoscaling:
            #   enabled: true
            #   minReplicas: 1
            #   maxReplicas: 3
            #   targetMemoryUtilizationPercentage: 75
            # podDistruptionBudget:
            #   enabled: true
            #   minAvailable: 1
            podLabels:
                app.omnilium.cloud/identifier: thanos-frontend
            topologySpreadConstraints:
                - maxSkew: 1
                  topologyKey: topology.omnilium.cloud/host
                  whenUnsatisfiable: ScheduleAnyway
                  labelSelector:
                    matchLabels:
                        app.omnilium.cloud/identifier: thanos-frontend
        storeGateway:
            replicas: 2
            resources: {}
sops:
    kms: []
    gcp_kms: []
    azure_kv: []
    hc_vault: []
    age: []
    lastmodified: "2024-04-16T20:23:12Z"
    mac: ENC[AES256_GCM,data:SO/58hR2p5WhHelpJmd6jKUjtQwPn6HcD1+pv/hx1n9sGg7763snvKDFCj4G+u5mGq5IRnGRpRNZ9njbc17RSDL/ZUsPYV8n1J1xAtpNGqrdZ2C+ixaqMbMiSQZVqqOX71fPq20/U+6q9ugG6JZre7QTFvWHlkliY8cz7SrpHwE=,iv:vJd4VoFqe/II9gsoUKuGdTLNg++T/ck80DMTxbSeT/Q=,tag:ZUQnsJTtnEj1k8w+hPm7jQ==,type:str]
    pgp:
        - created_at: "2024-04-16T20:23:12Z"
          enc: |-
            -----BEGIN PGP MESSAGE-----

            hJ4D0dRkdsWQFPUSAwME73xeLijgaK+pkQI5jxxBTLeyTzudeezAveVzBEb1Qd2w
            rLQPXsgb8aXwb5c/CK3jL2bkvbdL3ScgrL6+1MSYKjxn7KjWqJaKZqjyEDBulYsS
            Qvcxb6pNEpnBgG/zZm1mMFFMHrwqVtFh0j6QgkrV6HjEeA1ZD/U/G/Q1VyQ4AqLL
            VDviSM58fI0YuZzvoXdLHtRmAQkCEFvngNrE13gwb2f+UPZNihLfZa7GU/dzKSJy
            fulpiJjTJpUiXgnj3Oh8UZyCy/bgo1Bo9ZKqFEOl065no1XHBtQqp5g1vHZ7yWbH
            1rAtwHDf66Q08pHHQOs8A5Cqz2VjHrV+
            =odgb
            -----END PGP MESSAGE-----
          fp: 0F003E832B1DA1A11CA9F206712F90FA248BBBC2
        - created_at: "2024-04-16T20:23:12Z"
          enc: |-
            -----BEGIN PGP MESSAGE-----

            hJ4DLG005yzvDc8SAwMEwYZfP40nXDbfvR7ehjLOZADWOhfVTjaDojnm83XrTy2k
            QX9CeR78d7GJcqNlMKb2/sgYOfNvVTSf20j+17KmpBMXb5pkiF6+LoQEaYJBgwsK
            MDF6EfT/+SESjZCxQLakMCw4um/DZbt9/+QPTucB/Zht48AhkLGcn3l4x/uky2GT
            XjWEJBvd3fWBwpkNyuTRadRmAQkCEGg61Wob4sybhVMCd5DOiiLdfJMrhdFT+A9G
            BOUp310649jJnUDv4jLAdWEW3rUzEyEoFZfPzD7hVkvjiG0oBt4NUXcCDHpngvS8
            SDTfTVaNBK4cu6lOZ41wwVbH7HR/xzhT
            =HFES
            -----END PGP MESSAGE-----
          fp: 1918B94484C52CDE42CA1B87E7812096B8DA4A52
    encrypted_regex: ^(data|adminPassword|secret_key|secretKey|objstoreConfig)$
    version: 3.8.1
