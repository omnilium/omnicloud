apiVersion: helm.toolkit.fluxcd.io/v2beta2
kind: HelmRelease
metadata:
    name: onedev
    namespace: flux-system
spec:
    interval: 10m0s
    timeout: 5m0s
    chart:
        spec:
            chart: onedev
            version: 10.4.*
            sourceRef:
                kind: HelmRepository
                name: onedev
            interval: 60m0s
    releaseName: onedev
    targetNamespace: onedev
    install:
        remediation:
            retries: 3
        createNamespace: true
    upgrade:
        remediation:
            retries: 3
    values:
        onedev:
            replicas: 3
            initSettings:
                user: admin
                password: ENC[AES256_GCM,data:9+Txn+v6g5+silESoFr7mP02SRuIXqfjDfSxlDT+J90=,iv:WYfLhBQuuID2hMWQbxW2QlEBh1MFjba7I3KB+EE8Qag=,tag:y7PdKSFFfYdYmUbaaX7EdA==,type:str]
                email: webmaster@omnilium.cloud
        database:
            external: true
            type: postgresql
            host: onedev-cnpg-cluster-rw.onedev.svc.cluster.local
            port: "5432"
            name: onedev
            user: onedev
            password: ENC[AES256_GCM,data:NUDa3oiZqmnAxJSVkSQrWNWAZrTox1DBL30DYAsfc40=,iv:PHhY8OUXMppzCsaSk7oAaGsl5GSLcnSXywP4aLcK3UU=,tag:GpieH9VdHLT6Pk2npfbvXg==,type:str]
        podLabels:
            app.omnilium.cloud/identifier: onedev-server
        affinity:
            podAntiAffinity:
                preferredDuringSchedulingIgnoredDuringExecution:
                    - weight: 100
                      podAffinityTerm:
                        labelSelector:
                            matchExpressions:
                                - key: app.omnilium.cloud/identifier
                                  operator: In
                                  values:
                                    - onedev-server
                        topologyKey: topology.omnilium.cloud/host
        persistence:
            size: 32Gi
        # service:
        #     separateSSH:
        #         enabled: true
        #         type: LoadBalancer
        #         port: 22
        ingress:
            enabled: true
            annotations:
                cert-manager.io/cluster-issuer: acme
            host: git.omni.ms
            tls:
                enabled: true
sops:
    kms: []
    gcp_kms: []
    azure_kv: []
    hc_vault: []
    age: []
    lastmodified: "2024-04-14T15:54:23Z"
    mac: ENC[AES256_GCM,data:Rx0DPukrHIlH9YdqVbKrCFcrr4H1ycGElOartpRTi2lWCa/5iEEg7n61vY2A0I6vYrJtIOJYlyOcauKRJpMxY+FehOabeig/ZsVkDhebNSpuhnmVcv1OGva4AsiEuJfTOXyOn3KESHG/bYrz/nYsUOYz39kl0ehAZGAbaizPsvk=,iv:hVCZxDdOTlvBsGNjUKmBZC97ByMuEy4w9XszZdUFaaQ=,tag:N5tE+eOkr++BzO3DnxR3Rg==,type:str]
    pgp:
        - created_at: "2024-04-14T15:54:23Z"
          enc: |-
            -----BEGIN PGP MESSAGE-----

            hJ4D0dRkdsWQFPUSAwMEqDHu1ohmt2XgJSjfcQYGDuxBcjSBFy1/KiB6N3xGg7Ox
            3F9eGjXQCM/AyA3lYQUB+TrsTF4m806z0Q0TGJmMoh/+RUVMAiwJHducMCPfnj6/
            v7M/UYmaX7rZxjyHbGBkMKhGwbQADqGvynSZtUNIgI1p3QUjSRjABGLMtJ8FY0pL
            toMEhZyztzZZX9DJlZOYyNRoAQkCEPL4MsFJrAiLbuI5Ja8+Apvvszoo4QKGfkc0
            UHyiAJApN/diNjeU/iUhqDOb6AuqGXiawivfKD+z3xjac6XurDEAGHtnqlW1svTn
            MXnS/p4g6+r6dr1V0ELMUskffCi0lTEXk1A=
            =JZbr
            -----END PGP MESSAGE-----
          fp: 0F003E832B1DA1A11CA9F206712F90FA248BBBC2
        - created_at: "2024-04-14T15:54:23Z"
          enc: |-
            -----BEGIN PGP MESSAGE-----

            hJ4DLG005yzvDc8SAwMEfKn5vvcyvFkeqTqmLxjmttSqpZyYDW2UcFTI/6XFUUDr
            Ikn+27+b5hkYKxOq6NIRpEYAXisg6D2bVHHvoLDT4Uaet625MkaFg0cSk1KNnD5W
            X1WWtjszKZ2pWDU9wMhDMDLNh0Dx+X2ITPfVfHxlKH8RfMo8VbUjWvaAeAEHvFfj
            /4WH4qE4OAVQRAT8xFYU4dRoAQkCEDVycTnnFH9ccbWtqA+aPel16IvyJqe6iAyl
            tjo9ij7WZujqmd2+MElqHe7sq1dl4QNaD+8tuSda2xGYE5OnrL5xSs8qhxfqds7s
            DMZHvMQvXK17Oxq8t9bowv9AfIL0QT6rkug=
            =Fq+I
            -----END PGP MESSAGE-----
          fp: 1918B94484C52CDE42CA1B87E7812096B8DA4A52
    encrypted_regex: ^(data|stringData|password)$
    version: 3.8.1
