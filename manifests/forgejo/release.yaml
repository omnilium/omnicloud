apiVersion: helm.toolkit.fluxcd.io/v2beta2
kind: HelmRelease
metadata:
    name: forgejo
    namespace: flux-system
spec:
    interval: 10m0s
    timeout: 5m0s
    chart:
        spec:
            chart: forgejo
            version: 5.0.*
            sourceRef:
                kind: HelmRepository
                name: forgejo
            interval: 60m0s
    releaseName: forgejo
    targetNamespace: forgejo
    install:
        remediation:
            retries: 3
        createNamespace: true
    upgrade:
        remediation:
            retries: 3
    values:
        replicaCount: 1
        strategy:
            type: Recreate
        service:
            http:
                ipFamilyPolicy: RequireDualStack
                ipFamilies:
                    - IPv4
                    - IPv6
            ssh:
                ipFamilyPolicy: RequireDualStack
                ipFamilies:
                    - IPv4
                    - IPv6
        schedulerName: gvisor
        persistence:
            size: 32Gi
        gitea:
            admin:
                username: webmaster
                password: ENC[AES256_GCM,data:yR45bKfSbC6ZtRoLaG6Md4qQrJKnF+mKQK6EIhCD11w=,iv:XbV12e3KIZ/sCfsjAz44iGQBWrdKT7JGstOYC3zFy00=,tag:UtfHdl4zkXiA1r3MerLV1A==,type:str]
                email: webmaster@omnilium.cloud
            config:
                repository:
                    DISABLED_REPO_UNITS: repo.actions
                    DEFAULT_REPO_UNITS: repo.code,repo.issues,repo.pulls
                cors:
                    ENABLED: true
                    SCHEME: https
                    ALLOW_DOMAIN: git.omni.ms,forgejo.omni.ms
                server:
                    DOMAIN: git.omni.ms
                    ROOT_URL: https://git.omni.ms/
                    START_SSH_SERVER: true
                    ENABLE_GZIP: true
                    LFS_START_SERVER: true
                database:
                    DB_TYPE: postgres
                    HOST: forgejo-cnpg-cluster-rw.forgejo.svc.cluster.local:5432
                    NAME: forgejo
                    USER: forgejo
                    PASSWD: ENC[AES256_GCM,data:vxZF9/EKDYqr+5/HuG5n5uICCDXDRVeGIRZ+oN7Soro=,iv:1qujRRcBKDNymAugKsFIGukXai+pLW+ySfPGd+vrI64=,tag:AaX7Fu2l39/fyN+ohVzbkQ==,type:str]
                service:
                    DISABLE_REGISTRATION: true
        postgresql-ha:
            enabled: false
        postgresql:
            enabled: false
sops:
    kms: []
    gcp_kms: []
    azure_kv: []
    hc_vault: []
    age: []
    lastmodified: "2024-04-14T16:37:36Z"
    mac: ENC[AES256_GCM,data:OY0XytJ+Tfaz1JBIb3mu1MvZDORg0komjgl+CYv8HPKAdrk2k7q+qbr66ffWYdewfxbLusH0JpqebSuk16T/Spvfi4NlXBja2wylBqN8lg02mxmni4SK0ISFLTyrac6smAbAG8PbTQAEf9lcCjMKV+fUD66OI9whG4czDUJImZI=,iv:WEByLr2Kdct0dOSFfA3n4SeAvqiA9URh6GOLX72X0UY=,tag:VJw5OHkyrUqt4ukhx9wDrQ==,type:str]
    pgp:
        - created_at: "2024-04-14T16:37:36Z"
          enc: |-
            -----BEGIN PGP MESSAGE-----

            hJ4D0dRkdsWQFPUSAwMEt4ziYUZLDMOtaGtqr2H07TafV9pe/P09GZgOj3MUqwzf
            ZvjfOoz+S3u/kJ9fbEs19GXdlxCyiBuBZKpJpmh2kNXupzY/SF5bnkzm4IF+aj8K
            6zNViZJ4MyAtIQf3wGaKMDnL18nmLq0pM+amiWJNP02q4VTzF5FDCucO/brdRkVj
            ETYZNts1reKqRMch75do4NRmAQkCEFFkiRMxprjZeM/K0Aq5v2+1/xTgxETaV44z
            kPLbzyxHZ0NvkfxQV1UrBTJkEvQ74LBAP+LTl8Dl3Lrc08eQGuqYCJAmrSSx4pMp
            NHgDfMk6d1I6vHqJEu3ciZYvMKcq53v1
            =OXxr
            -----END PGP MESSAGE-----
          fp: 0F003E832B1DA1A11CA9F206712F90FA248BBBC2
        - created_at: "2024-04-14T16:37:36Z"
          enc: |-
            -----BEGIN PGP MESSAGE-----

            hJ4DLG005yzvDc8SAwMEQKvgHvd0iMME4Yp1IIbgCI+P8PD4UVcVoPORzNenCfGU
            10lSX9X+f2fKQ3aiTeclXrJbeQd9xQwz4hjS4RgJllP2E5eHrvY7LiJjkGcVOaor
            1FHpA7NCrY4dfCc/VAX1MO0+EplS+7qKxT4jZun0dx8RZRjma32OAT1eTwcWRTuv
            mK3jFIzHGGHZvTtTYAG+BtRmAQkCEJtyNEBG68CecxcDJaSUXGZTpp94IkhYD4sd
            sZDgoSCNBZxv012t4QYK5BfxxK9+bRhIZHhv1mXcIjyau4LzE8Vk5lrfFbRlBxqs
            sFtL3c+n9tHHPDbWNsFAqI+VwXhNhfEl
            =YxoG
            -----END PGP MESSAGE-----
          fp: 1918B94484C52CDE42CA1B87E7812096B8DA4A52
    encrypted_regex: ^(password|PASSWD)$
    version: 3.8.1
